"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[179],{411:()=>{function Ut(n){return"function"==typeof n}function Hc(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const zc=Hc(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Qa(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Gi{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(Ut(i))try{i()}catch(s){e=s instanceof zc?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{K_(s)}catch(o){e=e??[],o instanceof zc?e=[...e,...o.errors]:e.push(o)}}if(e)throw new zc(e)}}add(e){var t;if(e&&e!==this)if(this.closed)K_(e);else{if(e instanceof Gi){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Qa(t,e)}remove(e){const{_finalizers:t}=this;t&&Qa(t,e),e instanceof Gi&&e._removeParent(this)}}Gi.EMPTY=(()=>{const n=new Gi;return n.closed=!0,n})();const X_=Gi.EMPTY;function Y_(n){return n instanceof Gi||n&&"closed"in n&&Ut(n.remove)&&Ut(n.add)&&Ut(n.unsubscribe)}function K_(n){Ut(n)?n():n.unsubscribe()}const Ms={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Gc={setTimeout(n,e,...t){const{delegate:i}=Gc;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Gc;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Z_(n){Gc.setTimeout(()=>{const{onUnhandledError:e}=Ms;if(!e)throw n;e(n)})}function J_(){}const UC=ef("C",void 0,void 0);function ef(n,e,t){return{kind:n,value:e,error:t}}let xs=null;function Wc(n){if(Ms.useDeprecatedSynchronousErrorHandling){const e=!xs;if(e&&(xs={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=xs;if(xs=null,t)throw i}}else n()}class tf extends Gi{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Y_(e)&&e.add(this)):this.destination=WC}static create(e,t,i){return new el(e,t,i)}next(e){this.isStopped?rf(function BC(n){return ef("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?rf(function kC(n){return ef("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?rf(UC,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const HC=Function.prototype.bind;function nf(n,e){return HC.call(n,e)}class zC{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){$c(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){$c(i)}else $c(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){$c(t)}}}class el extends tf{constructor(e,t,i){let r;if(super(),Ut(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&Ms.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&nf(e.next,s),error:e.error&&nf(e.error,s),complete:e.complete&&nf(e.complete,s)}):r=e}this.destination=new zC(r)}}function $c(n){Ms.useDeprecatedSynchronousErrorHandling?function VC(n){Ms.useDeprecatedSynchronousErrorHandling&&xs&&(xs.errorThrown=!0,xs.error=n)}(n):Z_(n)}function rf(n,e){const{onStoppedNotification:t}=Ms;t&&Gc.setTimeout(()=>t(n,e))}const WC={closed:!0,next:J_,error:function GC(n){throw n},complete:J_},sf="function"==typeof Symbol&&Symbol.observable||"@@observable";function of(n){return n}let Vn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function jC(n){return n&&n instanceof tf||function $C(n){return n&&Ut(n.next)&&Ut(n.error)&&Ut(n.complete)}(n)&&Y_(n)}(t)?t:new el(t,i,r);return Wc(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=ev(i))((r,s)=>{const o=new el({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[sf](){return this}pipe(...t){return function Q_(n){return 0===n.length?of:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}(t)(this)}toPromise(t){return new(t=ev(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function ev(n){var e;return null!==(e=n??Ms.Promise)&&void 0!==e?e:Promise}const qC=Hc(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let jc=(()=>{class n extends Vn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new tv(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new qC}next(t){Wc(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Wc(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Wc(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?X_:(this.currentObservers=null,s.push(t),new Gi(()=>{this.currentObservers=null,Qa(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new Vn;return t.source=this,t}}return n.create=(e,t)=>new tv(e,t),n})();class tv extends jc{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:X_}}class XC extends jc{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function vo(n){return e=>{if(function YC(n){return Ut(n?.lift)}(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function tl(n,e,t,i,r){return new KC(n,e,t,i,r)}class KC extends tf{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function jr(n){return this instanceof jr?(this.v=n,this):new jr(n)}function sv(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function uf(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){!function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}const ov=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function av(n){return Ut(n?.then)}function lv(n){return Ut(n[sf])}function cv(n){return Symbol.asyncIterator&&Ut(n?.[Symbol.asyncIterator])}function uv(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const dv=function g1(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function hv(n){return Ut(n?.[dv])}function fv(n){return function rv(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(h){i[h]&&(r[h]=function(f){return new Promise(function(p,y){s.push([h,f,p,y])>1||a(h,f)})})}function a(h,f){try{!function l(h){h.value instanceof jr?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}(i[h](f))}catch(p){d(s[0][3],p)}}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,f){h(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield jr(t.read());if(r)return yield jr(void 0);yield yield jr(i)}}finally{t.releaseLock()}})}function pv(n){return Ut(n?.getReader)}function qr(n){if(n instanceof Vn)return n;if(null!=n){if(lv(n))return function y1(n){return new Vn(e=>{const t=n[sf]();if(Ut(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(ov(n))return function _1(n){return new Vn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(av(n))return function v1(n){return new Vn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Z_)})}(n);if(cv(n))return mv(n);if(hv(n))return function M1(n){return new Vn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(pv(n))return function x1(n){return mv(fv(n))}(n)}throw uv(n)}function mv(n){return new Vn(e=>{(function E1(n,e){var t,i,r,s;return function nv(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=sv(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function Xr(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function df(n,e,t=1/0){return Ut(e)?df((i,r)=>function ZC(n,e){return vo((t,i)=>{let r=0;t.subscribe(tl(i,s=>{i.next(n.call(e,s,r++))}))})}((s,o)=>e(i,s,r,o))(qr(n(i,r))),t):("number"==typeof e&&(t=e),vo((i,r)=>function S1(n,e,t,i,r,s,o,a){const l=[];let c=0,u=0,d=!1;const h=()=>{d&&!l.length&&!c&&e.complete()},f=y=>c<i?p(y):l.push(y),p=y=>{s&&e.next(y),c++;let g=!1;qr(t(y,u++)).subscribe(tl(e,m=>{r?.(m),s?f(m):e.next(m)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<i;){const m=l.shift();o?Xr(e,o,()=>p(m)):p(m)}h()}catch(m){e.error(m)}}))};return n.subscribe(tl(e,f,()=>{d=!0,h()})),()=>{a?.()}}(i,r,n,t)))}const gv=new Vn(n=>n.complete());function hf(n){return n[n.length-1]}function yv(n){return function T1(n){return n&&Ut(n.schedule)}(hf(n))?n.pop():void 0}function _v(n,e=0){return vo((t,i)=>{t.subscribe(tl(i,r=>Xr(i,n,()=>i.next(r),e),()=>Xr(i,n,()=>i.complete(),e),r=>Xr(i,n,()=>i.error(r),e)))})}function vv(n,e=0){return vo((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function Mv(n,e){if(!n)throw new Error("Iterable cannot be null");return new Vn(t=>{Xr(t,e,()=>{const i=n[Symbol.asyncIterator]();Xr(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function xv(n,e){return e?function N1(n,e){if(null!=n){if(lv(n))return function D1(n,e){return qr(n).pipe(vv(e),_v(e))}(n,e);if(ov(n))return function I1(n,e){return new Vn(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(av(n))return function C1(n,e){return qr(n).pipe(vv(e),_v(e))}(n,e);if(cv(n))return Mv(n,e);if(hv(n))return function R1(n,e){return new Vn(t=>{let i;return Xr(t,e,()=>{i=n[dv](),Xr(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>Ut(i?.return)&&i.return()})}(n,e);if(pv(n))return function P1(n,e){return Mv(fv(n),e)}(n,e)}throw uv(n)}(n,e):qr(n)}function Ev(n={}){const{connector:e=(()=>new jc),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,l,c=0,u=!1,d=!1;const h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=l=void 0,u=d=!1},p=()=>{const y=o;f(),y?.unsubscribe()};return vo((y,g)=>{c++,!d&&!u&&h();const m=l=l??e();g.add(()=>{c--,0===c&&!d&&!u&&(a=ff(p,r))}),m.subscribe(g),!o&&c>0&&(o=new el({next:v=>m.next(v),error:v=>{d=!0,h(),a=ff(f,t,v),m.error(v)},complete:()=>{u=!0,h(),a=ff(f,i),m.complete()}}),qr(y).subscribe(o))})(s)}}function ff(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new el({next:()=>{i.unsubscribe(),n()}});return qr(e(...t)).subscribe(i)}function U1(n,e){return n===e}function wt(n){for(let e in n)if(n[e]===wt)return e;throw Error("Could not find renamed property on target object.")}function ln(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(ln).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function mf(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const k1=wt({__forward_ref__:wt});function gf(n){return n.__forward_ref__=gf,n.toString=function(){return ln(this())},n}function Ge(n){return function yf(n){return"function"==typeof n&&n.hasOwnProperty(k1)&&n.__forward_ref__===gf}(n)?n():n}function _f(n){return n&&!!n.\u0275providers}class se extends Error{constructor(e,t){super(function qc(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function je(n){return"string"==typeof n?n:null==n?"":String(n)}function Xc(n,e){throw new se(-201,!1)}function pi(n,e){null==n&&function St(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Mt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Es(n){return{providers:n.providers||[],imports:n.imports||[]}}function Yc(n){return wv(n,Kc)||wv(n,Tv)}function wv(n,e){return n.hasOwnProperty(e)?n[e]:null}function bv(n){return n&&(n.hasOwnProperty(vf)||n.hasOwnProperty($1))?n[vf]:null}const Kc=wt({\u0275prov:wt}),vf=wt({\u0275inj:wt}),Tv=wt({ngInjectableDef:wt}),$1=wt({ngInjectorDef:wt});var ze=(()=>((ze=ze||{})[ze.Default=0]="Default",ze[ze.Host=1]="Host",ze[ze.Self=2]="Self",ze[ze.SkipSelf=4]="SkipSelf",ze[ze.Optional=8]="Optional",ze))();let Mf;function Hn(n){const e=Mf;return Mf=n,e}function Dv(n,e,t){const i=Yc(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&ze.Optional?null:void 0!==e?e:void Xc(ln(n))}const Tt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),nl={},xf="__NG_DI_FLAG__",Zc="ngTempTokenPath",q1=/\n/gm,Cv="__source";let Mo;function Kr(n){const e=Mo;return Mo=n,e}function K1(n,e=ze.Default){if(void 0===Mo)throw new se(-203,!1);return null===Mo?Dv(n,void 0,e):Mo.get(n,e&ze.Optional?null:void 0,e)}function Je(n,e=ze.Default){return(function Av(){return Mf}()||K1)(Ge(n),e)}function Pt(n,e=ze.Default){return Je(n,Jc(e))}function Jc(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Ef(n){const e=[];for(let t=0;t<n.length;t++){const i=Ge(n[t]);if(Array.isArray(i)){if(0===i.length)throw new se(900,!1);let r,s=ze.Default;for(let o=0;o<i.length;o++){const a=i[o],l=Z1(a);"number"==typeof l?-1===l?r=a.token:s|=l:r=a}e.push(Je(r,s))}else e.push(Je(i))}return e}function il(n,e){return n[xf]=e,n.prototype[xf]=e,n}function Z1(n){return n[xf]}function hr(n){return{toString:n}.toString()}var Wi=(()=>((Wi=Wi||{})[Wi.OnPush=0]="OnPush",Wi[Wi.Default=1]="Default",Wi))(),zn=(()=>{return(n=zn||(zn={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",zn;var n})();const fr={},_t=[],Qc=wt({\u0275cmp:wt}),Sf=wt({\u0275dir:wt}),wf=wt({\u0275pipe:wt}),Rv=wt({\u0275mod:wt}),pr=wt({\u0275fac:wt}),rl=wt({__NG_ELEMENT_ID__:wt}),Pv=wt({__NG_ENV_ID__:wt});function Nv(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}function bf(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];Ov(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function Lv(n){return 3===n||4===n||6===n}function Ov(n){return 64===n.charCodeAt(0)}function sl(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||Fv(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function Fv(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}const Uv="ng-template";function eI(n,e,t){let i=0,r=!0;for(;i<n.length;){let s=n[i++];if("string"==typeof s&&r){const o=n[i++];if(t&&"class"===s&&-1!==Nv(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function kv(n){return 4===n.type&&n.value!==Uv}function tI(n,e,t){return e===(4!==n.type||t?n.value:Uv)}function nI(n,e,t){let i=4;const r=n.attrs||[],s=function sI(n){for(let e=0;e<n.length;e++)if(Lv(n[e]))return e;return n.length}(r);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&i){if(i=2|1&i,""!==l&&!tI(n,l,t)||""===l&&1===e.length){if(Ai(i))return!1;o=!0}}else{const c=8&i?l:e[++a];if(8&i&&null!==n.attrs){if(!eI(n.attrs,c,t)){if(Ai(i))return!1;o=!0}continue}const d=iI(8&i?"class":l,r,kv(n),t);if(-1===d){if(Ai(i))return!1;o=!0;continue}if(""!==c){let h;h=d>s?"":r[d+1].toLowerCase();const f=8&i?h:null;if(f&&-1!==Nv(f,c,0)||2&i&&c!==h){if(Ai(i))return!1;o=!0}}}}else{if(!o&&!Ai(i)&&!Ai(l))return!1;if(o&&Ai(l))continue;o=!1,i=l|1&i}}return Ai(i)||o}function Ai(n){return 0==(1&n)}function iI(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function oI(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function Bv(n,e,t=!1){for(let i=0;i<e.length;i++)if(nI(n,e[i],t))return!0;return!1}function Vv(n,e){return n?":not("+e.trim()+")":e}function lI(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!Ai(o)&&(e+=Vv(s,r),r=""),i=o,s=s||!Ai(i);t++}return""!==r&&(e+=Vv(s,r)),e}function mr(n){return hr(()=>{const e=zv(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Wi.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,data:n.data||{},encapsulation:n.encapsulation||zn.Emulated,styles:n.styles||_t,_:null,schemas:n.schemas||null,tView:null,id:""};Gv(t);const i=n.dependencies;return t.directiveDefs=eu(i,!1),t.pipeDefs=eu(i,!0),t.id=function gI(n){let e=0;const t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const r of t)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(t),t})}function hI(n){return xt(n)||Sn(n)}function fI(n){return null!==n}function xo(n){return hr(()=>({type:n.type,bootstrap:n.bootstrap||_t,declarations:n.declarations||_t,imports:n.imports||_t,exports:n.exports||_t,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Hv(n,e){if(null==n)return fr;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}function mi(n){return hr(()=>{const e=zv(n);return Gv(e),e})}function xt(n){return n[Qc]||null}function Sn(n){return n[Sf]||null}function Wn(n){return n[wf]||null}function zv(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,exportAs:n.exportAs||null,standalone:!0===n.standalone,selectors:n.selectors||_t,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Hv(n.inputs,e),outputs:Hv(n.outputs)}}function Gv(n){n.features?.forEach(e=>e(n))}function eu(n,e){if(!n)return null;const t=e?Wn:hI;return()=>("function"==typeof n?n():n).map(i=>t(i)).filter(fI)}const cn=0,xe=1,Qe=2,Nt=3,Di=4,Ss=5,wn=6,Eo=7,kt=8,So=9,ws=10,Xe=11,al=12,Wv=13,wo=14,en=15,ll=16,bo=17,$i=18,cl=19,$v=20,Zr=21,gr=22,tu=23,nu=24,ft=25,Tf=1,jv=2,ji=7,iu=8,To=9,xn=11;function ni(n){return Array.isArray(n)&&"object"==typeof n[Tf]}function $n(n){return Array.isArray(n)&&!0===n[Tf]}function Af(n){return 0!=(4&n.flags)}function bs(n){return n.componentOffset>-1}function ru(n){return 1==(1&n.flags)}function Ci(n){return!!n.template}function Df(n){return 0!=(512&n[Qe])}function Ts(n,e){return n.hasOwnProperty(pr)?n[pr]:null}let xI=Tt.WeakRef??class MI{constructor(e){this.ref=e}deref(){return this.ref}},SI=0,qi=null,su=!1;function gn(n){const e=qi;return qi=n,e}class Zv{constructor(){this.id=SI++,this.ref=function EI(n){return new xI(n)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[e,t]of this.producers){const i=t.producerNode.deref();if(void 0!==i&&t.atTrackingVersion===this.trackingVersion){if(i.producerPollStatus(t.seenValueVersion))return!0}else this.producers.delete(e),i?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const e=su;su=!0;try{for(const[t,i]of this.consumers){const r=i.consumerNode.deref();void 0!==r&&r.trackingVersion===i.atTrackingVersion?r.onConsumerDependencyMayHaveChanged():(this.consumers.delete(t),r?.producers.delete(this.id))}}finally{su=e}}producerAccessed(){if(su)throw new Error("");if(null===qi)return;let e=qi.producers.get(this.id);void 0===e?(e={consumerNode:qi.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:qi.trackingVersion},qi.producers.set(this.id,e),this.consumers.set(qi.id,e)):(e.seenValueVersion=this.valueVersion,e.atTrackingVersion=qi.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==qi?.consumerAllowSignalWrites}producerPollStatus(e){return this.valueVersion!==e||(this.onProducerUpdateValueVersion(),this.valueVersion!==e)}}let Jv=null;const e0=()=>{};class AI extends Zv{constructor(e,t,i){super(),this.watch=e,this.schedule=t,this.dirty=!1,this.cleanupFn=e0,this.registerOnCleanup=r=>{this.cleanupFn=r},this.consumerAllowSignalWrites=i}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const e=gn(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=e0,this.watch(this.registerOnCleanup)}finally{gn(e)}}cleanup(){this.cleanupFn()}}class DI{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function t0(n){return n.type.prototype.ngOnChanges&&(n.setInput=II),CI}function CI(){const n=r0(this),e=n?.current;if(e){const t=n.previous;if(t===fr)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function II(n,e,t,i){const r=this.declaredInputs[t],s=r0(n)||function RI(n,e){return n[n0]=e}(n,{previous:fr,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[r];o[r]=new DI(l&&l.currentValue,e,a===fr),n[i]=e}const n0="__ngSimpleChanges__";function r0(n){return n[n0]||null}const Xi=function(n,e,t){};function It(n){for(;Array.isArray(n);)n=n[cn];return n}function jn(n,e){return It(e[n.index])}function a0(n,e){return n.data[e]}function qn(n,e){const t=e[n];return ni(t)?t:t[cn]}function uu(n){return 128==(128&n[Qe])}function Jr(n,e){return null==e?null:n[e]}function l0(n){n[bo]=0}function UI(n){1024&n[Qe]||(n[Qe]|=1024,u0(n,1))}function c0(n){1024&n[Qe]&&(n[Qe]&=-1025,u0(n,-1))}function u0(n,e){let t=n[Nt];if(null===t)return;t[Ss]+=e;let i=t;for(t=t[Nt];null!==t&&(1===e&&1===i[Ss]||-1===e&&0===i[Ss]);)t[Ss]+=e,i=t,t=t[Nt]}const He={lFrame:x0(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function f0(){return He.bindingsEnabled}function ee(){return He.lFrame.lView}function gt(){return He.lFrame.tView}function En(){let n=p0();for(;null!==n&&64===n.type;)n=n.parent;return n}function p0(){return He.lFrame.currentTNode}function Yi(n,e){const t=He.lFrame;t.currentTNode=n,t.isParent=e}function Lf(){return He.lFrame.isParent}function Co(){return He.lFrame.bindingIndex++}function ZI(n,e){const t=He.lFrame;t.bindingIndex=t.bindingRootIndex=n,Ff(e)}function Ff(n){He.lFrame.currentDirectiveIndex=n}function _0(){return He.lFrame.currentQueryIndex}function kf(n){He.lFrame.currentQueryIndex=n}function QI(n){const e=n[xe];return 2===e.type?e.declTNode:1===e.type?n[wn]:null}function v0(n,e,t){if(t&ze.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&ze.Host||(r=QI(s),null===r||(s=s[wo],10&r.type))););if(null===r)return!1;e=r,n=s}const i=He.lFrame=M0();return i.currentTNode=e,i.lView=n,!0}function Bf(n){const e=M0(),t=n[xe];He.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function M0(){const n=He.lFrame,e=null===n?null:n.child;return null===e?x0(n):e}function x0(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function E0(){const n=He.lFrame;return He.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const S0=E0;function Vf(){const n=E0();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Pn(){return He.lFrame.selectedIndex}function As(n){He.lFrame.selectedIndex=n}let b0=!0;function du(){return b0}function Qr(n){b0=n}function hu(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),l&&(n.viewHooks??=[]).push(-t,l),c&&((n.viewHooks??=[]).push(t,c),(n.viewCheckHooks??=[]).push(t,c)),null!=u&&(n.destroyHooks??=[]).push(t,u)}}function fu(n,e,t){T0(n,e,3,t)}function pu(n,e,t,i){(3&n[Qe])===t&&T0(n,e,t,i)}function Hf(n,e){let t=n[Qe];(3&t)===e&&(t&=4095,t+=1,n[Qe]=t)}function T0(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let l=void 0!==i?65535&n[bo]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=i&&a>=i)break}else e[l]<0&&(n[bo]+=65536),(a<s||-1==s)&&(aR(n,t,e,l),n[bo]=(4294901760&n[bo])+l+2),l++}function A0(n,e){Xi(4,n,e);const t=gn(null);try{e.call(n)}finally{gn(t),Xi(5,n,e)}}function aR(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];r?n[Qe]>>12<n[bo]>>16&&(3&n[Qe])===e&&(n[Qe]+=4096,A0(a,s)):A0(a,s)}const Io=-1;class hl{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function D0(n){return n!==Io}function mu(n){return 32767&n}function gu(n,e){let t=function dR(n){return n>>16}(n),i=e;for(;t>0;)i=i[wo],t--;return i}let Gf=!0;function yu(n){const e=Gf;return Gf=n,e}const C0=255,I0=5;let hR=0;const Ki={};function _u(n,e){const t=R0(n,e);if(-1!==t)return t;const i=e[xe];i.firstCreatePass&&(n.injectorIndex=e.length,Wf(i.data,n),Wf(e,null),Wf(i.blueprint,null));const r=$f(n,e),s=n.injectorIndex;if(D0(r)){const o=mu(r),a=gu(r,e),l=a[xe].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=r,s}function Wf(n,e){n.push(0,0,0,0,0,0,0,0,e)}function R0(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function $f(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=k0(r),null===i)return Io;if(t++,r=r[wo],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return Io}function jf(n,e,t){!function fR(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(rl)&&(i=t[rl]),null==i&&(i=t[rl]=hR++);const r=i&C0;e.data[n+(r>>I0)]|=1<<r}(n,e,t)}function P0(n,e,t){if(t&ze.Optional||void 0!==n)return n;Xc()}function N0(n,e,t,i){if(t&ze.Optional&&void 0===i&&(i=null),!(t&(ze.Self|ze.Host))){const r=n[So],s=Hn(void 0);try{return r?r.get(e,i,t&ze.Optional):Dv(e,i,t&ze.Optional)}finally{Hn(s)}}return P0(i,0,t)}function L0(n,e,t,i=ze.Default,r){if(null!==n){if(2048&e[Qe]&&!(i&ze.Self)){const o=function vR(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&2048&o[Qe]&&!(512&o[Qe]);){const a=O0(s,o,t,i|ze.Self,Ki);if(a!==Ki)return a;let l=s.parent;if(!l){const c=o[$v];if(c){const u=c.get(t,Ki,i);if(u!==Ki)return u}l=k0(o),o=o[wo]}s=l}return r}(n,e,t,i,Ki);if(o!==Ki)return o}const s=O0(n,e,t,i,Ki);if(s!==Ki)return s}return N0(e,t,i,r)}function O0(n,e,t,i,r){const s=function gR(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(rl)?n[rl]:void 0;return"number"==typeof e?e>=0?e&C0:yR:e}(t);if("function"==typeof s){if(!v0(e,n,i))return i&ze.Host?P0(r,0,i):N0(e,t,i,r);try{const o=s(i);if(null!=o||i&ze.Optional)return o;Xc()}finally{S0()}}else if("number"==typeof s){let o=null,a=R0(n,e),l=Io,c=i&ze.Host?e[en][wn]:null;for((-1===a||i&ze.SkipSelf)&&(l=-1===a?$f(n,e):e[a+8],l!==Io&&U0(i,!1)?(o=e[xe],a=mu(l),e=gu(l,e)):a=-1);-1!==a;){const u=e[xe];if(F0(s,a,u.data)){const d=mR(a,e,t,o,i,c);if(d!==Ki)return d}l=e[a+8],l!==Io&&U0(i,e[xe].data[a+8]===c)&&F0(s,a,e)?(o=u,a=mu(l),e=gu(l,e)):a=-1}}return r}function mR(n,e,t,i,r,s){const o=e[xe],a=o.data[n+8],u=vu(a,o,t,null==i?bs(a)&&Gf:i!=o&&0!=(3&a.type),r&ze.Host&&s===a);return null!==u?Ds(e,o,u,a):Ki}function vu(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,l=n.directiveStart,u=s>>20,h=r?a+u:n.directiveEnd;for(let f=i?a:a+u;f<h;f++){const p=o[f];if(f<l&&t===p||f>=l&&p.type===t)return f}if(r){const f=o[l];if(f&&Ci(f)&&f.type===t)return l}return null}function Ds(n,e,t,i){let r=n[t];const s=e.data;if(function lR(n){return n instanceof hl}(r)){const o=r;o.resolving&&function B1(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new se(-200,`Circular dependency in DI detected for ${n}${t}`)}(function Et(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():je(n)}(s[t]));const a=yu(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Hn(o.injectImpl):null;v0(n,i,ze.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function oR(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=t0(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}r&&(t.preOrderHooks??=[]).push(0-n,r),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}(t,s[t],e)}finally{null!==l&&Hn(l),yu(a),o.resolving=!1,S0()}}return r}function F0(n,e,t){return!!(t[e+(n>>I0)]&1<<n)}function U0(n,e){return!(n&ze.Self||n&ze.Host&&e)}class Ro{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return L0(this._tNode,this._lView,e,Jc(i),t)}}function yR(){return new Ro(En(),ee())}function k0(n){const e=n[xe],t=e.type;return 2===t?e.declTNode:1===t?n[wn]:null}const No="__parameters__";function Oo(n,e,t){return hr(()=>{const i=function Yf(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;const o=new r(...s);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(No)?l[No]:Object.defineProperty(l,No,{value:[]})[No];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}function ml(n,e){n.forEach(t=>Array.isArray(t)?ml(t,e):e(t))}function V0(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Mu(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}const Jf=il(Oo("Optional"),8),Qf=il(Oo("SkipSelf"),4);function bu(n){return 128==(128&n.flags)}var Xn=(()=>((Xn=Xn||{})[Xn.Important=1]="Important",Xn[Xn.DashCase=2]="DashCase",Xn))();const rp=new Map;let XR=0;const op="__ngContext__";function bn(n,e){ni(e)?(n[op]=e[cl],function KR(n){rp.set(n[cl],n)}(e)):n[op]=e}let ap;function lp(n,e){return ap(n,e)}function vl(n){const e=n[Nt];return $n(e)?e[Nt]:e}function cp(n){return oM(n[al])}function up(n){return oM(n[Di])}function oM(n){for(;null!==n&&!$n(n);)n=n[Di];return n}function Bo(n,e,t,i,r){if(null!=i){let s,o=!1;$n(i)?s=i:ni(i)&&(o=!0,i=i[cn]);const a=It(i);0===n&&null!==t?null==r?dM(e,t,a):Cs(e,t,a,r||null,!0):1===n&&null!==t?Cs(e,t,a,r||null,!0):2===n?function Ru(n,e,t){const i=Cu(n,e);i&&function mP(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function _P(n,e,t,i,r){const s=t[ji];s!==It(t)&&Bo(e,n,i,s,r);for(let a=xn;a<t.length;a++){const l=t[a];xl(l[xe],l,n,e,i,s)}}(e,n,s,t,r)}}function Du(n,e,t){return n.createElement(e,t)}function lM(n,e){const t=n[To],i=t.indexOf(e);c0(e),t.splice(i,1)}function hp(n,e){if(n.length<=xn)return;const t=xn+e,i=n[t];if(i){const r=i[ll];null!==r&&r!==n&&lM(r,i),e>0&&(n[t-1][Di]=i[Di]);const s=Mu(n,xn+e);!function aP(n,e){xl(n,e,e[Xe],2,null,null),e[cn]=null,e[wn]=null}(i[xe],i);const o=s[$i];null!==o&&o.detachView(s[xe]),i[Nt]=null,i[Di]=null,i[Qe]&=-129}return i}function cM(n,e){if(!(256&e[Qe])){const t=e[Xe];e[tu]?.destroy(),e[nu]?.destroy(),t.destroyNode&&xl(n,e,t,3,null,null),function uP(n){let e=n[al];if(!e)return fp(n[xe],n);for(;e;){let t=null;if(ni(e))t=e[al];else{const i=e[xn];i&&(t=i)}if(!t){for(;e&&!e[Di]&&e!==n;)ni(e)&&fp(e[xe],e),e=e[Nt];null===e&&(e=n),ni(e)&&fp(e[xe],e),t=e&&e[Di]}e=t}}(e)}}function fp(n,e){if(!(256&e[Qe])){e[Qe]&=-129,e[Qe]|=256,function pP(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof hl)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],l=s[o+1];Xi(4,a,l);try{l.call(a)}finally{Xi(5,a,l)}}else{Xi(4,r,s);try{s.call(r)}finally{Xi(5,r,s)}}}}}(n,e),function fP(n,e){const t=n.cleanup,i=e[Eo];if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?i[o]():i[-o].unsubscribe(),s+=2}else t[s].call(i[t[s+1]]);null!==i&&(e[Eo]=null);const r=e[Zr];if(null!==r){e[Zr]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(n,e),1===e[xe].type&&e[Xe].destroy();const t=e[ll];if(null!==t&&$n(e[Nt])){t!==e[Nt]&&lM(t,e);const i=e[$i];null!==i&&i.detachView(n)}!function ZR(n){rp.delete(n[cl])}(e)}}function pp(n,e,t){return function uM(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[cn];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=n.data[i.directiveStart+r];if(s===zn.None||s===zn.Emulated)return null}return jn(i,t)}}(n,e.parent,t)}function Cs(n,e,t,i,r){n.insertBefore(e,t,i,r)}function dM(n,e,t){n.appendChild(e,t)}function hM(n,e,t,i,r){null!==i?Cs(n,e,t,i,r):dM(n,e,t)}function Cu(n,e){return n.parentNode(e)}let mp,vp,mM=function pM(n,e,t){return 40&n.type?jn(n,t):null};function Iu(n,e,t,i){const r=pp(n,i,e),s=e[Xe],a=function fM(n,e,t){return mM(n,e,t)}(i.parent||e[wn],i,e);if(null!=r)if(Array.isArray(t))for(let l=0;l<t.length;l++)hM(s,r,t[l],a,!1);else hM(s,r,t,a,!1);void 0!==mp&&mp(s,i,e,t,r)}function Ml(n,e){if(null!==e){const t=e.type;if(3&t)return jn(e,n);if(4&t)return gp(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Ml(n,i);{const r=n[e.index];return $n(r)?gp(-1,r):It(r)}}if(32&t)return lp(e,n)()||It(n[e.index]);{const i=yM(n,e);return null!==i?Array.isArray(i)?i[0]:Ml(vl(n[en]),i):Ml(n,e.next)}}return null}function yM(n,e){return null!==e?n[en][wn].projection[e.projection]:null}function gp(n,e){const t=xn+n+1;if(t<e.length){const i=e[t],r=i[xe].firstChild;if(null!==r)return Ml(i,r)}return e[ji]}function yp(n,e,t,i,r,s,o){for(;null!=t;){const a=i[t.index],l=t.type;if(o&&0===e&&(a&&bn(It(a),i),t.flags|=2),32!=(32&t.flags))if(8&l)yp(n,e,t.child,i,r,s,!1),Bo(e,n,r,a,s);else if(32&l){const c=lp(t,i);let u;for(;u=c();)Bo(e,n,r,u,s);Bo(e,n,r,a,s)}else 16&l?vM(n,e,i,t,r,s):Bo(e,n,r,a,s);t=o?t.projectionNext:t.next}}function xl(n,e,t,i,r,s){yp(t,i,n.firstChild,e,r,s,!1)}function vM(n,e,t,i,r,s){const o=t[en],l=o[wn].projection[i.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)Bo(e,n,r,l[c],s);else{let c=l;const u=o[Nt];bu(i)&&(c.flags|=128),yp(n,e,c,u,r,s,!0)}}function MM(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function xM(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&bf(n,e,i),null!==r&&MM(n,e,r),null!==s&&function MP(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}class Ye{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Mt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Ou=new Ye("ENVIRONMENT_INITIALIZER"),LM=new Ye("INJECTOR",-1),OM=new Ye("INJECTOR_DEF_TYPES");class FM{get(e,t=nl){if(t===nl){const i=new Error(`NullInjectorError: No provider for ${ln(e)}!`);throw i.name="NullInjectorError",i}return t}}function XP(...n){return{\u0275providers:kM(0,n),\u0275fromNgModule:!0}}function kM(n,...e){const t=[],i=new Set;let r;return ml(e,s=>{const o=s;bp(o,t,[],i)&&(r||=[],r.push(o))}),void 0!==r&&BM(r,t),t}function BM(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];Tp(r,s=>{e.push(s)})}}function bp(n,e,t,i){if(!(n=Ge(n)))return!1;let r=null,s=bv(n);const o=!s&&xt(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const l=n.ngModule;if(s=bv(l),!s)return!1;r=l}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)bp(c,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;i.add(r);try{ml(s.imports,u=>{bp(u,e,t,i)&&(c||=[],c.push(u))})}finally{}void 0!==c&&BM(c,e)}if(!a){const c=Ts(r)||(()=>new r);e.push({provide:r,useFactory:c,deps:_t},{provide:OM,useValue:r,multi:!0},{provide:Ou,useValue:()=>Je(r),multi:!0})}const l=s.providers;null==l||a||Tp(l,u=>{e.push(u)})}}return r!==n&&void 0!==n.providers}function Tp(n,e){for(let t of n)_f(t)&&(t=t.\u0275providers),Array.isArray(t)?Tp(t,e):e(t)}const YP=wt({provide:String,useValue:wt});function Ap(n){return null!==n&&"object"==typeof n&&YP in n}function Is(n){return"function"==typeof n}const Dp=new Ye("Set Injector scope."),Fu={},ZP={};let Cp;function Uu(){return void 0===Cp&&(Cp=new FM),Cp}class Ho{}class Ip extends Ho{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Pp(e,o=>this.processProvider(o)),this.records.set(LM,zo(void 0,this)),r.has("environment")&&this.records.set(Ho,zo(void 0,this));const s=this.records.get(Dp);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(OM.multi,_t,ze.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of e)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const t=Kr(this),i=Hn(void 0);try{return e()}finally{Kr(t),Hn(i)}}get(e,t=nl,i=ze.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(Pv))return e[Pv](this);i=Jc(i);const r=Kr(this),s=Hn(void 0);try{if(!(i&ze.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function nN(n){return"function"==typeof n||"object"==typeof n&&n instanceof Ye}(e)&&Yc(e);a=l&&this.injectableDefInScope(l)?zo(Rp(e),Fu):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(i&ze.Self?Uu():this.parent).get(e,t=i&ze.Optional&&t===nl?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[Zc]=o[Zc]||[]).unshift(ln(e)),r)throw o;return function J1(n,e,t,i){const r=n[Zc];throw e[Cv]&&r.unshift(e[Cv]),n.message=function Q1(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=ln(e);if(Array.isArray(e))r=e.map(ln).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):ln(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(q1,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[Zc]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{Hn(s),Kr(r)}}resolveInjectorInitializers(){const e=Kr(this),t=Hn(void 0);try{const i=this.get(Ou.multi,_t,ze.Self);for(const r of i)r()}finally{Kr(e),Hn(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(ln(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processProvider(e){let t=Is(e=Ge(e))?e:Ge(e&&e.provide);const i=function QP(n){return Ap(n)?zo(void 0,n.useValue):zo(function zM(n,e,t){let i;if(Is(n)){const r=Ge(n);return Ts(r)||Rp(r)}if(Ap(n))i=()=>Ge(n.useValue);else if(function HM(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Ef(n.deps||[]));else if(function VM(n){return!(!n||!n.useExisting)}(n))i=()=>Je(Ge(n.useExisting));else{const r=Ge(n&&(n.useClass||n.provide));if(!function eN(n){return!!n.deps}(n))return Ts(r)||Rp(r);i=()=>new r(...Ef(n.deps))}return i}(n),Fu)}(e);if(Is(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=zo(void 0,Fu,!0),r.factory=()=>Ef(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===Fu&&(t.value=ZP,t.value=t.factory()),"object"==typeof t.value&&t.value&&function tN(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Ge(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Rp(n){const e=Yc(n),t=null!==e?e.factory:Ts(n);if(null!==t)return t;if(n instanceof Ye)throw new se(204,!1);if(n instanceof Function)return function JP(n){const e=n.length;if(e>0)throw function gl(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new se(204,!1);const t=function W1(n){return n&&(n[Kc]||n[Tv])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new se(204,!1)}function zo(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Pp(n,e){for(const t of n)Array.isArray(t)?Pp(t,e):t&&_f(t)?Pp(t.\u0275providers,e):e(t)}const ku=new Ye("AppId",{providedIn:"root",factory:()=>iN}),iN="ng",GM=new Ye("Platform Initializer"),Go=new Ye("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),WM=new Ye("AnimationModuleType"),$M=new Ye("CSP nonce",{providedIn:"root",factory:()=>function El(){if(void 0!==vp)return vp;if(typeof document<"u")return document;throw new se(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let qM=(n,e)=>null;function XM(n,e){return qM(n,e)}class hN{}class ZM{}class pN{resolveComponentFactory(e){throw function fN(n){const e=Error(`No component factory found for ${ln(n)}.`);return e.ngComponent=n,e}(e)}}let Gu=(()=>{class n{}return n.NULL=new pN,n})();function mN(){return Wo(En(),ee())}function Wo(n,e){return new ts(jn(n,e))}let ts=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=mN,n})();function gN(n){return n instanceof ts?n.nativeElement:n}class Cl{}let _N=(()=>{class n{}return n.\u0275prov=Mt({token:n,providedIn:"root",factory:()=>null}),n})();class Gp{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const vN=new Gp("16.0.4"),Wp={};function Il(n){for(;n;){n[Qe]|=64;const e=vl(n);if(Df(n)&&!e)return n;n=e}return null}function $p(n){return n.ngOriginalError}class Rs{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&$p(e);for(;t&&$p(t);)t=$p(t);return t||null}}const nx=new Ye("",{providedIn:"root",factory:()=>!1});class ax extends Zv{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(e){this._lView=e}onConsumerDependencyMayHaveChanged(){Il(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(e,t,i){const r=gn(this);this.trackingVersion++;try{e(t,i)}finally{gn(r)}}destroy(){this.trackingVersion++}}let $u=null;function lx(){return $u??=new ax,$u}function cx(n,e){return n[e]??lx()}function ux(n,e){const t=lx();t.hasReadASignal&&(n[e]=$u,t.lView=n,$u=new ax)}const Ke={};function dn(n){dx(gt(),ee(),Pn()+n,!1)}function dx(n,e,t,i){if(!i)if(3==(3&e[Qe])){const s=n.preOrderCheckHooks;null!==s&&fu(e,s,t)}else{const s=n.preOrderHooks;null!==s&&pu(e,s,0,t)}As(t)}function mx(n,e=null,t=null,i){const r=gx(n,e,t,i);return r.resolveInjectorInitializers(),r}function gx(n,e=null,t=null,i,r=new Set){const s=[t||_t,XP(n)];return i=i||("object"==typeof n?void 0:ln(n)),new Ip(s,e||Uu(),i||null,r)}let Ps=(()=>{class n{static create(t,i){if(Array.isArray(t))return mx({name:""},i,t,"");{const r=t.name??"";return mx({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=nl,n.NULL=new FM,n.\u0275prov=Mt({token:n,providedIn:"any",factory:()=>Je(LM)}),n.__NG_ELEMENT_ID__=-1,n})();function nt(n,e=ze.Default){const t=ee();return null===t?Je(n,e):L0(En(),t,Ge(n),e)}function ju(n,e,t,i,r,s,o,a,l,c,u){const d=e.blueprint.slice();return d[cn]=r,d[Qe]=140|i,(null!==c||n&&2048&n[Qe])&&(d[Qe]|=2048),l0(d),d[Nt]=d[wo]=n,d[kt]=t,d[ws]=o||n&&n[ws],d[Xe]=a||n&&n[Xe],d[So]=l||n&&n[So]||null,d[wn]=s,d[cl]=function YR(){return XR++}(),d[gr]=u,d[$v]=c,d[en]=2==e.type?n[en]:d,d}function jo(n,e,t,i,r){let s=n.data[e];if(null===s)s=function jp(n,e,t,i,r){const s=p0(),o=Lf(),l=n.data[e]=function HN(n,e,t,i,r,s){let o=e?e.injectorIndex:-1,a=0;return function Do(){return null!==He.skipHydrationRootTNode}()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l,l.prev=s)),l}(n,e,t,i,r),function KI(){return He.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function dl(){const n=He.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Yi(s,!0),s}function Rl(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function yx(n,e,t,i,r){const s=cx(e,tu),o=Pn(),a=2&i;try{if(As(-1),a&&e.length>ft&&dx(n,e,ft,!1),Xi(a?2:0,r),a)s.runInContext(t,i,r);else{const c=gn(null);try{t(i,r)}finally{gn(c)}}}finally{a&&null===e[tu]&&ux(e,tu),As(o),Xi(a?3:1,r)}}function qp(n,e,t){if(Af(e)){const i=gn(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{gn(i)}}}function Xp(n,e,t){f0()&&(function XN(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;bs(t)&&function tL(n,e,t){const i=jn(e,n),o=qu(n,ju(n,_x(t),null,t.onPush?64:16,i,e,null,n[ws].rendererFactory.createRenderer(i,t),null,null,null));n[e.index]=o}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||_u(t,e),bn(i,e);const o=t.initialInputs;for(let a=r;a<s;a++){const l=n.data[a],c=Ds(e,n,a,t);bn(c,e),null!==o&&nL(0,a-r,c,l,0,o),Ci(l)&&(qn(t.index,e)[kt]=Ds(e,n,a,t))}}(n,e,t,jn(t,e)),64==(64&t.flags)&&Sx(n,e,t))}function Yp(n,e,t=jn){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}function _x(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Kp(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function Kp(n,e,t,i,r,s,o,a,l,c,u){const d=ft+i,h=d+r,f=function ON(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:Ke);return t}(d,h),p="function"==typeof c?c():c;return f[xe]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1,ssrId:u}}let vx=n=>null;function Mx(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const s=n[r];null===i?xx(t,e,r,s):i.hasOwnProperty(r)&&xx(t,e,i[r],s)}return t}function xx(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function Zp(n,e,t,i){if(f0()){const r=null===i?null:{"":-1},s=function KN(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(Bv(e,o.selectors,!1))if(i||(i=[]),Ci(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o),Jp(n,e,a.length)}else i.unshift(o),Jp(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return null===i?null:[i,r]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&Ex(n,e,t,o,r,a),r&&function ZN(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new se(-301,!1);i.push(e[r],s)}}}(t,i,r)}t.mergedAttrs=sl(t.mergedAttrs,t.attrs)}function Ex(n,e,t,i,r,s){for(let c=0;c<i.length;c++)jf(_u(t,e),n,i[c].type);!function QN(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let c=0;c<i.length;c++){const u=i[c];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,l=Rl(n,e,i.length,null);for(let c=0;c<i.length;c++){const u=i[c];t.mergedAttrs=sl(t.mergedAttrs,u.hostAttrs),eL(n,t,e,l,u),JN(l,u,r),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),l++}!function zN(n,e,t){const r=e.directiveEnd,s=n.data,o=e.attrs,a=[];let l=null,c=null;for(let u=e.directiveStart;u<r;u++){const d=s[u],h=t?t.get(d):null,p=h?h.outputs:null;l=Mx(d.inputs,u,l,h?h.inputs:null),c=Mx(d.outputs,u,c,p);const y=null===l||null===o||kv(e)?null:iL(l,u,o);a.push(y)}null!==l&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=c}(n,t,s)}function Sx(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function JI(){return He.lFrame.currentDirectiveIndex}();try{As(s);for(let a=i;a<r;a++){const l=n.data[a],c=e[a];Ff(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&YN(l,c)}}finally{As(-1),Ff(o)}}function YN(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function Jp(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function JN(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Ci(e)&&(t[""]=n)}}function eL(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=Ts(r.type)),o=new hl(s,Ci(r),nt);n.blueprint[i]=o,t[i]=o,function jN(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function qN(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,Rl(n,t,r.hostVars,Ke),r)}function nL(n,e,t,i,r,s){const o=s[e];if(null!==o)for(let a=0;a<o.length;)wx(i,t,o[a++],o[a++],o[a++])}function wx(n,e,t,i,r){const s=gn(null);try{null!==n.setInput?n.setInput(e,r,t,i):e[i]=r}finally{gn(s)}}function iL(n,e,t){let i=null,r=0;for(;r<t.length;){const s=t[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===i&&(i=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){i.push(s,o[a+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function bx(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null,null]}function Tx(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const s=t[i+1];if(-1!==s){const o=n.data[s];kf(t[i]),o.contentQueries(2,e[s],s)}}}function qu(n,e){return n[al]?n[Wv][Di]=e:n[al]=e,n[Wv]=e,e}function em(n,e,t){kf(0);const i=gn(null);try{e(n,t)}finally{gn(i)}}function tm(n,e,t,i,r){for(let s=0;s<t.length;){const o=t[s++],a=t[s++];wx(n.data[o],e[o],i,a,r)}}function xr(n,e,t){const i=function cu(n,e){return It(e[n])}(e,n);!function aM(n,e,t){n.setValue(e,t)}(n[Xe],i,t)}function rL(n,e){const t=qn(e,n),i=t[xe];!function sL(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(i,t);const r=t[cn];null!==r&&null===t[gr]&&(t[gr]=XM(r,t[So])),nm(i,t,t[kt])}function nm(n,e,t){Bf(e);try{const i=n.viewQuery;null!==i&&em(1,i,t);const r=n.template;null!==r&&yx(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Tx(n,e),n.staticViewQueries&&em(2,n.viewQuery,t);const s=n.components;null!==s&&function oL(n,e){for(let t=0;t<e.length;t++)rL(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[Qe]&=-5,Vf()}}let Rx=(()=>{class n{constructor(){this.all=new Set,this.queue=new Map}create(t,i,r){const s=typeof Zone>"u"?null:Zone.current,o=new AI(t,c=>{this.all.has(c)&&this.queue.set(c,s)},r);let a;this.all.add(o),o.notify();const l=()=>{o.cleanup(),a?.(),this.all.delete(o),this.queue.delete(o)};return a=i?.onDestroy(l),{destroy:l}}flush(){if(0!==this.queue.size)for(const[t,i]of this.queue)this.queue.delete(t),i?i.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}}return n.\u0275prov=Mt({token:n,providedIn:"root",factory:()=>new n}),n})();function Xu(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=mf(r,a):2==s&&(i=mf(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function Pl(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(It(s)),$n(s)){for(let a=xn;a<s.length;a++){const l=s[a],c=l[xe].firstChild;null!==c&&Pl(l[xe],l,c,i)}s[ji]!==s[cn]&&i.push(s[ji])}const o=t.type;if(8&o)Pl(n,e,t.child,i);else if(32&o){const a=lp(t,e);let l;for(;l=a();)i.push(l)}else if(16&o){const a=yM(e,t);if(Array.isArray(a))i.push(...a);else{const l=vl(e[en]);Pl(l[xe],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function Yu(n,e,t,i=!0){const r=e[ws].rendererFactory;r.begin&&r.begin();try{Ku(n,e,n.template,t)}catch(o){throw i&&function Ix(n,e){const t=n[So],i=t?t.get(Rs,null):null;i&&i.handleError(e)}(e,o),o}finally{r.end&&r.end(),e[ws].effectManager?.flush()}}function Ku(n,e,t,i){const r=e[Qe];if(256!=(256&r)){e[ws].effectManager?.flush(),Bf(e);try{l0(e),function g0(n){return He.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&yx(n,e,t,2,i);const o=3==(3&r);if(o){const c=n.preOrderCheckHooks;null!==c&&fu(e,c,null)}else{const c=n.preOrderHooks;null!==c&&pu(e,c,0,null),Hf(e,0)}if(function hL(n){for(let e=cp(n);null!==e;e=up(e)){if(!e[jv])continue;const t=e[To];for(let i=0;i<t.length;i++){UI(t[i])}}}(e),function dL(n){for(let e=cp(n);null!==e;e=up(e))for(let t=xn;t<e.length;t++){const i=e[t],r=i[xe];uu(i)&&Ku(r,i,r.template,i[kt])}}(e),null!==n.contentQueries&&Tx(n,e),o){const c=n.contentCheckHooks;null!==c&&fu(e,c)}else{const c=n.contentHooks;null!==c&&pu(e,c,1),Hf(e,1)}!function LN(n,e){const t=n.hostBindingOpCodes;if(null===t)return;const i=cx(e,nu);try{for(let r=0;r<t.length;r++){const s=t[r];if(s<0)As(~s);else{const o=s,a=t[++r],l=t[++r];ZI(a,o),i.runInContext(l,2,e[o])}}}finally{null===e[nu]&&ux(e,nu),As(-1)}}(n,e);const a=n.components;null!==a&&function pL(n,e){for(let t=0;t<e.length;t++)fL(n,e[t])}(e,a);const l=n.viewQuery;if(null!==l&&em(2,l,i),o){const c=n.viewCheckHooks;null!==c&&fu(e,c)}else{const c=n.viewHooks;null!==c&&pu(e,c,2),Hf(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[Qe]&=-73,c0(e)}finally{Vf()}}}function fL(n,e){const t=qn(e,n);if(uu(t)){const i=t[xe];80&t[Qe]?Ku(i,t,i.template,t[kt]):t[Ss]>0&&im(t)}}function im(n){for(let i=cp(n);null!==i;i=up(i))for(let r=xn;r<i.length;r++){const s=i[r];if(uu(s))if(1024&s[Qe]){const o=s[xe];Ku(o,s,o.template,s[kt])}else s[Ss]>0&&im(s)}const t=n[xe].components;if(null!==t)for(let i=0;i<t.length;i++){const r=qn(t[i],n);uu(r)&&r[Ss]>0&&im(r)}}class Nl{get rootNodes(){const e=this._lView,t=e[xe];return Pl(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[kt]}set context(e){this._lView[kt]=e}get destroyed(){return 256==(256&this._lView[Qe])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[Nt];if($n(e)){const t=e[iu],i=t?t.indexOf(this):-1;i>-1&&(hp(e,i),Mu(t,i))}this._attachedToViewContainer=!1}cM(this._lView[xe],this._lView)}onDestroy(e){!function d0(n,e){if(256==(256&n[Qe]))throw new se(911,!1);null===n[Zr]&&(n[Zr]=[]),n[Zr].push(e)}(this._lView,e)}markForCheck(){Il(this._cdRefInjectingView||this._lView)}detach(){this._lView[Qe]&=-129}reattach(){this._lView[Qe]|=128}detectChanges(){Yu(this._lView[xe],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new se(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function cP(n,e){xl(n,e,e[Xe],2,null,null)}(this._lView[xe],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new se(902,!1);this._appRef=e}}class mL extends Nl{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Yu(e[xe],e,e[kt],!1)}checkNoChanges(){}get context(){return null}}class Px extends Gu{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=xt(e);return new Ll(t,this.ngModule)}}function Nx(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class yL{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=Jc(i);const r=this.injector.get(e,Wp,i);return r!==Wp||t===Wp?r:this.parentInjector.get(e,t,i)}}class Ll extends ZM{get inputs(){return Nx(this.componentDef.inputs)}get outputs(){return Nx(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function cI(n){return n.map(lI).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof Ho?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new yL(e,s):e,a=o.get(Cl,null);if(null===a)throw new se(407,!1);const u={rendererFactory:a,sanitizer:o.get(_N,null),effectManager:o.get(Rx,null)},d=a.createRenderer(null,this.componentDef),h=this.componentDef.selectors[0][0]||"div",f=i?function FN(n,e,t,i){const s=i.get(nx,!1)||t===zn.ShadowDom,o=n.selectRootElement(e,s);return function UN(n){vx(n)}(o),o}(d,i,this.componentDef.encapsulation,o):Du(d,h,function gL(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(h)),p=this.componentDef.onPush?576:528,y=Kp(0,null,null,1,0,null,null,null,null,null,null),g=ju(null,y,null,p,null,null,u,d,o,null,null);let m,v;Bf(g);try{const _=this.componentDef;let M,E=null;_.findHostDirectiveDefs?(M=[],E=new Map,_.findHostDirectiveDefs(_,M,E),M.push(_)):M=[_];const S=function vL(n,e){const t=n[xe],i=ft;return n[i]=e,jo(t,i,2,"#host",null)}(g,f),T=function ML(n,e,t,i,r,s,o){const a=r[xe];!function xL(n,e,t,i){for(const r of n)e.mergedAttrs=sl(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(Xu(e,e.mergedAttrs,!0),null!==t&&xM(i,t,e))}(i,n,e,o);let l=null;null!==e&&(l=XM(e,r[So]));const c=s.rendererFactory.createRenderer(e,t),u=ju(r,_x(t),null,t.onPush?64:16,r[n.index],n,s,c,null,null,l);return a.firstCreatePass&&Jp(a,n,i.length-1),qu(r,u),r[n.index]=u}(S,f,_,M,g,u,d);v=a0(y,ft),f&&function SL(n,e,t,i){if(i)bf(n,t,["ng-version",vN.full]);else{const{attrs:r,classes:s}=function uI(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!Ai(r))break;r=s}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&bf(n,t,r),s&&s.length>0&&MM(n,t,s.join(" "))}}(d,_,f,i),void 0!==t&&function wL(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s?Array.from(s):null)}}(v,this.ngContentSelectors,t),m=function EL(n,e,t,i,r,s){const o=En(),a=r[xe],l=jn(o,r);Ex(a,r,o,t,null,i);for(let u=0;u<t.length;u++)bn(Ds(r,a,o.directiveStart+u,o),r);Sx(a,r,o),l&&bn(l,r);const c=Ds(r,a,o.directiveStart+o.componentOffset,o);if(n[kt]=r[kt]=c,null!==s)for(const u of s)u(c,e);return qp(a,o,n),c}(T,_,M,E,g,[bL]),nm(y,g,null)}finally{Vf()}return new _L(this.componentType,m,Wo(v,g),g,v)}}class _L extends hN{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new mL(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const s=this._rootLView;tm(s[xe],s,r,e,t),this.previousInputValues.set(e,t),Il(qn(this._tNode.index,s))}}get injector(){return new Ro(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function bL(){const n=En();hu(ee()[xe],n)}function Zu(n){return!!function sm(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function Tn(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function ns(n,e,t,i,r,s,o,a){const l=ee(),c=gt(),u=n+ft,d=c.firstCreatePass?function eO(n,e,t,i,r,s,o,a,l){const c=e.consts,u=jo(e,n,4,o||null,Jr(c,a));Zp(e,t,u,Jr(c,l)),hu(e,u);const d=u.tView=Kp(2,u,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c,null);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,t,i,r,s,o):c.data[u];Yi(d,!1);const h=Jx(c,l,d,n);du()&&Iu(c,l,h,d),bn(h,l),qu(l,l[u]=bx(h,l,h,d)),ru(d)&&Xp(c,l,d),null!=o&&Yp(l,d,a)}let Jx=function Qx(n,e,t,i){return Qr(!0),e[Xe].createComment("")};function si(n,e,t){const i=ee();return Tn(i,Co(),e)&&function ri(n,e,t,i,r,s,o,a){const l=jn(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[i])?(tm(n,t,u,i,r),bs(e)&&function WN(n,e){const t=qn(e,n);16&t[Qe]||(t[Qe]|=64)}(t,e.index)):3&e.type&&(i=function GN(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,e.value||"",i):r,s.setProperty(l,i,r))}(gt(),function Lt(){const n=He.lFrame;return a0(n.tView,n.selectedIndex)}(),i,n,e,i[Xe],t,!1),si}function dm(n,e,t,i,r){const o=r?"class":"style";tm(n,t,e.inputs[o],o,i)}function J(n,e,t,i){const r=ee(),s=gt(),o=ft+n,a=r[Xe],l=s.firstCreatePass?function sO(n,e,t,i,r,s){const o=e.consts,l=jo(e,n,2,i,Jr(o,r));return Zp(e,t,l,Jr(o,s)),null!==l.attrs&&Xu(l,l.attrs,!1),null!==l.mergedAttrs&&Xu(l,l.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,l),l}(o,s,r,e,t,i):s.data[o],c=eE(s,r,l,a,e,n);r[o]=c;const u=ru(l);return Yi(l,!0),xM(a,c,l),32!=(32&l.flags)&&du()&&Iu(s,r,c,l),0===function BI(){return He.lFrame.elementDepthCount}()&&bn(c,r),function VI(){He.lFrame.elementDepthCount++}(),u&&(Xp(s,r,l),qp(s,l,r)),null!==i&&Yp(r,l),J}function ie(){let n=En();Lf()?function Of(){He.lFrame.isParent=!1}():(n=n.parent,Yi(n,!1));const e=n;(function zI(n){return He.skipHydrationRootTNode===n})(e)&&function jI(){He.skipHydrationRootTNode=null}(),function HI(){He.lFrame.elementDepthCount--}();const t=gt();return t.firstCreatePass&&(hu(t,n),Af(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function cR(n){return 0!=(8&n.flags)}(e)&&dm(t,e,ee(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function uR(n){return 0!=(16&n.flags)}(e)&&dm(t,e,ee(),e.stylesWithoutHost,!1),ie}function Bt(n,e,t,i){return J(n,e,t,i),ie(),Bt}let eE=(n,e,t,i,r,s)=>(Qr(!0),Du(i,r,function w0(){return He.lFrame.currentNamespace}()));function pm(n){return!!n&&"function"==typeof n.then}function iE(n){return!!n&&"function"==typeof n.subscribe}function le(n,e=""){const t=ee(),i=gt(),r=n+ft,s=i.firstCreatePass?jo(i,r,1,e,null):i.data[r],o=NE(i,t,s,e,n);t[r]=o,du()&&Iu(i,t,o,s),Yi(s,!1)}let NE=(n,e,t,i,r)=>(Qr(!0),function Au(n,e){return n.createText(e)}(e[Xe],i));function tr(n,e,t){const i=ee(),r=function Xo(n,e,t,i){return Tn(n,Co(),t)?e+je(t)+i:Ke}(i,n,e,t);return r!==Ke&&xr(i,Pn(),r),tr}const ra="en-US";let nS=ra;class sa{}class o2{}class Tm extends sa{constructor(e,t,i){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Px(this);const r=function ti(n,e){const t=n[Rv]||null;if(!t&&!0===e)throw new Error(`Type ${ln(n)} does not have '\u0275mod' property.`);return t}(e);this._bootstrapComponents=function Mr(n){return n instanceof Function?n():n}(r.bootstrap),this._r3Injector=gx(e,t,[{provide:sa,useValue:this},{provide:Gu,useValue:this.componentFactoryResolver},...i],ln(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Am extends o2{constructor(e){super(),this.moduleType=e}create(e){return new Tm(this.moduleType,e,[])}}function Cm(n){return e=>{setTimeout(n,void 0,e)}}const Er=class U2 extends jc{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const l=e;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=Cm(s),r&&(r=Cm(r)),o&&(o=Cm(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof Gi&&e.add(a),a}};function k2(){return this._results[Symbol.iterator]()}class Im{get changes(){return this._changes||(this._changes=new Er)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Im.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=k2)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=function gi(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function ER(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Sr=(()=>{class n{}return n.__NG_ELEMENT_ID__=H2,n})();const B2=Sr,V2=class extends B2{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t,null)}createEmbeddedViewImpl(e,t,i){const r=this._declarationTContainer.tView,s=ju(this._declarationLView,r,e,16,null,r.declTNode,null,null,null,t||null,i||null);s[ll]=this._declarationLView[this._declarationTContainer.index];const a=this._declarationLView[$i];return null!==a&&(s[$i]=a.createEmbeddedView(r)),nm(r,s,e),new Nl(s)}};function H2(){return ld(En(),ee())}function ld(n,e){return 4&n.type?new V2(e,n,Wo(n,e)):null}let nr=(()=>{class n{}return n.__NG_ELEMENT_ID__=X2,n})();function X2(){return $S(En(),ee())}const Y2=nr,GS=class extends Y2{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Wo(this._hostTNode,this._hostLView)}get injector(){return new Ro(this._hostTNode,this._hostLView)}get parentInjector(){const e=$f(this._hostTNode,this._hostLView);if(D0(e)){const t=gu(e,this._hostLView),i=mu(e);return new Ro(t[xe].data[i+8],t)}return new Ro(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=WS(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-xn}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const a=e.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(a,r,false),a}createComponent(e,t,i,r,s){const o=e&&!function pl(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const y=t||{};a=y.index,i=y.injector,r=y.projectableNodes,s=y.environmentInjector||y.ngModuleRef}const l=o?e:new Ll(xt(e)),c=i||this.parentInjector;if(!s&&null==l.ngModule){const g=(o?c:this.parentInjector).get(Ho,null);g&&(s=g)}xt(l.componentType??{});const f=l.create(c,r,null,s);return this.insertImpl(f.hostView,a,false),f}insert(e,t){return this.insertImpl(e,t,!1)}insertImpl(e,t,i){const r=e._lView,s=r[xe];if(function FI(n){return $n(n[Nt])}(r)){const l=this.indexOf(e);if(-1!==l)this.detach(l);else{const c=r[Nt],u=new GS(c,c[wn],c[Nt]);u.detach(u.indexOf(e))}}const o=this._adjustIndex(t),a=this._lContainer;if(function dP(n,e,t,i){const r=xn+i,s=t.length;i>0&&(t[r-1][Di]=e),i<s-xn?(e[Di]=t[r],V0(t,xn+i,e)):(t.push(e),e[Di]=null),e[Nt]=t;const o=e[ll];null!==o&&t!==o&&function hP(n,e){const t=n[To];e[en]!==e[Nt][Nt][en]&&(n[jv]=!0),null===t?n[To]=[e]:t.push(e)}(o,e);const a=e[$i];null!==a&&a.insertView(n),e[Qe]|=128}(s,r,a,o),!i){const l=gp(o,a),c=r[Xe],u=Cu(c,a[ji]);null!==u&&function lP(n,e,t,i,r,s){i[cn]=r,i[wn]=e,xl(n,i,t,1,r,s)}(s,a[wn],c,r,u,l)}return e.attachToViewContainerRef(),V0(Pm(a),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=WS(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=hp(this._lContainer,t);i&&(Mu(Pm(this._lContainer),t),cM(i[xe],i))}detach(e){const t=this._adjustIndex(e,-1),i=hp(this._lContainer,t);return i&&null!=Mu(Pm(this._lContainer),t)?new Nl(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function WS(n){return n[iu]}function Pm(n){return n[iu]||(n[iu]=[])}function $S(n,e){let t;const i=e[n.index];return $n(i)?t=i:(t=bx(i,e,null,n),e[n.index]=t,qu(e,t)),jS(t,e,n,i),new GS(t,n,e)}let jS=function qS(n,e,t,i){if(n[ji])return;let r;r=8&t.type?It(i):function K2(n,e){const t=n[Xe],i=t.createComment(""),r=jn(e,n);return Cs(t,Cu(t,r),i,function gP(n,e){return n.nextSibling(e)}(t,r),!1),i}(e,t),n[ji]=r};class Nm{constructor(e){this.queryList=e,this.matches=null}clone(){return new Nm(this.queryList)}setDirty(){this.queryList.setDirty()}}class Lm{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const o=t.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new Lm(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==tw(e,t).matches&&this.queries[t].setDirty()}}class XS{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class Om{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new Om(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Fm{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Fm(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,Q2(t,s)),this.matchTNodeWithReadOption(e,t,vu(t,e,s,!1,!1))}else i===Sr?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,vu(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===ts||r===nr||r===Sr&&4&t.type)this.addMatch(t.index,-2);else{const s=vu(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function Q2(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function tU(n,e,t,i){return-1===t?function eU(n,e){return 11&n.type?Wo(n,e):4&n.type?ld(n,e):null}(e,n):-2===t?function nU(n,e,t){return t===ts?Wo(e,n):t===Sr?ld(e,n):t===nr?$S(e,n):void 0}(n,e,i):Ds(n,n[xe],t,e)}function YS(n,e,t,i){const r=e[$i].queries[i];if(null===r.matches){const s=n.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:tU(e,s[c],o[l+1],t.metadata.read))}r.matches=a}return r.matches}function Um(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const o=YS(n,e,r,t);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)i.push(o[a/2]);else{const c=s[a+1],u=e[-l];for(let d=xn;d<u.length;d++){const h=u[d];h[ll]===h[Nt]&&Um(h[xe],h,c,i)}if(null!==u[To]){const d=u[To];for(let h=0;h<d.length;h++){const f=d[h];Um(f[xe],f,c,i)}}}}}return i}function KS(n){const e=ee(),t=gt(),i=_0();kf(i+1);const r=tw(t,i);if(n.dirty&&function OI(n){return 4==(4&n[Qe])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?Um(t,e,i,[]):YS(t,e,r,i);n.reset(s,gN),n.notifyOnChanges()}return!0}return!1}function ZS(n,e,t){const i=gt();i.firstCreatePass&&(function ew(n,e,t){null===n.queries&&(n.queries=new Om),n.queries.track(new Fm(e,t))}(i,new XS(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),function QS(n,e,t){const i=new Im(4==(4&t));(function VN(n,e,t,i){const r=function Ax(n){return n[Eo]||(n[Eo]=[])}(e);r.push(t),n.firstCreatePass&&function Dx(n){return n.cleanup||(n.cleanup=[])}(n).push(i,r.length-1)})(n,e,i,i.destroy),null===e[$i]&&(e[$i]=new Lm),e[$i].queries.push(new Nm(i))}(i,ee(),e)}function tw(n,e){return n.queries.getByIndex(e)}const AU=new Ye("Application Initializer");let zm=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.appInits=Pt(AU,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const r of this.appInits){const s=r();if(pm(s))t.push(s);else if(iE(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wr=new Ye("LocaleId",{providedIn:"root",factory:()=>Pt(wr,ze.Optional|ze.SkipSelf)||function CU(){return typeof $localize<"u"&&$localize.locale||ra}()});let RU=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new XC(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const OU=(()=>Promise.resolve(0))();function Gm(n){typeof Zone>"u"?OU.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}function xw(...n){}class Xt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Er(!1),this.onMicrotaskEmpty=new Er(!1),this.onStable=new Er(!1),this.onError=new Er(!1),typeof Zone>"u")throw new se(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function FU(){let n=Tt.requestAnimationFrame,e=Tt.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function BU(n){const e=()=>{!function kU(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Tt,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,$m(n),n.isCheckStableRunning=!0,Wm(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),$m(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,o,a)=>{try{return Ew(n),t.invokeTask(r,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),Sw(n)}},onInvoke:(t,i,r,s,o,a,l)=>{try{return Ew(n),t.invoke(r,s,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),Sw(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,$m(n),Wm(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Xt.isInAngularZone())throw new se(909,!1)}static assertNotInAngularZone(){if(Xt.isInAngularZone())throw new se(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,UU,xw,xw);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const UU={};function Wm(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function $m(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function Ew(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function Sw(n){n._nesting--,Wm(n)}class VU{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Er,this.onMicrotaskEmpty=new Er,this.onStable=new Er,this.onError=new Er}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const ww=new Ye("",{providedIn:"root",factory:bw});function bw(){const n=Pt(Xt);let e=!0;return function L1(...n){const e=yv(n),t=function A1(n,e){return"number"==typeof hf(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?qr(i[0]):function w1(n=1/0){return df(of,n)}(t)(xv(i,e)):gv}(new Vn(r=>{e=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{r.next(e),r.complete()})}),new Vn(r=>{let s;n.runOutsideAngular(()=>{s=n.onStable.subscribe(()=>{Xt.assertNotInAngularZone(),Gm(()=>{!e&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(e=!0,r.next(!0))})})});const o=n.onUnstable.subscribe(()=>{Xt.assertInAngularZone(),e&&(e=!1,n.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),o.unsubscribe()}}).pipe(Ev()))}const Tw=new Ye(""),ud=new Ye("");let Xm,jm=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Xm||(function HU(n){Xm=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Xt.assertNotInAngularZone(),Gm(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Gm(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(Je(Xt),Je(qm),Je(ud))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})(),qm=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return Xm?.findTestabilityInTree(this,t,i)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),rs=null;const Aw=new Ye("AllowMultipleToken"),Ym=new Ye("PlatformDestroyListeners"),Dw=new Ye("appBootstrapListener");function Rw(n,e,t=[]){const i=`Platform: ${e}`,r=new Ye(i);return(s=[])=>{let o=Km();if(!o||o.injector.get(Aw,!1)){const a=[...t,...s,{provide:r,useValue:!0}];n?n(a):function WU(n){if(rs&&!rs.get(Aw,!1))throw new se(400,!1);(function Cw(){!function bI(n){Jv=n}(()=>{throw new se(600,!1)})})(),rs=n;const e=n.get(Nw);(function Iw(n){n.get(GM,null)?.forEach(t=>t())})(n)}(function Pw(n=[],e){return Ps.create({name:e,providers:[{provide:Dp,useValue:"platform"},{provide:Ym,useValue:new Set([()=>rs=null])},...n]})}(a,i))}return function jU(n){const e=Km();if(!e)throw new se(401,!1);return e}()}}function Km(){return rs?.get(Nw)??null}let Nw=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function qU(n="zone.js",e){return"noop"===n?new VU:"zone.js"===n?new Xt(e):n}(i?.ngZone,function Lw(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const s=function l2(n,e,t){return new Tm(n,e,t)}(t.moduleType,this.injector,function Bw(n){return[{provide:Xt,useFactory:n},{provide:Ou,multi:!0,useFactory:()=>{const e=Pt(YU,{optional:!0});return()=>e.initialize()}},{provide:kw,useFactory:XU},{provide:ww,useFactory:bw}]}(()=>r)),o=s.injector.get(Rs,null);return r.runOutsideAngular(()=>{const a=r.onError.subscribe({next:l=>{o.handleError(l)}});s.onDestroy(()=>{dd(this._modules,s),a.unsubscribe()})}),function Ow(n,e,t){try{const i=t();return pm(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(o,r,()=>{const a=s.injector.get(zm);return a.runInitializers(),a.donePromise.then(()=>(function iS(n){pi(n,"Expected localeId to be defined"),"string"==typeof n&&(nS=n.toLowerCase().replace(/_/g,"-"))}(s.injector.get(wr,ra)||ra),this._moduleDoBootstrap(s),s))})})}bootstrapModule(t,i=[]){const r=Fw({},i);return function zU(n,e,t){const i=new Am(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(la);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new se(-403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new se(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(Ym,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Je(Ps))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function Fw(n,e){return Array.isArray(e)?e.reduce(Fw,n):{...n,...e}}let la=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Pt(kw),this.zoneIsStable=Pt(ww),this.componentTypes=[],this.components=[],this.isStable=Pt(RU).hasPendingTasks.pipe(df(t=>t?function O1(...n){return xv(n,yv(n))}(!1):this.zoneIsStable),function F1(n,e=of){return n=n??U1,vo((t,i)=>{let r,s=!0;t.subscribe(tl(i,o=>{const a=e(o);(s||!n(r,a))&&(s=!1,r=a,i.next(o))}))})}(),Ev()),this._injector=Pt(Ho)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof ZM;if(!this._injector.get(zm).done)throw!r&&function ol(n){const e=xt(n)||Sn(n)||Wn(n);return null!==e&&e.standalone}(t),new se(405,!1);let o;o=r?t:this._injector.get(Gu).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function GU(n){return n.isBoundToModule}(o)?void 0:this._injector.get(sa),c=o.create(Ps.NULL,[],i||o.selector,a),u=c.location.nativeElement,d=c.injector.get(Tw,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),dd(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new se(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;dd(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(Dw,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>dd(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new se(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function dd(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const kw=new Ye("",{providedIn:"root",factory:()=>Pt(Rs).handleError.bind(void 0)});function XU(){const n=Pt(Xt),e=Pt(Rs);return t=>n.runOutsideAngular(()=>e.handleError(t))}let YU=(()=>{class n{constructor(){this.zone=Pt(Xt),this.applicationRef=Pt(la)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Gw{constructor(){}supports(e){return Zu(e)}create(e){return new s3(e)}}const r3=(n,e)=>e;class s3{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||r3}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){const o=!i||t&&t.currentIndex<$w(i,r,s)?t:i,a=$w(o,r,s),l=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(t=t._next,null==o.previousIndex)r++;else{s||(s=[]);const c=a-r,u=l-r;if(c!=u){for(let h=0;h<c;h++){const f=h<s.length?s[h]:s[h]=0,p=f+h;u<=p&&p<c&&(s[h]=f+1)}s[o.previousIndex]=u-c}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Zu(e))throw new se(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,s,o,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),i=!0),t=t._next}else r=0,function FL(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,a=>{o=this._trackByFn(r,a),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,a,o,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new o3(t,i),s,r),e}_verifyReinsertion(e,t,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,s=e._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Ww),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ww),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class o3{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class a3{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class Ww{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new a3,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function $w(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function qw(){return new pd([new Gw])}let pd=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||qw()),deps:[[n,new Qf,new Jf]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new se(901,!1)}}return n.\u0275prov=Mt({token:n,providedIn:"root",factory:qw}),n})();const h3=Rw(null,"core",[]);let f3=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Je(la))},n.\u0275mod=xo({type:n}),n.\u0275inj=Es({}),n})(),ig=null;function rg(){return ig}class w3{}const br=new Ye("DocumentToken");class hk{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let mg=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,s,o)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new hk(r.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)i.remove(null===s?void 0:s);else if(null!==s){const a=i.get(s);i.move(a,o),db(a,r)}});for(let r=0,s=i.length;r<s;r++){const a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{db(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(nt(nr),nt(Sr),nt(pd))},n.\u0275dir=mi({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function db(n,e){n.context.$implicit=e.item}let Bk=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xo({type:n}),n.\u0275inj=Es({}),n})();function gb(n){return"server"===n}class yB extends w3{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Eg extends yB{static makeCurrent(){!function S3(n){ig||(ig=n)}(new Eg)}onAndCancel(e,t,i){return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function _B(){return Jl=Jl||document.querySelector("base"),Jl?Jl.getAttribute("href"):null}();return null==t?null:function vB(n){Dd=Dd||document.createElement("a"),Dd.setAttribute("href",n);const e=Dd.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Jl=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function ck(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Dd,Jl=null,xB=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();const Sg=new Ye("EventManagerPlugins");let Eb=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(s=>s.supports(t)),!i)throw new se(5101,!1);return this._eventNameToPlugin.set(t,i),i}}return n.\u0275fac=function(t){return new(t||n)(Je(Sg),Je(Xt))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();class Sb{constructor(e){this._doc=e}}const wg="ng-app-id";let wb=(()=>{class n{constructor(t,i,r,s={}){this.doc=t,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=gb(s),this.resetHostNodes()}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(i=>i.remove()),t.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.elements?.forEach(r=>r.remove()),i.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${wg}="${this.appId}"]`);if(t?.length){const i=new Map;return t.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(t,i){const r=this.styleRef;if(r.has(t)){const s=r.get(t);return s.usage+=i,s.usage}return r.set(t,{usage:i,elements:[]}),i}getStyleElement(t,i){const r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===t)return r.delete(i),s.removeAttribute(wg),s;{const o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=i,this.platformIsServer&&o.setAttribute(wg,this.appId),o}}addStyleToHost(t,i){const r=this.getStyleElement(t,i);t.appendChild(r);const s=this.styleRef,o=s.get(i)?.elements;o?o.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(Je(br),Je(ku),Je($M,8),Je(Go))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();const bg={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Tg=/%COMP%/g,bB=new Ye("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function Tb(n,e){return e.map(t=>t.replace(Tg,n))}let Ag=(()=>{class n{constructor(t,i,r,s,o,a,l,c=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestory=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=gb(a),this.defaultRenderer=new Dg(t,o,l,this.platformIsServer)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===zn.ShadowDom&&(i={...i,encapsulation:zn.Emulated});const r=this.getOrCreateRenderer(t,i);return r instanceof Db?r.applyToHost(t):r instanceof Cg&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestory,d=this.platformIsServer;switch(i.encapsulation){case zn.Emulated:s=new Db(l,c,i,this.appId,u,o,a,d);break;case zn.ShadowDom:return new CB(l,c,t,i,o,a,this.nonce,d);default:s=new Cg(l,c,i,u,o,a,d)}s.onDestroy=()=>r.delete(i.id),r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}}return n.\u0275fac=function(t){return new(t||n)(Je(Eb),Je(wb),Je(ku),Je(bB),Je(br),Je(Go),Je(Xt),Je($M))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();class Dg{constructor(e,t,i,r){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(bg[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(Ab(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(Ab(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?this.doc.querySelector(e):e;if(!i)throw new se(5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=bg[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=bg[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(Xn.DashCase|Xn.Important)?e.style.setProperty(t,i,r&Xn.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&Xn.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){if("string"==typeof e&&!(e=rg().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(i))}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))&&t.preventDefault()}}}function Ab(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class CB extends Dg{constructor(e,t,i,r,s,o,a,l){super(e,s,o,l),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=Tb(r.id,r.styles);for(const u of c){const d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=u,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Cg extends Dg{constructor(e,t,i,r,s,o,a,l){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestory=r,this.rendererUsageCount=0,this.styles=l?Tb(l,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class Db extends Cg{constructor(e,t,i,r,s,o,a,l){const c=r+"-"+i.id;super(e,t,i,s,o,a,l,c),this.contentAttr=function TB(n){return"_ngcontent-%COMP%".replace(Tg,n)}(c),this.hostAttr=function AB(n){return"_nghost-%COMP%".replace(Tg,n)}(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}let IB=(()=>{class n extends Sb{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(Je(br))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();const Cb=["alt","control","meta","shift"],RB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},PB={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let NB=(()=>{class n extends Sb{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>rg().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),Cb.forEach(c=>{const u=i.indexOf(c);u>-1&&(i.splice(u,1),o+=c+".")}),o+=s,0!=i.length||0===s.length)return null;const l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(t,i){let r=RB[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),Cb.forEach(o=>{o!==r&&(0,PB[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(Je(br))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();const UB=Rw(h3,"browser",[{provide:Go,useValue:"browser"},{provide:GM,useValue:function LB(){Eg.makeCurrent()},multi:!0},{provide:br,useFactory:function FB(){return function wP(n){vp=n}(document),document},deps:[]}]),kB=new Ye(""),Pb=[{provide:ud,useClass:class MB{addToWindow(e){Tt.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new se(5103,!1);return s},Tt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Tt.getAllAngularRootElements=()=>e.getAllRootElements(),Tt.frameworkStabilizers||(Tt.frameworkStabilizers=[]),Tt.frameworkStabilizers.push(i=>{const r=Tt.getAllAngularTestabilities();let s=r.length,o=!1;const a=function(l){o=o||l,s--,0==s&&i(o)};r.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?rg().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:Tw,useClass:jm,deps:[Xt,qm,ud]},{provide:jm,useClass:jm,deps:[Xt,qm,ud]}],Nb=[{provide:Dp,useValue:"root"},{provide:Rs,useFactory:function OB(){return new Rs},deps:[]},{provide:Sg,useClass:IB,multi:!0,deps:[br,Xt,Go]},{provide:Sg,useClass:NB,multi:!0,deps:[br]},Ag,wb,Eb,{provide:Cl,useExisting:Ag},{provide:class Wk{},useClass:xB,deps:[]},[]];let Lb=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:ku,useValue:t.appId}]}}}return n.\u0275fac=function(t){return new(t||n)(Je(kB,12))},n.\u0275mod=xo({type:n}),n.\u0275inj=Es({providers:[...Nb,...Pb],imports:[Bk,f3]}),n})();typeof window<"u"&&window;class kb{}class $B{}const Ar="*";function jB(n,e){return{type:7,name:n,definitions:e,options:{}}}function qB(n,e=null){return{type:4,styles:e,timings:n}}function Bb(n,e=null){return{type:2,steps:n,options:e}}function Cd(n){return{type:6,styles:n,offset:null}}function XB(n,e,t=null){return{type:1,expr:n,animation:e,options:t}}function Vb(n){Promise.resolve().then(n)}class Ql{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Vb(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class Hb{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0;const s=this.players.length;0==s?Vb(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}const Rg="!";function zb(n){return new se(3e3,!1)}function os(n){switch(n.length){case 0:return new Ql;case 1:return n[0];default:return new Hb(n)}}function Gb(n,e,t=new Map,i=new Map){const r=[],s=[];let o=-1,a=null;if(e.forEach(l=>{const c=l.get("offset"),u=c==o,d=u&&a||new Map;l.forEach((h,f)=>{let p=f,y=h;if("offset"!==f)switch(p=n.normalizePropertyName(p,r),y){case Rg:y=t.get(f);break;case Ar:y=i.get(f);break;default:y=n.normalizeStyleValue(f,p,y,r)}d.set(p,y)}),u||s.push(d),a=d,o=c}),r.length)throw function yV(n){return new se(3502,!1)}();return s}function Pg(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&Ng(t,"start",n)));break;case"done":n.onDone(()=>i(t&&Ng(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&Ng(t,"destroy",n)))}}function Ng(n,e,t){const s=Lg(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),o=n._data;return null!=o&&(s._data=o),s}function Lg(n,e,t,i,r="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!o}}function oi(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function Wb(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}const CV=(()=>typeof document>"u"?null:document.documentElement)();function Og(n){const e=n.parentNode||n.host||null;return e===CV?null:e}let Us=null,$b=!1;function jb(n,e){for(;e;){if(e===n)return!0;e=Og(e)}return!1}function qb(n,e,t){if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]}let Xb=(()=>{class n{validateStyleProperty(t){return function RV(n){Us||(Us=function PV(){return typeof document<"u"?document.body:null}()||{},$b=!!Us.style&&"WebkitAppearance"in Us.style);let e=!0;return Us.style&&!function IV(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in Us.style,!e&&$b&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Us.style)),e}(t)}matchesElement(t,i){return!1}containsElement(t,i){return jb(t,i)}getParentElement(t){return Og(t)}query(t,i,r){return qb(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,o,a=[],l){return new Ql(r,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})(),Fg=(()=>{class n{}return n.NOOP=new Xb,n})();const NV=1e3,Ug="ng-enter",Id="ng-leave",Rd="ng-trigger",Pd=".ng-trigger",Kb="ng-animating",kg=".ng-animating";function Dr(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Bg(parseFloat(e[1]),e[2])}function Bg(n,e){return"s"===e?n*NV:n}function Nd(n,e,t){return n.hasOwnProperty("duration")?n:function OV(n,e,t){let r,s=0,o="";if("string"==typeof n){const a=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return e.push(zb()),{duration:0,delay:0,easing:""};r=Bg(parseFloat(a[1]),a[2]);const l=a[3];null!=l&&(s=Bg(parseFloat(l),a[4]));const c=a[5];c&&(o=c)}else r=n;if(!t){let a=!1,l=e.length;r<0&&(e.push(function YB(){return new se(3100,!1)}()),a=!0),s<0&&(e.push(function KB(){return new se(3101,!1)}()),a=!0),a&&e.splice(l,0,zb())}return{duration:r,delay:s,easing:o}}(n,e,t)}function ec(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function Zb(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function as(n,e=new Map,t){if(t)for(let[i,r]of t)e.set(i,r);for(let[i,r]of n)e.set(i,r);return e}function ir(n,e,t){e.forEach((i,r)=>{const s=Hg(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i})}function ks(n,e){e.forEach((t,i)=>{const r=Hg(i);n.style[r]=""})}function tc(n){return Array.isArray(n)?1==n.length?n[0]:Bb(n):n}const Vg=new RegExp("{{\\s*(.+?)\\s*}}","g");function Qb(n){let e=[];if("string"==typeof n){let t;for(;t=Vg.exec(n);)e.push(t[1]);Vg.lastIndex=0}return e}function nc(n,e,t){const i=n.toString(),r=i.replace(Vg,(s,o)=>{let a=e[o];return null==a&&(t.push(function JB(n){return new se(3003,!1)}()),a=""),a.toString()});return r==i?n:r}function Ld(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const kV=/-+([a-z0-9])/g;function Hg(n){return n.replace(kV,(...e)=>e[1].toUpperCase())}function ai(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function QB(n){return new se(3004,!1)}()}}function eT(n,e){return window.getComputedStyle(n)[e]}const Od="*";function HV(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function zV(n,e,t){if(":"==n[0]){const l=function GV(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function fV(n){return new se(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof l)return void e.push(l);n=l}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function hV(n){return new se(3015,!1)}()),e;const r=i[1],s=i[2],o=i[3];e.push(tT(r,o));"<"==s[0]&&!(r==Od&&o==Od)&&e.push(tT(o,r))}(i,t,e)):t.push(n),t}const Fd=new Set(["true","1"]),Ud=new Set(["false","0"]);function tT(n,e){const t=Fd.has(n)||Ud.has(n),i=Fd.has(e)||Ud.has(e);return(r,s)=>{let o=n==Od||n==r,a=e==Od||e==s;return!o&&t&&"boolean"==typeof r&&(o=r?Fd.has(n):Ud.has(n)),!a&&i&&"boolean"==typeof s&&(a=s?Fd.has(e):Ud.has(e)),o&&a}}const WV=new RegExp("s*:selfs*,?","g");function zg(n,e,t,i){return new $V(n).build(e,t,i)}class $V{constructor(e){this._driver=e}build(e,t,i){const r=new XV(t);return this._resetContextStyleTimingState(r),ai(this,tc(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const s=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push(function tV(){return new se(3006,!1)}()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),0==a.type){const l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(u=>{l.name=u,s.push(this.visitState(l,t))}),l.name=c}else if(1==a.type){const l=this.visitTransition(a,t);i+=l.queryCount,r+=l.depCount,o.push(l)}else t.errors.push(function nV(){return new se(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:o,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const s=new Set,o=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{Qb(l).forEach(c=>{o.hasOwnProperty(c)||s.add(c)})})}),s.size&&(Ld(s.values()),t.errors.push(function iV(n,e){return new se(3008,!1)}()))}return{type:0,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=ai(this,tc(e.animation),t);return{type:1,matchers:HV(e.expr,t.errors),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:Bs(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(i=>ai(this,i,t)),options:Bs(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const s=e.steps.map(o=>{t.currentTime=i;const a=ai(this,o,t);return r=Math.max(r,t.currentTime),a});return t.currentTime=r,{type:3,steps:s,options:Bs(e.options)}}visitAnimate(e,t){const i=function KV(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return Gg(Nd(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=Gg(0,0,"");return s.dynamic=!0,s.strValue=t,s}const r=Nd(t,e);return Gg(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:Cd({});if(5==s.type)r=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;const c={};i.easing&&(c.easing=i.easing),o=Cd(c)}t.currentTime+=i.duration+i.delay;const l=this.visitStyle(o,t);l.isEmptyStep=a,r=l}return t.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)"string"==typeof a?a===Ar?i.push(a):t.errors.push(new se(3002,!1)):i.push(Zb(a));let s=!1,o=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s))for(let l of a.values())if(l.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(o=>{"string"!=typeof o&&o.forEach((a,l)=>{const c=t.collectedStyles.get(t.currentQuerySelector),u=c.get(l);let d=!0;u&&(s!=r&&s>=u.startTime&&r<=u.endTime&&(t.errors.push(function sV(n,e,t,i,r){return new se(3010,!1)}()),d=!1),s=u.startTime),d&&c.set(l,{startTime:s,endTime:r}),t.options&&function UV(n,e,t){const i=e.params||{},r=Qb(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(function ZB(n){return new se(3001,!1)}())})}(a,t.options,t.errors)})})}visitKeyframes(e,t){const i={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function oV(){return new se(3011,!1)}()),i;let s=0;const o=[];let a=!1,l=!1,c=0;const u=e.steps.map(m=>{const v=this._makeStyleAst(m,t);let _=null!=v.offset?v.offset:function YV(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(v.styles),M=0;return null!=_&&(s++,M=v.offset=_),l=l||M<0||M>1,a=a||M<c,c=M,o.push(M),v});l&&t.errors.push(function aV(){return new se(3012,!1)}()),a&&t.errors.push(function lV(){return new se(3200,!1)}());const d=e.steps.length;let h=0;s>0&&s<d?t.errors.push(function cV(){return new se(3202,!1)}()):0==s&&(h=1/(d-1));const f=d-1,p=t.currentTime,y=t.currentAnimateTimings,g=y.duration;return u.forEach((m,v)=>{const _=h>0?v==f?1:h*v:o[v],M=_*g;t.currentTime=p+y.delay+M,y.duration=M,this._validateStyleAst(m,t),m.offset=_,i.styles.push(m)}),i}visitReference(e,t){return{type:8,animation:ai(this,tc(e.animation),t),options:Bs(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Bs(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Bs(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[s,o]=function jV(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(WV,"")),n=n.replace(/@\*/g,Pd).replace(/@\w+/g,t=>Pd+"-"+t.slice(1)).replace(/:animating/g,kg),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,oi(t.collectedStyles,t.currentQuerySelector,new Map);const a=ai(this,tc(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:Bs(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function uV(){return new se(3013,!1)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:Nd(e.timings,t.errors,!0);return{type:12,animation:ai(this,tc(e.animation),t),timings:i,options:null}}}class XV{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Bs(n){return n?(n=ec(n)).params&&(n.params=function qV(n){return n?ec(n):null}(n.params)):n={},n}function Gg(n,e,t){return{duration:n,delay:e,easing:t}}function Wg(n,e,t,i,r,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}class kd{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const QV=new RegExp(":enter","g"),tH=new RegExp(":leave","g");function $g(n,e,t,i,r,s=new Map,o=new Map,a,l,c=[]){return(new nH).buildKeyframes(n,e,t,i,r,s,o,a,l,c)}class nH{buildKeyframes(e,t,i,r,s,o,a,l,c,u=[]){c=c||new kd;const d=new jg(e,t,c,r,s,u,[]);d.options=l;const h=l.delay?Dr(l.delay):0;d.currentTimeline.delayNextStep(h),d.currentTimeline.setStyles([o],null,d.errors,l),ai(this,i,d);const f=d.timelines.filter(p=>p.containsAnimation());if(f.length&&a.size){let p;for(let y=f.length-1;y>=0;y--){const g=f[y];if(g.element===t){p=g;break}}p&&!p.allowOnlyTimelineStyles()&&p.setStyles([a],null,d.errors,l)}return f.length?f.map(p=>p.buildKeyframes()):[Wg(t,[],[],[],0,h,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(i,r,r.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(const r of e){const s=r?.delay;if(s){const o="number"==typeof s?s:Dr(nc(s,r?.params??{},t.errors));i.delayNextStep(o)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime;const o=null!=i.duration?Dr(i.duration):null,a=null!=i.delay?Dr(i.delay):null;return 0!==o&&e.forEach(l=>{const c=t.appendInstructionToTimeline(l,o,a);s=Math.max(s,c.duration+c.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),ai(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Bd);const o=Dr(s.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>ai(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?Dr(e.options.delay):0;e.steps.forEach(o=>{const a=t.createSubContext(e.options);s&&a.delayNextStep(s),ai(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return Nd(t.params?nc(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,a=t.createSubContext().currentTimeline;a.easing=i.easing,e.styles.forEach(l=>{a.forwardTime((l.offset||0)*s),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?Dr(r.delay):0;s&&(6===t.previousNode.type||0==i&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Bd);let o=i;const a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((c,u)=>{t.currentQueryIndex=u;const d=t.createSubContext(e.options,c);s&&d.delayNextStep(s),c===t.element&&(l=d.currentTimeline),ai(this,e.animation,d),d.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,d.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1);let l=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":l=a-l;break;case"full":l=i.currentStaggerTime}const u=t.currentTimeline;l&&u.delayNextStep(l);const d=u.currentTime;ai(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-d+(r.startTime-i.currentTimeline.startTime)}}const Bd={};class jg{constructor(e,t,i,r,s,o,a,l){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Bd,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new Vd(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=Dr(i.duration)),null!=i.delay&&(r.delay=Dr(i.delay));const s=i.params;if(s){let o=r.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=nc(s[a],o,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,s=new jg(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=Bd,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new iH(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,o){let a=[];if(r&&a.push(this.element),e.length>0){e=(e=e.replace(QV,"."+this._enterClassName)).replace(tH,"."+this._leaveClassName);let c=this._driver.query(this.element,e,1!=i);0!==i&&(c=i<0?c.slice(c.length+i,c.length):c.slice(0,i)),a.push(...c)}return!s&&0==a.length&&o.push(function dV(n){return new se(3014,!1)}()),a}}class Vd{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new Vd(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||Ar),this._currentKeyframe.set(t,Ar);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);const s=r&&r.params||{},o=function rH(n,e){const t=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||e.keys();for(let s of i)t.set(s,Ar)}else as(r,t)}),t}(e,this._globalTimelineStyles);for(let[a,l]of o){const c=nc(l,s,i);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Ar),this._updateStyle(a,c)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{const r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((a,l)=>{const c=as(a,new Map,this._backFill);c.forEach((u,d)=>{u===Rg?e.add(d):u===Ar&&t.add(d)}),i||c.set("offset",l/this.duration),r.push(c)});const s=e.size?Ld(e.values()):[],o=t.size?Ld(t.values()):[];if(i){const a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return Wg(this.element,r,s,o,this.duration,this.startTime,this.easing,!1)}}class iH extends Vd{constructor(e,t,i,r,s,o,a=!1){super(e,t,o.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],o=i+t,a=t/o,l=as(e[0]);l.set("offset",0),s.push(l);const c=as(e[0]);c.set("offset",rT(a)),s.push(c);const u=e.length-1;for(let d=1;d<=u;d++){let h=as(e[d]);const f=h.get("offset");h.set("offset",rT((t+f*i)/o)),s.push(h)}i=o,t=0,r="",e=s}return Wg(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function rT(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class qg{}const sH=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class oH extends qg{normalizePropertyName(e,t){return Hg(e)}normalizeStyleValue(e,t,i,r){let s="";const o=i.toString().trim();if(sH.has(t)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push(function eV(n,e){return new se(3005,!1)}())}return o+s}}function sT(n,e,t,i,r,s,o,a,l,c,u,d,h){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:d,errors:h}}const Xg={};class oT{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function aH(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return void 0!==e&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,o,a,l,c,u){const d=[],h=this.ast.options&&this.ast.options.params||Xg,p=this.buildStyles(i,a&&a.params||Xg,d),y=l&&l.params||Xg,g=this.buildStyles(r,y,d),m=new Set,v=new Map,_=new Map,M="void"===r,E={params:lH(y,h),delay:this.ast.options?.delay},S=u?[]:$g(e,t,this.ast.animation,s,o,p,g,E,c,d);let T=0;if(S.forEach(x=>{T=Math.max(x.duration+x.delay,T)}),d.length)return sT(t,this._triggerName,i,r,M,p,g,[],[],v,_,T,d);S.forEach(x=>{const b=x.element,U=oi(v,b,new Set);x.preStyleProps.forEach(N=>U.add(N));const $=oi(_,b,new Set);x.postStyleProps.forEach(N=>$.add(N)),b!==t&&m.add(b)});const A=Ld(m.values());return sT(t,this._triggerName,i,r,M,p,g,S,A,v,_,T)}}function lH(n,e){const t=ec(e);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(t[i]=n[i]);return t}class cH{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i=new Map,r=ec(this.defaultParams);return Object.keys(e).forEach(s=>{const o=e[s];null!==o&&(r[s]=o)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((o,a)=>{o&&(o=nc(o,r,t));const l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),i.set(a,o)})}),i}}class dH{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{this.states.set(r.name,new cH(r.style,r.options&&r.options.params||{},i))}),aT(this.states,"true","1"),aT(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new oT(e,r,this.states))}),this.fallbackTransition=function hH(n,e,t){return new oT(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(o,a)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(o=>o.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function aT(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const fH=new kd;class pH{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const i=[],s=zg(this._driver,t,i,[]);if(i.length)throw function _V(n){return new se(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,i){const r=e.element,s=Gb(this._normalizer,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],s=this._animations.get(e);let o;const a=new Map;if(s?(o=$g(this._driver,t,s,Ug,Id,new Map,new Map,i,fH,r),o.forEach(u=>{const d=oi(a,u.element,new Map);u.postStyleProps.forEach(h=>d.set(h,null))})):(r.push(function vV(){return new se(3300,!1)}()),o=[]),r.length)throw function MV(n){return new se(3504,!1)}();a.forEach((u,d)=>{u.forEach((h,f)=>{u.set(f,this._driver.computeStyle(d,f,Ar))})});const c=os(o.map(u=>{const d=a.get(u.element);return this._buildPlayer(u,new Map,d)}));return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function xV(n){return new se(3301,!1)}();return t}listen(e,t,i,r){const s=Lg(t,"","","");return Pg(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const lT="ng-animate-queued",Yg="ng-animate-disabled",vH=[],cT={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},MH={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Mi="__ng_removed";class Kg{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function wH(n){return n??null}(i?e.value:e),i){const s=ec(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const ic="void",Zg=new Kg(ic);class xH{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,xi(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw function EV(n,e){return new se(3302,!1)}();if(null==i||0==i.length)throw function SV(n){return new se(3303,!1)}();if(!function bH(n){return"start"==n||"done"==n}(i))throw function wV(n,e){return new se(3400,!1)}();const s=oi(this._elementListeners,e,[]),o={name:t,phase:i,callback:r};s.push(o);const a=oi(this._engine.statesByElement,e,new Map);return a.has(t)||(xi(e,Rd),xi(e,Rd+"-"+t),a.set(t,Zg)),()=>{this._engine.afterFlush(()=>{const l=s.indexOf(o);l>=0&&s.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function bV(n){return new se(3401,!1)}();return t}trigger(e,t,i,r=!0){const s=this._getTrigger(t),o=new Jg(this.id,t,e);let a=this._engine.statesByElement.get(e);a||(xi(e,Rd),xi(e,Rd+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t);const c=new Kg(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(t,c),l||(l=Zg),c.value!==ic&&l.value===c.value){if(!function DH(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(l.params,c.params)){const y=[],g=s.matchStyles(l.value,l.params,y),m=s.matchStyles(c.value,c.params,y);y.length?this._engine.reportError(y):this._engine.afterFlush(()=>{ks(e,g),ir(e,m)})}return}const h=oi(this._engine.playersByElement,e,[]);h.forEach(y=>{y.namespaceId==this.id&&y.triggerName==t&&y.queued&&y.destroy()});let f=s.matchTransition(l.value,c.value,e,c.params),p=!1;if(!f){if(!r)return;f=s.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:f,fromState:l,toState:c,player:o,isFallbackTransition:p}),p||(xi(e,lT),o.onStart(()=>{ca(e,lT)})),o.onDone(()=>{let y=this.players.indexOf(o);y>=0&&this.players.splice(y,1);const g=this._engine.playersByElement.get(e);if(g){let m=g.indexOf(o);m>=0&&g.splice(m,1)}}),this.players.push(o),h.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,Pd,!0);i.forEach(r=>{if(r[Mi])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(o=>o.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const s=this._engine.statesByElement.get(e),o=new Map;if(s){const a=[];if(s.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){const u=this.trigger(e,c,ic,r);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),i&&os(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(s=>{const o=s.name;if(r.has(o))return;r.add(o);const l=this._triggers.get(o).fallbackTransition,c=i.get(o)||Zg,u=new Kg(ic),d=new Jg(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:u,player:d,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(i.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const s=e[Mi];(!s||s===cT)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){xi(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==i.triggerName){const l=Lg(s,i.triggerName,i.fromState.value,i.toState.value);l._data=e,Pg(i.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const s=i.transition.ast.depCount,o=r.transition.ast.depCount;return 0==s||0==o?s-o:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(i=>i.element===e)||t,t}}class EH{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new xH(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){const l=r.get(a);if(l){const c=i.indexOf(l);i.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){if(!e)return;const i=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[e];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}return t}trigger(e,t,i,r){if(Hd(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!Hd(t))return;const s=t[Mi];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){const o=this._fetchNamespace(e);o&&o.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),xi(e,Yg)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),ca(e,Yg))}removeNode(e,t,i){if(Hd(t)){const r=e?this._fetchNamespace(e):null;r?r.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i);const s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,i)}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[Mi]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return Hd(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,Pd,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,kg,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return os(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[Mi];if(t&&t.setForRemoval){if(e[Mi]=cT,t.namespaceId){this.destroyInnerAnimations(e);const i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Yg)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)xi(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?os(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function TV(n){return new se(3402,!1)}()}_flushAnimations(e,t){const i=new kd,r=[],s=new Map,o=[],a=new Map,l=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(O=>{u.add(O);const L=this.driver.query(O,".ng-animate-queued",!0);for(let k=0;k<L.length;k++)u.add(L[k])});const d=this.bodyNode,h=Array.from(this.statesByElement.keys()),f=hT(h,this.collectedEnterElements),p=new Map;let y=0;f.forEach((O,L)=>{const k=Ug+y++;p.set(L,k),O.forEach(G=>xi(G,k))});const g=[],m=new Set,v=new Set;for(let O=0;O<this.collectedLeaveElements.length;O++){const L=this.collectedLeaveElements[O],k=L[Mi];k&&k.setForRemoval&&(g.push(L),m.add(L),k.hasAnimation?this.driver.query(L,".ng-star-inserted",!0).forEach(G=>m.add(G)):v.add(L))}const _=new Map,M=hT(h,Array.from(m));M.forEach((O,L)=>{const k=Id+y++;_.set(L,k),O.forEach(G=>xi(G,k))}),e.push(()=>{f.forEach((O,L)=>{const k=p.get(L);O.forEach(G=>ca(G,k))}),M.forEach((O,L)=>{const k=_.get(L);O.forEach(G=>ca(G,k))}),g.forEach(O=>{this.processLeaveNode(O)})});const E=[],S=[];for(let O=this._namespaceList.length-1;O>=0;O--)this._namespaceList[O].drainQueuedTransitions(t).forEach(k=>{const G=k.player,Z=k.element;if(E.push(G),this.collectedEnterElements.length){const he=Z[Mi];if(he&&he.setForMove){if(he.previousTriggersValues&&he.previousTriggersValues.has(k.triggerName)){const Re=he.previousTriggersValues.get(k.triggerName),Ae=this.statesByElement.get(k.element);if(Ae&&Ae.has(k.triggerName)){const rt=Ae.get(k.triggerName);rt.value=Re,Ae.set(k.triggerName,rt)}}return void G.destroy()}}const ce=!d||!this.driver.containsElement(d,Z),H=_.get(Z),te=p.get(Z),j=this._buildInstruction(k,i,te,H,ce);if(j.errors&&j.errors.length)return void S.push(j);if(ce)return G.onStart(()=>ks(Z,j.fromStyles)),G.onDestroy(()=>ir(Z,j.toStyles)),void r.push(G);if(k.isFallbackTransition)return G.onStart(()=>ks(Z,j.fromStyles)),G.onDestroy(()=>ir(Z,j.toStyles)),void r.push(G);const ye=[];j.timelines.forEach(he=>{he.stretchStartingKeyframe=!0,this.disabledNodes.has(he.element)||ye.push(he)}),j.timelines=ye,i.append(Z,j.timelines),o.push({instruction:j,player:G,element:Z}),j.queriedElements.forEach(he=>oi(a,he,[]).push(G)),j.preStyleProps.forEach((he,Re)=>{if(he.size){let Ae=l.get(Re);Ae||l.set(Re,Ae=new Set),he.forEach((rt,Le)=>Ae.add(Le))}}),j.postStyleProps.forEach((he,Re)=>{let Ae=c.get(Re);Ae||c.set(Re,Ae=new Set),he.forEach((rt,Le)=>Ae.add(Le))})});if(S.length){const O=[];S.forEach(L=>{O.push(function AV(n,e){return new se(3505,!1)}())}),E.forEach(L=>L.destroy()),this.reportError(O)}const T=new Map,A=new Map;o.forEach(O=>{const L=O.element;i.has(L)&&(A.set(L,L),this._beforeAnimationBuild(O.player.namespaceId,O.instruction,T))}),r.forEach(O=>{const L=O.element;this._getPreviousPlayers(L,!1,O.namespaceId,O.triggerName,null).forEach(G=>{oi(T,L,[]).push(G),G.destroy()})});const x=g.filter(O=>pT(O,l,c)),b=new Map;dT(b,this.driver,v,c,Ar).forEach(O=>{pT(O,l,c)&&x.push(O)});const $=new Map;f.forEach((O,L)=>{dT($,this.driver,new Set(O),l,Rg)}),x.forEach(O=>{const L=b.get(O),k=$.get(O);b.set(O,new Map([...L?.entries()??[],...k?.entries()??[]]))});const N=[],F=[],V={};o.forEach(O=>{const{element:L,player:k,instruction:G}=O;if(i.has(L)){if(u.has(L))return k.onDestroy(()=>ir(L,G.toStyles)),k.disabled=!0,k.overrideTotalTime(G.totalTime),void r.push(k);let Z=V;if(A.size>1){let H=L;const te=[];for(;H=H.parentNode;){const j=A.get(H);if(j){Z=j;break}te.push(H)}te.forEach(j=>A.set(j,Z))}const ce=this._buildAnimation(k.namespaceId,G,T,s,$,b);if(k.setRealPlayer(ce),Z===V)N.push(k);else{const H=this.playersByElement.get(Z);H&&H.length&&(k.parentPlayer=os(H)),r.push(k)}}else ks(L,G.fromStyles),k.onDestroy(()=>ir(L,G.toStyles)),F.push(k),u.has(L)&&r.push(k)}),F.forEach(O=>{const L=s.get(O.element);if(L&&L.length){const k=os(L);O.setRealPlayer(k)}}),r.forEach(O=>{O.parentPlayer?O.syncPlayerEvents(O.parentPlayer):O.destroy()});for(let O=0;O<g.length;O++){const L=g[O],k=L[Mi];if(ca(L,Id),k&&k.hasAnimation)continue;let G=[];if(a.size){let ce=a.get(L);ce&&ce.length&&G.push(...ce);let H=this.driver.query(L,kg,!0);for(let te=0;te<H.length;te++){let j=a.get(H[te]);j&&j.length&&G.push(...j)}}const Z=G.filter(ce=>!ce.destroyed);Z.length?TH(this,L,Z):this.processLeaveNode(L)}return g.length=0,N.forEach(O=>{this.players.push(O),O.onDone(()=>{O.destroy();const L=this.players.indexOf(O);this.players.splice(L,1)}),O.play()}),N}elementContainsData(e,t){let i=!1;const r=t[Mi];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(t)&&(i=!0),this.playersByQueriedElement.has(t)&&(i=!0),this.statesByElement.has(t)&&(i=!0),this._fetchNamespace(e).elementContainsData(t)||i}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let o=[];if(t){const a=this.playersByQueriedElement.get(e);a&&(o=a)}else{const a=this.playersByElement.get(e);if(a){const l=!s||s==ic;a.forEach(c=>{c.queued||!l&&c.triggerName!=r||o.push(c)})}}return(i||r)&&(o=o.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,t,i){const s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:t.triggerName;for(const l of t.timelines){const c=l.element,u=c!==s,d=oi(i,c,[]);this._getPreviousPlayers(c,u,o,a,t.toState).forEach(f=>{const p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),d.push(f)})}ks(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,o){const a=t.triggerName,l=t.element,c=[],u=new Set,d=new Set,h=t.timelines.map(p=>{const y=p.element;u.add(y);const g=y[Mi];if(g&&g.removedBeforeQueried)return new Ql(p.duration,p.delay);const m=y!==l,v=function AH(n){const e=[];return fT(n,e),e}((i.get(y)||vH).map(T=>T.getRealPlayer())).filter(T=>!!T.element&&T.element===y),_=s.get(y),M=o.get(y),E=Gb(this._normalizer,p.keyframes,_,M),S=this._buildPlayer(p,E,v);if(p.subTimeline&&r&&d.add(y),m){const T=new Jg(e,a,y);T.setRealPlayer(S),c.push(T)}return S});c.forEach(p=>{oi(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function SH(n,e,t){let i=n.get(e);if(i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}return i}(this.playersByQueriedElement,p.element,p))}),u.forEach(p=>xi(p,Kb));const f=os(h);return f.onDestroy(()=>{u.forEach(p=>ca(p,Kb)),ir(l,t.toStyles)}),d.forEach(p=>{oi(r,p,[]).push(f)}),f}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new Ql(e.duration,e.delay)}}class Jg{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new Ql,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>Pg(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){oi(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function Hd(n){return n&&1===n.nodeType}function uT(n,e){const t=n.style.display;return n.style.display=e??"none",t}function dT(n,e,t,i,r){const s=[];t.forEach(l=>s.push(uT(l)));const o=[];i.forEach((l,c)=>{const u=new Map;l.forEach(d=>{const h=e.computeStyle(c,d,r);u.set(d,h),(!h||0==h.length)&&(c[Mi]=MH,o.push(c))}),n.set(c,u)});let a=0;return t.forEach(l=>uT(l,s[a++])),o}function hT(n,e){const t=new Map;if(n.forEach(a=>t.set(a,[])),0==e.length)return t;const i=1,r=new Set(e),s=new Map;function o(a){if(!a)return i;let l=s.get(a);if(l)return l;const c=a.parentNode;return l=t.has(c)?c:r.has(c)?i:o(c),s.set(a,l),l}return e.forEach(a=>{const l=o(a);l!==i&&t.get(l).push(a)}),t}function xi(n,e){n.classList?.add(e)}function ca(n,e){n.classList?.remove(e)}function TH(n,e,t){os(t).onDone(()=>n.processLeaveNode(e))}function fT(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof Hb?fT(i.players,e):e.push(i)}}function pT(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}class zd{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new EH(e,t,i),this._timelineEngine=new pH(e,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){const o=e+"-"+r;let a=this._triggerCache[o];if(!a){const l=[],u=zg(this._driver,s,l,[]);if(l.length)throw function gV(n,e){return new se(3404,!1)}();a=function uH(n,e,t){return new dH(n,e,t)}(r,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i){this._transitionEngine.removeNode(e,t,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[s,o]=Wb(i);this._timelineEngine.command(s,t,o,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if("@"==i.charAt(0)){const[o,a]=Wb(i);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let IH=(()=>{class n{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ir(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ir(this._element,this._initialStyles),this._endStyles&&(ir(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(ks(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ks(this._element,this._endStyles),this._endStyles=null),ir(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function Qg(n){let e=null;return n.forEach((t,i)=>{(function RH(n){return"display"===n||"position"===n})(i)&&(e=e||new Map,e.set(i,t))}),e}class mT{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&e.set(r,this._finished?i:eT(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class PH{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return jb(e,t)}getParentElement(e){return Og(e)}query(e,t,i){return qb(e,t,i)}computeStyle(e,t,i){return window.getComputedStyle(e)[t]}animate(e,t,i,r,s,o=[]){const l={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(l.easing=s);const c=new Map,u=o.filter(f=>f instanceof mT);(function BV(n,e){return 0===n||0===e})(i,r)&&u.forEach(f=>{f.currentSnapshot.forEach((p,y)=>c.set(y,p))});let d=function FV(n){return n.length?n[0]instanceof Map?n:n.map(e=>Zb(e)):[]}(t).map(f=>as(f));d=function VV(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,o)=>{i.has(o)||r.push(o),i.set(o,s)}),r.length)for(let s=1;s<e.length;s++){let o=e[s];r.forEach(a=>o.set(a,eT(n,a)))}}return e}(e,d,c);const h=function CH(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=Qg(e[0]),e.length>1&&(i=Qg(e[e.length-1]))):e instanceof Map&&(t=Qg(e)),t||i?new IH(n,t,i):null}(e,d);return new mT(e,d,l,h)}}let NH=(()=>{class n extends kb{constructor(t,i){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(i.body,{id:"0",encapsulation:zn.None,styles:[],data:{animation:[]}})}build(t){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(t)?Bb(t):t;return gT(this._renderer,null,i,"register",[r]),new LH(i,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(Je(Cl),Je(br))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();class LH extends $B{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new OH(this._id,e,t||{},this._renderer)}}class OH{constructor(e,t,i,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return gT(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function gT(n,e,t,i,r){return n.setProperty(e,`@@${t}:${i}`,r)}const yT="@.disabled";let FH=(()=>{class n{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,o)=>{const a=o?.parentNode(s);a&&o.removeChild(a,s)}}createRenderer(t,i){const s=this.delegate.createRenderer(t,i);if(!(t&&i&&i.data&&i.data.animation)){let u=this._rendererCache.get(s);return u||(u=new _T("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,u)),u}const o=i.id,a=i.id+"-"+this._currentId;this._currentId++,this.engine.register(a,t);const l=u=>{Array.isArray(u)?u.forEach(l):this.engine.registerTrigger(o,a,t,u.name,u)};return i.data.animation.forEach(l),new UH(this,a,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){t>=0&&t<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(Je(Cl),Je(zd),Je(Xt))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})();class _T{constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>t.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==yT?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class UH extends _T{constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==yT?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if("@"==t.charAt(0)){const r=function kH(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),o="";return"@"!=s.charAt(0)&&([s,o]=function BH(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,r,s,o,a=>{this.factory.scheduleListenerCallback(a._data||-1,i,a)})}return this.delegate.listen(e,t,i)}}const vT=[{provide:kb,useClass:NH},{provide:qg,useFactory:function HH(){return new oH}},{provide:zd,useClass:(()=>{class n extends zd{constructor(t,i,r,s){super(t.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(Je(br),Je(Fg),Je(qg),Je(la))},n.\u0275prov=Mt({token:n,factory:n.\u0275fac}),n})()},{provide:Cl,useFactory:function zH(n,e,t){return new FH(n,e,t)},deps:[Ag,zd,Xt]}],ey=[{provide:Fg,useFactory:()=>new PH},{provide:WM,useValue:"BrowserAnimations"},...vT],MT=[{provide:Fg,useClass:Xb},{provide:WM,useValue:"NoopAnimations"},...vT];let GH=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?MT:ey}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xo({type:n}),n.\u0275inj=Es({providers:ey,imports:[Lb]}),n})(),WH=(()=>{class n{constructor(){this.elementsToAnimate=[],this.animationClass="show-anim",window.addEventListener("scroll",this.checkElementsVisibility.bind(this))}observe(t){this.elementsToAnimate.push(t)}checkElementsVisibility(){for(const t of this.elementsToAnimate)this.isElementInViewport(t.nativeElement)&&this.addAnimationClass(t.nativeElement)}isElementInViewport(t){const i=t.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}addAnimationClass(t){t.classList.add(this.animationClass),this.elementsToAnimate=this.elementsToAnimate.filter(i=>i.nativeElement!==t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Mt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function xT(n,e,t,i,r,s,o){try{var a=n[s](o),l=a.value}catch(c){return void t(c)}a.done?e(l):Promise.resolve(l).then(i,r)}const ST=1,XH=2,Cr=3,Ir=0,Zn=1,rr=2,ls=0,Wd=0,pz=1,mz=2,Rr=0,gz=1,yz=2,_z=3,vz=4,Mz=5,Vs=301,Hs=302,rc=306,zs=1e3,An=1001,sc=1002,Zt=1003,qd=1004,oc=1005,Ht=1006,ry=1007,Pr=1008,cs=1009,sy=1012,us=1014,Nr=1015,ac=1016,PT=1017,NT=1018,Gs=1020,Ei=1023,Ws=1026,ha=1027,LT=1029,OT=1031,FT=1033,lc=2300,fa=2301,aA=1,fy=2,$s=3001,js=0,We="srgb",sr="srgb-linear",cA="display-p3",uA="300 es",Lr=2e3;class ga{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Dn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const Xs=Math.PI/180,ya=180/Math.PI;function li(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Dn[255&n]+Dn[n>>8&255]+Dn[n>>16&255]+Dn[n>>24&255]+"-"+Dn[255&e]+Dn[e>>8&255]+"-"+Dn[e>>16&15|64]+Dn[e>>24&255]+"-"+Dn[63&t|128]+Dn[t>>8&255]+"-"+Dn[t>>16&255]+Dn[t>>24&255]+Dn[255&i]+Dn[i>>8&255]+Dn[i>>16&255]+Dn[i>>24&255]).toLowerCase()}function zt(n,e,t){return Math.max(e,Math.min(t,n))}function gy(n,e){return(n%e+e)%e}function cc(n,e,t){return(1-t)*n+t*e}function yy(n){return 0==(n&n-1)&&0!==n}function hA(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Zd(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function ci(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function st(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}const sG_radToDeg=function iG(n){return n*ya};class ne{constructor(e=0,t=0){ne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class at{constructor(e,t,i,r,s,o,a,l,c){at.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],d=i[7],h=i[2],f=i[5],p=i[8],y=r[0],g=r[3],m=r[6],v=r[1],_=r[4],M=r[7],E=r[2],S=r[5],T=r[8];return s[0]=o*y+a*v+l*E,s[3]=o*g+a*_+l*S,s[6]=o*m+a*M+l*T,s[1]=c*y+u*v+d*E,s[4]=c*g+u*_+d*S,s[7]=c*m+u*M+d*T,s[2]=h*y+f*v+p*E,s[5]=h*g+f*_+p*S,s[8]=h*m+f*M+p*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,h=a*l-u*s,f=c*s-o*l,p=t*d+i*h+r*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const y=1/p;return e[0]=d*y,e[1]=(r*c-u*i)*y,e[2]=(a*i-r*o)*y,e[3]=h*y,e[4]=(u*t-r*l)*y,e[5]=(r*s-a*t)*y,e[6]=f*y,e[7]=(i*l-c*t)*y,e[8]=(o*t-i*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_y.makeScale(e,t)),this}rotate(e){return this.premultiply(_y.makeRotation(-e)),this}translate(e,t){return this.premultiply(_y.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const _y=new at;function fA(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function uc(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const pA={};function dc(n){n in pA||(pA[n]=!0,console.warn(n))}function va(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function vy(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const aG=(new at).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),lG=(new at).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),dG={[sr]:n=>n,[We]:n=>n.convertSRGBToLinear(),[cA]:function cG(n){return n.convertSRGBToLinear().applyMatrix3(lG)}},hG={[sr]:n=>n,[We]:n=>n.convertLinearToSRGB(),[cA]:function uG(n){return n.applyMatrix3(aG).convertLinearToSRGB()}},Oi={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return sr},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(!1===this.enabled||e===t||!e||!t)return n;const i=dG[e],r=hG[t];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let Ma;class mA{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ma&&(Ma=uc("canvas")),Ma.width=e.width,Ma.height=e.height;const i=Ma.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ma}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=uc("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*va(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*va(t[i]/255)):va(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fG=0;class xa{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fG++}),this.uuid=li(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(My(r[o].isDataTexture?r[o].image:r[o]))}else s=My(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function My(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?mA.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let pG=0,Fi=(()=>{class n extends ga{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=An,s=An,o=Ht,a=Pr,l=Ei,c=cs,u=n.DEFAULT_ANISOTROPY,d=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:pG++}),this.uuid=li(),this.name="",this.source=new xa(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new ne(0,0),this.repeat=new ne(1,1),this.center=new ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new at,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof d?this.colorSpace=d:(dc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=d===$s?We:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case zs:t.x=t.x-Math.floor(t.x);break;case An:t.x=t.x<0?0:1;break;case sc:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case zs:t.y=t.y-Math.floor(t.y);break;case An:t.y=t.y<0?0:1;break;case sc:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return dc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===We?$s:3e3}set encoding(t){dc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===$s?We:""}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class bt{constructor(e=0,t=0,i=0,r=1){bt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],y=l[2],g=l[6],m=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-y)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+y)<.1&&Math.abs(p+g)<.1&&Math.abs(c+f+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,M=(f+1)/2,E=(m+1)/2,S=(u+h)/4,T=(d+y)/4,A=(p+g)/4;return _>M&&_>E?_<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(_),r=S/i,s=T/i):M>E?M<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(M),i=S/r,s=A/r):E<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(E),i=T/s,r=A/s),this.set(i,r,s,t),this}let v=Math.sqrt((g-p)*(g-p)+(d-y)*(d-y)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(g-p)/v,this.y=(d-y)/v,this.z=(h-u)/v,this.w=Math.acos((c+f+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ys extends ga{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new bt(0,0,e,t),this.scissorTest=!1,this.viewport=new bt(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==i.encoding&&(dc("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===$s?We:""),this.texture=new Fi(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Ht,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new xa(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xy extends Fi{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zt,this.minFilter=Zt,this.wrapR=An,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class gA extends Fi{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zt,this.minFilter=Zt,this.wrapR=An,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class On{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],d=i[r+3];const h=s[o+0],f=s[o+1],p=s[o+2],y=s[o+3];if(0===a)return e[t+0]=l,e[t+1]=c,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=y);if(d!==y||l!==h||c!==f||u!==p){let g=1-a;const m=l*h+c*f+u*p+d*y,v=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){const E=Math.sqrt(_),S=Math.atan2(E,m*v);g=Math.sin(g*S)/E,a=Math.sin(a*S)/E}const M=a*v;if(l=l*g+h*M,c=c*g+f*M,u=u*g+p*M,d=d*g+y*M,g===1-a){const E=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=E,c*=E,u*=E,d*=E}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),d=a(s/2),h=l(i/2),f=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=i+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zt(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=o*d+this._w*h,this._x=i*d+this._x*h,this._y=r*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class D{constructor(e=0,t=0,i=0){D.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*i,u=l*i+a*t-s*r,d=l*r+s*i-o*t,h=-s*t-o*i-a*r;return this.x=c*l+h*-s+u*-a-d*-o,this.y=u*l+h*-o+d*-s-c*-a,this.z=d*l+h*-a+c*-o-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Ey.copy(this).projectOnVector(e),this.sub(Ey)}reflect(e){return this.sub(Ey.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ey=new D,yA=new On;class or{constructor(e=new D(1/0,1/0,1/0),t=new D(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Fr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Fr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Ea.copy(e.boundingBox),Ea.applyMatrix4(e.matrixWorld),this.union(Ea);else{const r=e.geometry;if(void 0!==r)if(t&&void 0!==r.attributes&&void 0!==r.attributes.position){const s=r.attributes.position;for(let o=0,a=s.count;o<a;o++)Fr.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Fr)}else null===r.boundingBox&&r.computeBoundingBox(),Ea.copy(r.boundingBox),Ea.applyMatrix4(e.matrixWorld),this.union(Ea)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Fr),Fr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(hc),Jd.subVectors(this.max,hc),Sa.subVectors(e.a,hc),wa.subVectors(e.b,hc),ba.subVectors(e.c,hc),ds.subVectors(wa,Sa),hs.subVectors(ba,wa),Ks.subVectors(Sa,ba);let t=[0,-ds.z,ds.y,0,-hs.z,hs.y,0,-Ks.z,Ks.y,ds.z,0,-ds.x,hs.z,0,-hs.x,Ks.z,0,-Ks.x,-ds.y,ds.x,0,-hs.y,hs.x,0,-Ks.y,Ks.x,0];return!(!Sy(t,Sa,wa,ba,Jd)||(t=[1,0,0,0,1,0,0,0,1],!Sy(t,Sa,wa,ba,Jd)))&&(Qd.crossVectors(ds,hs),t=[Qd.x,Qd.y,Qd.z],Sy(t,Sa,wa,ba,Jd))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Fr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Fr).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Or[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Or[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Or[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Or[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Or[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Or[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Or[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Or[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Or)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Or=[new D,new D,new D,new D,new D,new D,new D,new D],Fr=new D,Ea=new or,Sa=new D,wa=new D,ba=new D,ds=new D,hs=new D,Ks=new D,hc=new D,Jd=new D,Qd=new D,Zs=new D;function Sy(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){Zs.fromArray(n,s);const a=r.x*Math.abs(Zs.x)+r.y*Math.abs(Zs.y)+r.z*Math.abs(Zs.z),l=e.dot(Zs),c=t.dot(Zs),u=i.dot(Zs);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const mG=new or,fc=new D,wy=new D;class Ui{constructor(e=new D,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):mG.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;fc.subVectors(e,this.center);const t=fc.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(fc,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(wy.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(fc.copy(e.center).add(wy)),this.expandByPoint(fc.copy(e.center).sub(wy))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ur=new D,by=new D,eh=new D,fs=new D,Ty=new D,th=new D,Ay=new D;class pc{constructor(e=new D,t=new D(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ur)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ur.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ur.copy(this.origin).addScaledVector(this.direction,t),Ur.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){by.copy(e).add(t).multiplyScalar(.5),eh.copy(t).sub(e).normalize(),fs.copy(this.origin).sub(by);const s=.5*e.distanceTo(t),o=-this.direction.dot(eh),a=fs.dot(this.direction),l=-fs.dot(eh),c=fs.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*l-a,h=o*a-l,p=s*u,d>=0)if(h>=-p)if(h<=p){const y=1/u;d*=y,h*=y,f=d*(d+o*h+2*a)+h*(o*d+h+2*l)+c}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-s,-l),s),f=h*(h+2*l)+c):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(by).addScaledVector(eh,h),f}intersectSphere(e,t){Ur.subVectors(e.center,this.origin);const i=Ur.dot(this.direction),r=Ur.dot(Ur)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:this.at(a<0?l:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(i=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(i=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),i>l||a>r)||((a>i||i!=i)&&(i=a),(l<r||r!=r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,Ur)}intersectTriangle(e,t,i,r,s){Ty.subVectors(t,e),th.subVectors(i,e),Ay.crossVectors(Ty,th);let a,o=this.direction.dot(Ay);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}fs.subVectors(this.origin,e);const l=a*this.direction.dot(th.crossVectors(fs,th));if(l<0)return null;const c=a*this.direction.dot(Ty.cross(fs));if(c<0||l+c>o)return null;const u=-a*fs.dot(Ay);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class $e{constructor(e,t,i,r,s,o,a,l,c,u,d,h,f,p,y,g){$e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,l,c,u,d,h,f,p,y,g)}set(e,t,i,r,s,o,a,l,c,u,d,h,f,p,y,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=u,m[10]=d,m[14]=h,m[3]=f,m[7]=p,m[11]=y,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new $e).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Ta.setFromMatrixColumn(e,0).length(),s=1/Ta.setFromMatrixColumn(e,1).length(),o=1/Ta.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,p=a*u,y=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-y*c,t[9]=-a*l,t[2]=y-h*c,t[6]=p+f*c,t[10]=o*l}else if("YXZ"===e.order){const h=l*u,f=l*d,p=c*u,y=c*d;t[0]=h+y*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=y+h*a,t[10]=o*l}else if("ZXY"===e.order){const h=l*u,f=l*d,p=c*u,y=c*d;t[0]=h-y*a,t[4]=-o*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=y-h*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if("ZYX"===e.order){const h=o*u,f=o*d,p=a*u,y=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+y,t[1]=l*d,t[5]=y*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if("YZX"===e.order){const h=o*l,f=o*c,p=a*l,y=a*c;t[0]=l*u,t[4]=y-h*d,t[8]=p*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-y*d}else if("XZY"===e.order){const h=o*l,f=o*c,p=a*l,y=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+y,t[5]=o*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=y*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(gG,e,yG)}lookAt(e,t,i){const r=this.elements;return ui.subVectors(e,t),0===ui.lengthSq()&&(ui.z=1),ui.normalize(),ps.crossVectors(i,ui),0===ps.lengthSq()&&(1===Math.abs(i.z)?ui.x+=1e-4:ui.z+=1e-4,ui.normalize(),ps.crossVectors(i,ui)),ps.normalize(),nh.crossVectors(ui,ps),r[0]=ps.x,r[4]=nh.x,r[8]=ui.x,r[1]=ps.y,r[5]=nh.y,r[9]=ui.y,r[2]=ps.z,r[6]=nh.z,r[10]=ui.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],d=i[5],h=i[9],f=i[13],p=i[2],y=i[6],g=i[10],m=i[14],v=i[3],_=i[7],M=i[11],E=i[15],S=r[0],T=r[4],A=r[8],x=r[12],b=r[1],U=r[5],$=r[9],N=r[13],F=r[2],V=r[6],O=r[10],L=r[14],k=r[3],G=r[7],Z=r[11],ce=r[15];return s[0]=o*S+a*b+l*F+c*k,s[4]=o*T+a*U+l*V+c*G,s[8]=o*A+a*$+l*O+c*Z,s[12]=o*x+a*N+l*L+c*ce,s[1]=u*S+d*b+h*F+f*k,s[5]=u*T+d*U+h*V+f*G,s[9]=u*A+d*$+h*O+f*Z,s[13]=u*x+d*N+h*L+f*ce,s[2]=p*S+y*b+g*F+m*k,s[6]=p*T+y*U+g*V+m*G,s[10]=p*A+y*$+g*O+m*Z,s[14]=p*x+y*N+g*L+m*ce,s[3]=v*S+_*b+M*F+E*k,s[7]=v*T+_*U+M*V+E*G,s[11]=v*A+_*$+M*O+E*Z,s[15]=v*x+_*N+M*L+E*ce,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*l*d-r*c*d-s*a*h+i*c*h+r*a*f-i*l*f)+e[7]*(+t*l*f-t*c*h+s*o*h-r*o*f+r*c*u-s*l*u)+e[11]*(+t*c*d-t*a*f-s*o*d+i*o*f+s*a*u-i*c*u)+e[15]*(-r*a*u-t*l*d+t*a*h+r*o*d-i*o*h+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],y=e[13],g=e[14],m=e[15],v=d*g*c-y*h*c+y*l*f-a*g*f-d*l*m+a*h*m,_=p*h*c-u*g*c-p*l*f+o*g*f+u*l*m-o*h*m,M=u*y*c-p*d*c+p*a*f-o*y*f-u*a*m+o*d*m,E=p*d*l-u*y*l-p*a*h+o*y*h+u*a*g-o*d*g,S=t*v+i*_+r*M+s*E;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return e[0]=v*T,e[1]=(y*h*s-d*g*s-y*r*f+i*g*f+d*r*m-i*h*m)*T,e[2]=(a*g*s-y*l*s+y*r*c-i*g*c-a*r*m+i*l*m)*T,e[3]=(d*l*s-a*h*s-d*r*c+i*h*c+a*r*f-i*l*f)*T,e[4]=_*T,e[5]=(u*g*s-p*h*s+p*r*f-t*g*f-u*r*m+t*h*m)*T,e[6]=(p*l*s-o*g*s-p*r*c+t*g*c+o*r*m-t*l*m)*T,e[7]=(o*h*s-u*l*s+u*r*c-t*h*c-o*r*f+t*l*f)*T,e[8]=M*T,e[9]=(p*d*s-u*y*s-p*i*f+t*y*f+u*i*m-t*d*m)*T,e[10]=(o*y*s-p*a*s+p*i*c-t*y*c-o*i*m+t*a*m)*T,e[11]=(u*a*s-o*d*s-u*i*c+t*d*c+o*i*f-t*a*f)*T,e[12]=E*T,e[13]=(u*y*r-p*d*r+p*i*h-t*y*h-u*i*g+t*d*g)*T,e[14]=(p*a*r-o*y*r-p*i*l+t*y*l+o*i*g-t*a*g)*T,e[15]=(o*d*r-u*a*r+u*i*l-t*d*l-o*i*h+t*a*h)*T,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,d=a+a,h=s*c,f=s*u,p=s*d,y=o*u,g=o*d,m=a*d,v=l*c,_=l*u,M=l*d,E=i.x,S=i.y,T=i.z;return r[0]=(1-(y+m))*E,r[1]=(f+M)*E,r[2]=(p-_)*E,r[3]=0,r[4]=(f-M)*S,r[5]=(1-(h+m))*S,r[6]=(g+v)*S,r[7]=0,r[8]=(p+_)*T,r[9]=(g-v)*T,r[10]=(1-(h+y))*T,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Ta.set(r[0],r[1],r[2]).length();const o=Ta.set(r[4],r[5],r[6]).length(),a=Ta.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ki.copy(this);const c=1/s,u=1/o,d=1/a;return ki.elements[0]*=c,ki.elements[1]*=c,ki.elements[2]*=c,ki.elements[4]*=u,ki.elements[5]*=u,ki.elements[6]*=u,ki.elements[8]*=d,ki.elements[9]*=d,ki.elements[10]*=d,t.setFromRotationMatrix(ki),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Lr){const l=this.elements,c=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),h=(i+r)/(i-r);let f,p;if(a===Lr)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-o/(o-s),p=-o*s/(o-s)}return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Lr){const l=this.elements,c=1/(t-e),u=1/(i-r),d=1/(o-s),h=(t+e)*c,f=(i+r)*u;let p,y;if(a===Lr)p=(o+s)*d,y=-2*d;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=s*d,y=-1*d}return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-h,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=y,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Ta=new D,ki=new $e,gG=new D(0,0,0),yG=new D(1,1,1),ps=new D,nh=new D,ui=new D,_A=new $e,vA=new On;let _G=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],d=s[9],h=s[2],f=s[6],p=s[10];switch(i){case"XYZ":this._y=Math.asin(zt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-zt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(zt(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-zt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(zt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-zt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return _A.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_A,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return vA.setFromEuler(this),this.setFromQuaternion(vA,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class Dy{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let vG=0;const MA=new D,Aa=new On,kr=new $e,ih=new D,mc=new D,MG=new D,xG=new On,xA=new D(1,0,0),EA=new D(0,1,0),SA=new D(0,0,1),EG={type:"added"},wA={type:"removed"};let yn=(()=>{class n extends ga{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:vG++}),this.uuid=li(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new D,i=new _G,r=new On,s=new D(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new $e},normalMatrix:{value:new at}}),this.matrix=new $e,this.matrixWorld=new $e,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Dy,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Aa.setFromAxisAngle(t,i),this.quaternion.multiply(Aa),this}rotateOnWorldAxis(t,i){return Aa.setFromAxisAngle(t,i),this.quaternion.premultiply(Aa),this}rotateX(t){return this.rotateOnAxis(xA,t)}rotateY(t){return this.rotateOnAxis(EA,t)}rotateZ(t){return this.rotateOnAxis(SA,t)}translateOnAxis(t,i){return MA.copy(t).applyQuaternion(this.quaternion),this.position.add(MA.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(xA,t)}translateY(t){return this.translateOnAxis(EA,t)}translateZ(t){return this.translateOnAxis(SA,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(kr.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?ih.copy(t):ih.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),mc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kr.lookAt(mc,ih,this.up):kr.lookAt(ih,mc,this.up),this.quaternion.setFromRotationMatrix(kr),s&&(kr.extractRotation(s.matrixWorld),Aa.setFromRotationMatrix(kr),this.quaternion.premultiply(Aa.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(EG)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(wA)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(wA)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),kr.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),kr.multiply(t.parent.matrixWorld)),t.applyMatrix4(kr),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let s=0,o=this.children.length;s<o;s++){const a=this.children[s].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mc,t,MG),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mc,xG,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const o=i[r];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++){const l=s[o];!0===l.matrixWorldAutoUpdate&&l.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function o(l,c){return void 0===l[c.uuid]&&(l[c.uuid]=c.toJSON(t)),c.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const c=l.shapes;if(Array.isArray(c))for(let u=0,d=c.length;u<d;u++)o(t.shapes,c[u]);else o(t.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(o(t.materials,this.material[c]));s.material=l}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++)s.animations.push(o(t.animations,this.animations[l]))}if(i){const l=a(t.geometries),c=a(t.materials),u=a(t.textures),d=a(t.images),h=a(t.shapes),f=a(t.skeletons),p=a(t.animations),y=a(t.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),d.length>0&&(r.images=d),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),y.length>0&&(r.nodes=y)}return r.object=s,r;function a(l){const c=[];for(const u in l){const d=l[u];delete d.metadata,c.push(d)}return c}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new D(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const Bi=new D,Br=new D,Cy=new D,Vr=new D,Da=new D,Ca=new D,bA=new D,Iy=new D,Ry=new D,Py=new D;let rh=!1;class di{constructor(e=new D,t=new D,i=new D){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Bi.subVectors(e,t),r.cross(Bi);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Bi.subVectors(r,t),Br.subVectors(i,t),Cy.subVectors(e,t);const o=Bi.dot(Bi),a=Bi.dot(Br),l=Bi.dot(Cy),c=Br.dot(Br),u=Br.dot(Cy),d=o*c-a*a;if(0===d)return s.set(-2,-1,-1);const h=1/d,f=(c*l-a*u)*h,p=(o*u-a*l)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Vr),Vr.x>=0&&Vr.y>=0&&Vr.x+Vr.y<=1}static getUV(e,t,i,r,s,o,a,l){return!1===rh&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),rh=!0),this.getInterpolation(e,t,i,r,s,o,a,l)}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,Vr),l.setScalar(0),l.addScaledVector(s,Vr.x),l.addScaledVector(o,Vr.y),l.addScaledVector(a,Vr.z),l}static isFrontFacing(e,t,i,r){return Bi.subVectors(i,t),Br.subVectors(e,t),Bi.cross(Br).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Bi.subVectors(this.c,this.b),Br.subVectors(this.a,this.b),.5*Bi.cross(Br).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return di.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return di.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return!1===rh&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),rh=!0),di.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}getInterpolation(e,t,i,r,s){return di.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return di.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return di.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Da.subVectors(r,i),Ca.subVectors(s,i),Iy.subVectors(e,i);const l=Da.dot(Iy),c=Ca.dot(Iy);if(l<=0&&c<=0)return t.copy(i);Ry.subVectors(e,r);const u=Da.dot(Ry),d=Ca.dot(Ry);if(u>=0&&d<=u)return t.copy(r);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(Da,o);Py.subVectors(e,s);const f=Da.dot(Py),p=Ca.dot(Py);if(p>=0&&f<=p)return t.copy(s);const y=f*c-l*p;if(y<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(i).addScaledVector(Ca,a);const g=u*p-f*d;if(g<=0&&d-u>=0&&f-p>=0)return bA.subVectors(s,r),a=(d-u)/(d-u+(f-p)),t.copy(r).addScaledVector(bA,a);const m=1/(g+y+h);return o=y*m,a=h*m,t.copy(i).addScaledVector(Da,o).addScaledVector(Ca,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let SG=0;class Vi extends ga{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:SG++}),this.uuid=li(),this.name="",this.type="Material",this.blending=1,this.side=Ir,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),this.side!==Ir&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const TA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Hi={h:0,s:0,l:0},sh={h:0,s:0,l:0};function Ny(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class ge{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const r=e;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=We){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Oi.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Oi.workingColorSpace){return this.r=e,this.g=t,this.b=i,Oi.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Oi.workingColorSpace){if(e=gy(e,1),t=zt(t,0,1),i=zt(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Ny(o,s,e+1/3),this.g=Ny(o,s,e),this.b=Ny(o,s,e-1/3)}return Oi.toWorkingColorSpace(this,r),this}setStyle(e,t=We){function i(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[2];switch(r[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=We){const i=TA[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=va(e.r),this.g=va(e.g),this.b=va(e.b),this}copyLinearToSRGB(e){return this.r=vy(e.r),this.g=vy(e.g),this.b=vy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=We){return Oi.fromWorkingColorSpace(Cn.copy(this),e),65536*Math.round(zt(255*Cn.r,0,255))+256*Math.round(zt(255*Cn.g,0,255))+Math.round(zt(255*Cn.b,0,255))}getHexString(e=We){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Oi.workingColorSpace){Oi.fromWorkingColorSpace(Cn.copy(this),t);const i=Cn.r,r=Cn.g,s=Cn.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=u<=.5?d/(o+a):d/(2-o-a),o){case i:l=(r-s)/d+(r<s?6:0);break;case r:l=(s-i)/d+2;break;case s:l=(i-r)/d+4}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Oi.workingColorSpace){return Oi.fromWorkingColorSpace(Cn.copy(this),t),e.r=Cn.r,e.g=Cn.g,e.b=Cn.b,e}getStyle(e=We){Oi.fromWorkingColorSpace(Cn.copy(this),e);const t=Cn.r,i=Cn.g,r=Cn.b;return e!==We?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(e,t,i){return this.getHSL(Hi),Hi.h+=e,Hi.s+=t,Hi.l+=i,this.setHSL(Hi.h,Hi.s,Hi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Hi),e.getHSL(sh);const i=cc(Hi.h,sh.h,t),r=cc(Hi.s,sh.s,t),s=cc(Hi.l,sh.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Cn=new ge;ge.NAMES=TA;class Si extends Vi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Wd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const sn=new D,oh=new ne;class Gt{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=Nr,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)oh.fromBufferAttribute(this,t),oh.applyMatrix3(e),this.setXY(t,oh.x,oh.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.applyMatrix3(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.applyMatrix4(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.applyNormalMatrix(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.transformDirection(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ci(t,this.array)),t}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ci(t,this.array)),t}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ci(t,this.array)),t}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ci(t,this.array)),t}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),i=st(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),i=st(i,this.array),r=st(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=st(t,this.array),i=st(i,this.array),r=st(r,this.array),s=st(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class AA extends Gt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class DA extends Gt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class De extends Gt{constructor(e,t,i){super(new Float32Array(e),t,i)}}let bG=0;const wi=new $e,Ly=new yn,Ia=new D,hi=new or,yc=new or,_n=new D;class ct extends ga{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bG++}),this.uuid=li(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(fA(e)?DA:AA)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new at).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return wi.makeRotationFromQuaternion(e),this.applyMatrix4(wi),this}rotateX(e){return wi.makeRotationX(e),this.applyMatrix4(wi),this}rotateY(e){return wi.makeRotationY(e),this.applyMatrix4(wi),this}rotateZ(e){return wi.makeRotationZ(e),this.applyMatrix4(wi),this}translate(e,t,i){return wi.makeTranslation(e,t,i),this.applyMatrix4(wi),this}scale(e,t,i){return wi.makeScale(e,t,i),this.applyMatrix4(wi),this}lookAt(e){return Ly.lookAt(e),Ly.updateMatrix(),this.applyMatrix4(Ly.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ia).negate(),this.translate(Ia.x,Ia.y,Ia.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new De(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new or);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)hi.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(_n.addVectors(this.boundingBox.min,hi.min),this.boundingBox.expandByPoint(_n),_n.addVectors(this.boundingBox.max,hi.max),this.boundingBox.expandByPoint(_n)):(this.boundingBox.expandByPoint(hi.min),this.boundingBox.expandByPoint(hi.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ui);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new D,1/0);if(e){const i=this.boundingSphere.center;if(hi.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)yc.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(_n.addVectors(hi.min,yc.min),hi.expandByPoint(_n),_n.addVectors(hi.max,yc.max),hi.expandByPoint(_n)):(hi.expandByPoint(yc.min),hi.expandByPoint(yc.max));hi.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)_n.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(_n));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)_n.fromBufferAttribute(a,c),l&&(Ia.fromBufferAttribute(e,c),_n.add(Ia)),r=Math.max(r,i.distanceToSquared(_n))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Gt(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let b=0;b<a;b++)c[b]=new D,u[b]=new D;const d=new D,h=new D,f=new D,p=new ne,y=new ne,g=new ne,m=new D,v=new D;function _(b,U,$){d.fromArray(r,3*b),h.fromArray(r,3*U),f.fromArray(r,3*$),p.fromArray(o,2*b),y.fromArray(o,2*U),g.fromArray(o,2*$),h.sub(d),f.sub(d),y.sub(p),g.sub(p);const N=1/(y.x*g.y-g.x*y.y);isFinite(N)&&(m.copy(h).multiplyScalar(g.y).addScaledVector(f,-y.y).multiplyScalar(N),v.copy(f).multiplyScalar(y.x).addScaledVector(h,-g.x).multiplyScalar(N),c[b].add(m),c[U].add(m),c[$].add(m),u[b].add(v),u[U].add(v),u[$].add(v))}let M=this.groups;0===M.length&&(M=[{start:0,count:i.length}]);for(let b=0,U=M.length;b<U;++b){const $=M[b],N=$.start;for(let V=N,O=N+$.count;V<O;V+=3)_(i[V+0],i[V+1],i[V+2])}const E=new D,S=new D,T=new D,A=new D;function x(b){T.fromArray(s,3*b),A.copy(T);const U=c[b];E.copy(U),E.sub(T.multiplyScalar(T.dot(U))).normalize(),S.crossVectors(A,U);const N=S.dot(u[b])<0?-1:1;l[4*b]=E.x,l[4*b+1]=E.y,l[4*b+2]=E.z,l[4*b+3]=N}for(let b=0,U=M.length;b<U;++b){const $=M[b],N=$.start;for(let V=N,O=N+$.count;V<O;V+=3)x(i[V+0]),x(i[V+1]),x(i[V+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Gt(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const r=new D,s=new D,o=new D,a=new D,l=new D,c=new D,u=new D,d=new D;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),y=e.getX(h+1),g=e.getX(h+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,y),o.fromBufferAttribute(t,g),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,y),c.fromBufferAttribute(i,g),a.add(u),l.add(u),c.add(u),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(y,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)r.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)_n.fromBufferAttribute(e,t),_n.normalize(),e.setXYZ(t,_n.x,_n.y,_n.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u);let f=0,p=0;for(let y=0,g=l.length;y<g;y++){f=a.isInterleavedBufferAttribute?l[y]*a.data.stride+a.offset:l[y]*u;for(let m=0;m<u;m++)h[p++]=c[f++]}return new Gt(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ct,i=this.index.array,r=this.attributes;for(const a in r){const c=e(r[a],i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,d=c.length;u<d;u++){const f=e(c[u],i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const c in l)void 0!==l[c]&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i)e.data.attributes[l]=i[l].toJSON(e.data);const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++)u.push(c[d].toJSON(e.data));u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r)this.setAttribute(c,r[c].clone(t));const s=e.morphAttributes;for(const c in s){const u=[],d=s[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const CA=new $e,Js=new pc,ah=new Ui,IA=new D,Ra=new D,Pa=new D,Na=new D,Oy=new D,lh=new D,ch=new ne,uh=new ne,dh=new ne,RA=new D,PA=new D,NA=new D,hh=new D,fh=new D;class In extends yn{constructor(e=new ct,t=new Si){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){lh.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l];0!==u&&(Oy.fromBufferAttribute(s[l],e),lh.addScaledVector(o?Oy:Oy.sub(t),u))}t.add(lh)}return t}raycast(e,t){const i=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===i.boundingSphere&&i.computeBoundingSphere(),ah.copy(i.boundingSphere),ah.applyMatrix4(s),Js.copy(e.ray).recast(e.near),(!1!==ah.containsPoint(Js.origin)||!(null===Js.intersectSphere(ah,IA)||Js.origin.distanceToSquared(IA)>(e.far-e.near)**2))&&(CA.copy(s).invert(),Js.copy(e.ray).applyMatrix4(CA),(null===i.boundingBox||!1!==Js.intersectsBox(i.boundingBox))&&this._computeIntersections(e,t,Js)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(null!==a)if(Array.isArray(o))for(let p=0,y=h.length;p<y;p++){const g=h[p],m=o[g.materialIndex];for(let M=Math.max(g.start,f.start),E=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));M<E;M+=3)r=ph(this,m,e,i,c,u,d,a.getX(M),a.getX(M+1),a.getX(M+2)),r&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=g.materialIndex,t.push(r))}else for(let g=Math.max(0,f.start),m=Math.min(a.count,f.start+f.count);g<m;g+=3)r=ph(this,o,e,i,c,u,d,a.getX(g),a.getX(g+1),a.getX(g+2)),r&&(r.faceIndex=Math.floor(g/3),t.push(r));else if(void 0!==l)if(Array.isArray(o))for(let p=0,y=h.length;p<y;p++){const g=h[p],m=o[g.materialIndex];for(let M=Math.max(g.start,f.start),E=Math.min(l.count,Math.min(g.start+g.count,f.start+f.count));M<E;M+=3)r=ph(this,m,e,i,c,u,d,M,M+1,M+2),r&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=g.materialIndex,t.push(r))}else for(let g=Math.max(0,f.start),m=Math.min(l.count,f.start+f.count);g<m;g+=3)r=ph(this,o,e,i,c,u,d,g,g+1,g+2),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}function ph(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,Ra),n.getVertexPosition(l,Pa),n.getVertexPosition(c,Na);const u=function TG(n,e,t,i,r,s,o,a){let l;if(l=e.side===Zn?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side===Ir,a),null===l)return null;fh.copy(a),fh.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(fh);return c<t.near||c>t.far?null:{distance:c,point:fh.clone(),object:n}}(n,e,t,i,Ra,Pa,Na,hh);if(u){r&&(ch.fromBufferAttribute(r,a),uh.fromBufferAttribute(r,l),dh.fromBufferAttribute(r,c),u.uv=di.getInterpolation(hh,Ra,Pa,Na,ch,uh,dh,new ne)),s&&(ch.fromBufferAttribute(s,a),uh.fromBufferAttribute(s,l),dh.fromBufferAttribute(s,c),u.uv1=di.getInterpolation(hh,Ra,Pa,Na,ch,uh,dh,new ne),u.uv2=u.uv1),o&&(RA.fromBufferAttribute(o,a),PA.fromBufferAttribute(o,l),NA.fromBufferAttribute(o,c),u.normal=di.getInterpolation(hh,Ra,Pa,Na,RA,PA,NA,new D),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new D,materialIndex:0};di.getNormal(Ra,Pa,Na,d.normal),u.face=d}return u}class La extends ct{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],d=[];let h=0,f=0;function p(y,g,m,v,_,M,E,S,T,A,x){const b=M/T,U=E/A,$=M/2,N=E/2,F=S/2,V=T+1,O=A+1;let L=0,k=0;const G=new D;for(let Z=0;Z<O;Z++){const ce=Z*U-N;for(let H=0;H<V;H++)G[y]=(H*b-$)*v,G[g]=ce*_,G[m]=F,c.push(G.x,G.y,G.z),G[y]=0,G[g]=0,G[m]=S>0?1:-1,u.push(G.x,G.y,G.z),d.push(H/T),d.push(1-Z/A),L+=1}for(let Z=0;Z<A;Z++)for(let ce=0;ce<T;ce++){const te=h+ce+V*(Z+1),j=h+(ce+1)+V*(Z+1),ye=h+(ce+1)+V*Z;l.push(h+ce+V*Z,te,ye),l.push(te,j,ye),k+=6}a.addGroup(f,k,x),f+=k,h+=L}p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new De(c,3)),this.setAttribute("normal",new De(u,3)),this.setAttribute("uv",new De(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new La(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Oa(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():e[t][i]=Array.isArray(r)?r.slice():r}}return e}function Fn(n){const e={};for(let t=0;t<n.length;t++){const i=Oa(n[t]);for(const r in i)e[r]=i[r]}return e}function LA(n){return null===n.getRenderTarget()?n.outputColorSpace:sr}const DG={clone:Oa,merge:Fn};class ms extends Vi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Oa(e.uniforms),this.uniformsGroups=function AG(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Fy extends yn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new $e,this.projectionMatrix=new $e,this.projectionMatrixInverse=new $e,this.coordinateSystem=Lr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class vn extends Fy{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ya*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Xs*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ya*Math.atan(Math.tan(.5*Xs*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Xs*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class RG extends yn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const r=new vn(-90,1,e,t);r.layers=this.layers,this.add(r);const s=new vn(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new vn(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new vn(-90,1,e,t);a.layers=this.layers,this.add(a);const l=new vn(-90,1,e,t);l.layers=this.layers,this.add(l);const c=new vn(-90,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===Lr)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1)}for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,h=e.xr.enabled;e.toneMapping=Rr,e.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}}class mh extends Fi{constructor(e,t,i,r,s,o,a,l,c,u){super(e=void 0!==e?e:[],t=void 0!==t?t:Vs,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class PG extends Ys{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];void 0!==t.encoding&&(dc("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===$s?We:""),this.texture=new mh(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Ht}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new La(5,5,5),s=new ms({name:"CubemapFromEquirect",uniforms:Oa(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:Zn,blending:ls});s.uniforms.tEquirect.value=t;const o=new In(r,s),a=t.minFilter;return t.minFilter===Pr&&(t.minFilter=Ht),new RG(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const Uy=new D,NG=new D,LG=new at;class Qs{constructor(e=new D(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Uy.subVectors(i,t).cross(NG.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Uy),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||LG.getNormalMatrix(e),r=this.coplanarPoint(Uy).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const eo=new Ui,gh=new D;class ky{constructor(e=new Qs,t=new Qs,i=new Qs,r=new Qs,s=new Qs,o=new Qs){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Lr){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],d=r[6],h=r[7],f=r[8],p=r[9],y=r[10],g=r[11],m=r[12],v=r[13],_=r[14],M=r[15];if(i[0].setComponents(l-s,h-c,g-f,M-m).normalize(),i[1].setComponents(l+s,h+c,g+f,M+m).normalize(),i[2].setComponents(l+o,h+u,g+p,M+v).normalize(),i[3].setComponents(l-o,h-u,g-p,M-v).normalize(),i[4].setComponents(l-a,h-d,g-y,M-_).normalize(),t===Lr)i[5].setComponents(l+a,h+d,g+y,M+_).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(a,d,y,_).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),eo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),eo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(eo)}intersectsSprite(e){return eo.center.set(0,0,0),eo.radius=.7071067811865476,eo.applyMatrix4(e.matrixWorld),this.intersectsSphere(eo)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(gh.x=r.normal.x>0?e.max.x:e.min.x,gh.y=r.normal.y>0?e.max.y:e.min.y,gh.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(gh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function OA(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function OG(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)},remove:function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);u&&(n.deleteBuffer(u.buffer),i.delete(c))},update:function l(c,u){if(c.isGLBufferAttribute){const h=i.get(c);return void((!h||h.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version}))}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);void 0===d?i.set(c,function r(c,u){const d=c.array,h=c.usage,f=n.createBuffer();let p;if(n.bindBuffer(u,f),n.bufferData(u,d,h),c.onUploadCallback(),d instanceof Float32Array)p=n.FLOAT;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=n.HALF_FLOAT}else p=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)p=n.SHORT;else if(d instanceof Uint32Array)p=n.UNSIGNED_INT;else if(d instanceof Int32Array)p=n.INT;else if(d instanceof Int8Array)p=n.BYTE;else if(d instanceof Uint8Array)p=n.UNSIGNED_BYTE;else{if(!(d instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);p=n.UNSIGNED_BYTE}return{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}(c,u)):d.version<c.version&&(function s(c,u,d){const h=u.array,f=u.updateRange;n.bindBuffer(d,c),-1===f.count?n.bufferSubData(d,0,h):(t?n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}(d.buffer,c,u),d.version=c.version)}}}class yh extends ct{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],y=[],g=[];for(let m=0;m<u;m++){const v=m*h-o;for(let _=0;_<c;_++)p.push(_*d-s,-v,0),y.push(0,0,1),g.push(_/a),g.push(1-m/l)}for(let m=0;m<l;m++)for(let v=0;v<a;v++){const M=v+c*(m+1),E=v+1+c*(m+1),S=v+1+c*m;f.push(v+c*m,M,S),f.push(M,E,S)}this.setIndex(f),this.setAttribute("position",new De(p,3)),this.setAttribute("normal",new De(y,3)),this.setAttribute("uv",new De(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yh(e.width,e.height,e.widthSegments,e.heightSegments)}}const lt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},pe={common:{diffuse:{value:new ge(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new at},alphaMap:{value:null},alphaMapTransform:{value:new at},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new at}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new at}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new at}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new at},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new at},normalScale:{value:new ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new at},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new at}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new at}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new at}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ge(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ge(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new at},alphaTest:{value:0},uvTransform:{value:new at}},sprite:{diffuse:{value:new ge(16777215)},opacity:{value:1},center:{value:new ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new at},alphaMap:{value:null},alphaMapTransform:{value:new at},alphaTest:{value:0}}},ar={basic:{uniforms:Fn([pe.common,pe.specularmap,pe.envmap,pe.aomap,pe.lightmap,pe.fog]),vertexShader:lt.meshbasic_vert,fragmentShader:lt.meshbasic_frag},lambert:{uniforms:Fn([pe.common,pe.specularmap,pe.envmap,pe.aomap,pe.lightmap,pe.emissivemap,pe.bumpmap,pe.normalmap,pe.displacementmap,pe.fog,pe.lights,{emissive:{value:new ge(0)}}]),vertexShader:lt.meshlambert_vert,fragmentShader:lt.meshlambert_frag},phong:{uniforms:Fn([pe.common,pe.specularmap,pe.envmap,pe.aomap,pe.lightmap,pe.emissivemap,pe.bumpmap,pe.normalmap,pe.displacementmap,pe.fog,pe.lights,{emissive:{value:new ge(0)},specular:{value:new ge(1118481)},shininess:{value:30}}]),vertexShader:lt.meshphong_vert,fragmentShader:lt.meshphong_frag},standard:{uniforms:Fn([pe.common,pe.envmap,pe.aomap,pe.lightmap,pe.emissivemap,pe.bumpmap,pe.normalmap,pe.displacementmap,pe.roughnessmap,pe.metalnessmap,pe.fog,pe.lights,{emissive:{value:new ge(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:lt.meshphysical_vert,fragmentShader:lt.meshphysical_frag},toon:{uniforms:Fn([pe.common,pe.aomap,pe.lightmap,pe.emissivemap,pe.bumpmap,pe.normalmap,pe.displacementmap,pe.gradientmap,pe.fog,pe.lights,{emissive:{value:new ge(0)}}]),vertexShader:lt.meshtoon_vert,fragmentShader:lt.meshtoon_frag},matcap:{uniforms:Fn([pe.common,pe.bumpmap,pe.normalmap,pe.displacementmap,pe.fog,{matcap:{value:null}}]),vertexShader:lt.meshmatcap_vert,fragmentShader:lt.meshmatcap_frag},points:{uniforms:Fn([pe.points,pe.fog]),vertexShader:lt.points_vert,fragmentShader:lt.points_frag},dashed:{uniforms:Fn([pe.common,pe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:lt.linedashed_vert,fragmentShader:lt.linedashed_frag},depth:{uniforms:Fn([pe.common,pe.displacementmap]),vertexShader:lt.depth_vert,fragmentShader:lt.depth_frag},normal:{uniforms:Fn([pe.common,pe.bumpmap,pe.normalmap,pe.displacementmap,{opacity:{value:1}}]),vertexShader:lt.meshnormal_vert,fragmentShader:lt.meshnormal_frag},sprite:{uniforms:Fn([pe.sprite,pe.fog]),vertexShader:lt.sprite_vert,fragmentShader:lt.sprite_frag},background:{uniforms:{uvTransform:{value:new at},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:lt.background_vert,fragmentShader:lt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:lt.backgroundCube_vert,fragmentShader:lt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:lt.cube_vert,fragmentShader:lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:lt.equirect_vert,fragmentShader:lt.equirect_frag},distanceRGBA:{uniforms:Fn([pe.common,pe.displacementmap,{referencePosition:{value:new D},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:lt.distanceRGBA_vert,fragmentShader:lt.distanceRGBA_frag},shadow:{uniforms:Fn([pe.lights,pe.fog,{color:{value:new ge(0)},opacity:{value:1}}]),vertexShader:lt.shadow_vert,fragmentShader:lt.shadow_frag}};ar.physical={uniforms:Fn([ar.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new at},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new at},clearcoatNormalScale:{value:new ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new at},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new at},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new at},sheen:{value:0},sheenColor:{value:new ge(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new at},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new at},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new at},transmissionSamplerSize:{value:new ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new at},attenuationDistance:{value:0},attenuationColor:{value:new ge(0)},specularColor:{value:new ge(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new at},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new at},anisotropyVector:{value:new ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new at}}]),vertexShader:lt.meshphysical_vert,fragmentShader:lt.meshphysical_frag};const _h={r:0,b:0,g:0};function R5(n,e,t,i,r,s,o){const a=new ge(0);let c,u,l=!0===s?0:1,d=null,h=0,f=null;function y(g,m){g.getRGB(_h,LA(n)),i.buffers.color.setClear(_h.r,_h.g,_h.b,m,o)}return{getClearColor:function(){return a},setClearColor:function(g,m=1){a.set(g),l=m,y(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,y(a,l)},render:function p(g,m){let v=!1,_=!0===m.isScene?m.background:null;switch(_&&_.isTexture&&(_=(m.backgroundBlurriness>0?t:e).get(_)),null===_?y(a,l):_&&_.isColor&&(y(_,1),v=!0),n.xr.getEnvironmentBlendMode()){case"opaque":v=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,o),v=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,o),v=!0}(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),_&&(_.isCubeTexture||_.mapping===rc)?(void 0===u&&(u=new In(new La(1,1,1),new ms({name:"BackgroundCubeMaterial",uniforms:Oa(ar.backgroundCube.uniforms),vertexShader:ar.backgroundCube.vertexShader,fragmentShader:ar.backgroundCube.fragmentShader,side:Zn,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,T,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.toneMapped=_.colorSpace!==We,(d!==_||h!==_.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=_,h=_.version,f=n.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(void 0===c&&(c=new In(new yh(2,2),new ms({name:"BackgroundMaterial",uniforms:Oa(ar.background.uniforms),vertexShader:ar.background.vertexShader,fragmentShader:ar.background.fragmentShader,side:Ir,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=_.colorSpace!==We,!0===_.matrixAutoUpdate&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(d!==_||h!==_.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,d=_,h=_.version,f=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}}}function P5(n,e,t,i){const r=n.getParameter(n.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=g(null);let c=l,u=!1;function f(F){return i.isWebGL2?n.bindVertexArray(F):s.bindVertexArrayOES(F)}function p(F){return i.isWebGL2?n.deleteVertexArray(F):s.deleteVertexArrayOES(F)}function g(F){const V=[],O=[],L=[];for(let k=0;k<r;k++)V[k]=0,O[k]=0,L[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:O,attributeDivisors:L,object:F,attributes:{},index:null}}function _(){const F=c.newAttributes;for(let V=0,O=F.length;V<O;V++)F[V]=0}function M(F){E(F,0)}function E(F,V){const L=c.enabledAttributes,k=c.attributeDivisors;c.newAttributes[F]=1,0===L[F]&&(n.enableVertexAttribArray(F),L[F]=1),k[F]!==V&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](F,V),k[F]=V)}function S(){const F=c.newAttributes,V=c.enabledAttributes;for(let O=0,L=V.length;O<L;O++)V[O]!==F[O]&&(n.disableVertexAttribArray(O),V[O]=0)}function T(F,V,O,L,k,G,Z){!0===Z?n.vertexAttribIPointer(F,V,O,k,G):n.vertexAttribPointer(F,V,O,L,k,G)}function $(){N(),u=!0,c!==l&&(c=l,f(c.object))}function N(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function d(F,V,O,L,k){let G=!1;if(o){const Z=function y(F,V,O){const L=!0===O.wireframe;let k=a[F.id];void 0===k&&(k={},a[F.id]=k);let G=k[V.id];void 0===G&&(G={},k[V.id]=G);let Z=G[L];return void 0===Z&&(Z=g(function h(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),G[L]=Z),Z}(L,O,V);c!==Z&&(c=Z,f(c.object)),G=function m(F,V,O,L){const k=c.attributes,G=V.attributes;let Z=0;const ce=O.getAttributes();for(const H in ce)if(ce[H].location>=0){const j=k[H];let ye=G[H];if(void 0===ye&&("instanceMatrix"===H&&F.instanceMatrix&&(ye=F.instanceMatrix),"instanceColor"===H&&F.instanceColor&&(ye=F.instanceColor)),void 0===j||j.attribute!==ye||ye&&j.data!==ye.data)return!0;Z++}return c.attributesNum!==Z||c.index!==L}(F,L,O,k),G&&function v(F,V,O,L){const k={},G=V.attributes;let Z=0;const ce=O.getAttributes();for(const H in ce)if(ce[H].location>=0){let j=G[H];void 0===j&&("instanceMatrix"===H&&F.instanceMatrix&&(j=F.instanceMatrix),"instanceColor"===H&&F.instanceColor&&(j=F.instanceColor));const ye={};ye.attribute=j,j&&j.data&&(ye.data=j.data),k[H]=ye,Z++}c.attributes=k,c.attributesNum=Z,c.index=L}(F,L,O,k)}else{const Z=!0===V.wireframe;(c.geometry!==L.id||c.program!==O.id||c.wireframe!==Z)&&(c.geometry=L.id,c.program=O.id,c.wireframe=Z,G=!0)}null!==k&&t.update(k,n.ELEMENT_ARRAY_BUFFER),(G||u)&&(u=!1,function A(F,V,O,L){if(!1===i.isWebGL2&&(F.isInstancedMesh||L.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;_();const k=L.attributes,G=O.getAttributes(),Z=V.defaultAttributeValues;for(const ce in G){const H=G[ce];if(H.location>=0){let te=k[ce];if(void 0===te&&("instanceMatrix"===ce&&F.instanceMatrix&&(te=F.instanceMatrix),"instanceColor"===ce&&F.instanceColor&&(te=F.instanceColor)),void 0!==te){const j=te.normalized,ye=te.itemSize,me=t.get(te);if(void 0===me)continue;const he=me.buffer,Re=me.type,Ae=me.bytesPerElement,rt=!0===i.isWebGL2&&(Re===n.INT||Re===n.UNSIGNED_INT||1013===te.gpuType);if(te.isInterleavedBufferAttribute){const Le=te.data,R=Le.stride,ue=te.offset;if(Le.isInstancedInterleavedBuffer){for(let Q=0;Q<H.locationSize;Q++)E(H.location+Q,Le.meshPerAttribute);!0!==F.isInstancedMesh&&void 0===L._maxInstanceCount&&(L._maxInstanceCount=Le.meshPerAttribute*Le.count)}else for(let Q=0;Q<H.locationSize;Q++)M(H.location+Q);n.bindBuffer(n.ARRAY_BUFFER,he);for(let Q=0;Q<H.locationSize;Q++)T(H.location+Q,ye/H.locationSize,Re,j,R*Ae,(ue+ye/H.locationSize*Q)*Ae,rt)}else{if(te.isInstancedBufferAttribute){for(let Le=0;Le<H.locationSize;Le++)E(H.location+Le,te.meshPerAttribute);!0!==F.isInstancedMesh&&void 0===L._maxInstanceCount&&(L._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let Le=0;Le<H.locationSize;Le++)M(H.location+Le);n.bindBuffer(n.ARRAY_BUFFER,he);for(let Le=0;Le<H.locationSize;Le++)T(H.location+Le,ye/H.locationSize,Re,j,ye*Ae,ye/H.locationSize*Le*Ae,rt)}}else if(void 0!==Z){const j=Z[ce];if(void 0!==j)switch(j.length){case 2:n.vertexAttrib2fv(H.location,j);break;case 3:n.vertexAttrib3fv(H.location,j);break;case 4:n.vertexAttrib4fv(H.location,j);break;default:n.vertexAttrib1fv(H.location,j)}}}}S()}(F,V,O,L),null!==k&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(k).buffer))},reset:$,resetDefaultState:N,dispose:function x(){$();for(const F in a){const V=a[F];for(const O in V){const L=V[O];for(const k in L)p(L[k].object),delete L[k];delete V[O]}delete a[F]}},releaseStatesOfGeometry:function b(F){if(void 0===a[F.id])return;const V=a[F.id];for(const O in V){const L=V[O];for(const k in L)p(L[k].object),delete L[k];delete V[O]}delete a[F.id]},releaseStatesOfProgram:function U(F){for(const V in a){const O=a[V];if(void 0===O[F.id])continue;const L=O[F.id];for(const k in L)p(L[k].object),delete L[k];delete O[F.id]}},initAttributes:_,enableAttribute:M,disableUnusedAttributes:S}}function N5(n,e,t,i){const r=i.isWebGL2;let s;this.setMode=function o(c){s=c},this.render=function a(c,u){n.drawArrays(s,c,u),t.update(u,s,1)},this.renderInstances=function l(c,u,d){if(0===d)return;let h,f;if(r)h=n,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===h)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](s,c,u,d),t.update(u,s,d)}}function L5(n,e,t){let i;function s(T){if("highp"===T){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return"mediump"===T&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&"WebGL2RenderingContext"===n.constructor.name;let a=void 0!==t.precision?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),h=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_TEXTURE_SIZE),p=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),g=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),m=n.getParameter(n.MAX_VARYING_VECTORS),v=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),_=h>0,M=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const T=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:y,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:M,floatVertexTextures:_&&M,maxSamples:o?n.getParameter(n.MAX_SAMPLES):0}}function O5(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Qs,a=new at,l={value:null,needsUpdate:!1};function u(d,h,f,p){const y=null!==d?d.length:0;let g=null;if(0!==y){if(g=l.value,!0!==p||null===g){const m=f+4*y,v=h.matrixWorldInverse;a.getNormalMatrix(v),(null===g||g.length<m)&&(g=new Float32Array(m));for(let _=0,M=f;_!==y;++_,M+=4)o.copy(d[_]).applyMatrix4(v,a),o.normal.toArray(g,M),g[M+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=0!==d.length||h||0!==i||r;return r=h,i=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const p=d.clippingPlanes,y=d.clipIntersection,g=d.clipShadows,m=n.get(d);if(!r||null===p||0===p.length||s&&!g)s?u(null):function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const v=s?0:i,_=4*v;let M=m.clippingState||null;l.value=M,M=u(p,h,_,f);for(let E=0;E!==_;++E)M[E]=t[E];m.clippingState=M,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=v}}}function F5(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=Vs:304===a&&(o.mapping=Hs),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);void 0!==l&&(e.delete(a),l.dispose())}return{get:function i(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const c=new PG(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class vh extends Fy{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(null!==this.view&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const FA=[.125,.215,.35,.446,.526,.582],By=new vh,UA=new ge;let Vy=null;const no=(1+Math.sqrt(5))/2,Ba=1/no,kA=[new D(1,1,1),new D(-1,1,1),new D(1,1,-1),new D(-1,1,-1),new D(0,no,Ba),new D(0,no,-Ba),new D(Ba,0,no),new D(-Ba,0,no),new D(no,Ba,0),new D(-no,Ba,0)];class BA{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Vy=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=zA(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=HA(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Vy),e.scissorTest=!1,Mh(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Vs||e.mapping===Hs?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),Vy=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ht,minFilter:Ht,generateMipmaps:!1,type:ac,format:Ei,colorSpace:sr,depthBuffer:!1},r=VA(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=VA(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function U5(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+FA.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-4?l=FA[o-n+4-1]:0===o&&(l=0),i.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,y=3,g=2,m=1,v=new Float32Array(y*p*f),_=new Float32Array(g*p*f),M=new Float32Array(m*p*f);for(let S=0;S<f;S++){const T=S%3*2/3-1,A=S>2?0:-1;v.set([T,A,0,T+2/3,A,0,T+2/3,A+1,0,T,A,0,T+2/3,A+1,0,T,A+1,0],y*p*S),_.set(h,g*p*S),M.set([S,S,S,S,S,S],m*p*S)}const E=new ct;E.setAttribute("position",new Gt(v,y)),E.setAttribute("uv",new Gt(_,g)),E.setAttribute("faceIndex",new Gt(M,m)),e.push(E),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function k5(n,e,t){const i=new Float32Array(20),r=new D(0,1,0);return new ms({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:ls,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new In(this._lodPlanes[0],e);this._renderer.compile(t,By)}_sceneToCubeUV(e,t,i,r){const a=new vn(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(UA),u.toneMapping=Rr,u.autoClear=!1;const f=new Si({name:"PMREM.Background",side:Zn,depthWrite:!1,depthTest:!1}),p=new In(new La,f);let y=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,y=!0):(f.color.copy(UA),y=!0);for(let m=0;m<6;m++){const v=m%3;0===v?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):1===v?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m]));const _=this._cubeSize;Mh(r,v*_,m>2?_:0,_,_),u.setRenderTarget(r),y&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Vs||e.mapping===Hs;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=zA()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=HA());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new In(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const l=this._cubeSize;Mh(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,By)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,s,kA[(r-1)%kA.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new In(this._lodPlanes[r],c),h=c.uniforms,f=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,y=s/p,g=isFinite(s)?1+Math.floor(3*y):20;g>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const m=[];let v=0;for(let T=0;T<20;++T){const A=T/y,x=Math.exp(-A*A/2);m.push(x),0===T?v+=x:T<g&&(v+=2*x)}for(let T=0;T<m.length;T++)m[T]=m[T]/v;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=m,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:_}=this;h.dTheta.value=p,h.mipInt.value=_-i;const M=this._sizeLods[r];Mh(t,3*M*(r>_-4?r-_+4:0),4*(this._cubeSize-M),3*M,2*M),l.setRenderTarget(t),l.render(d,By)}}function VA(n,e,t){const i=new Ys(n,e,t);return i.texture.mapping=rc,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Mh(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function HA(){return new ms({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:ls,depthTest:!1,depthWrite:!1})}function zA(){return new ms({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:ls,depthTest:!1,depthWrite:!1})}function B5(n){let e=new WeakMap,t=null;function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);void 0!==c&&(e.delete(l),c.dispose())}return{get:function i(a){if(a&&a.isTexture){const l=a.mapping,c=303===l||304===l,u=l===Vs||l===Hs;if(c||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let d=e.get(a);return null===t&&(t=new BA(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&function r(a){let l=0;for(let u=0;u<6;u++)void 0!==a[u]&&l++;return 6===l}(d)){null===t&&(t=new BA(n));const h=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,h),a.addEventListener("dispose",s),h.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function V5(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function H5(n,e,t,i){const r={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);for(const p in h.morphAttributes){const y=h.morphAttributes[p];for(let g=0,m=y.length;g<m;g++)e.remove(y[g])}h.removeEventListener("dispose",o),delete r[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),i.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function c(d){const h=[],f=d.index,p=d.attributes.position;let y=0;if(null!==f){const v=f.array;y=f.version;for(let _=0,M=v.length;_<M;_+=3){const E=v[_+0],S=v[_+1],T=v[_+2];h.push(E,S,S,T,T,E)}}else{y=p.version;for(let _=0,M=p.array.length/3-1;_<M;_+=3){const E=_+0,S=_+1,T=_+2;h.push(E,S,S,T,T,E)}}const g=new(fA(h)?DA:AA)(h,1);g.version=y;const m=s.get(d);m&&e.remove(m),s.set(d,g)}return{get:function a(d,h){return!0===r[h.id]||(h.addEventListener("dispose",o),r[h.id]=!0,t.memory.geometries++),h},update:function l(d){const h=d.attributes;for(const p in h)e.update(h[p],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const p in f){const y=f[p];for(let g=0,m=y.length;g<m;g++)e.update(y[g],n.ARRAY_BUFFER)}},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&c(d)}else c(d);return s.get(d)}}}function z5(n,e,t,i){const r=i.isWebGL2;let s,a,l;this.setMode=function o(h){s=h},this.setIndex=function c(h){a=h.type,l=h.bytesPerElement},this.render=function u(h,f){n.drawElements(s,f,a,h*l),t.update(f,s,1)},this.renderInstances=function d(h,f,p){if(0===p)return;let y,g;if(r)y=n,g="drawElementsInstanced";else if(y=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===y)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");y[g](s,f,a,h*l,p),t.update(f,s,p)}}function G5(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function W5(n,e){return n[0]-e[0]}function $5(n,e){return Math.abs(e[1])-Math.abs(n[1])}function j5(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,o=new bt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];return{update:function l(c,u,d){const h=c.morphTargetInfluences;if(!0===e.isWebGL2){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==f?f.length:0;let y=s.get(u);if(void 0===y||y.count!==p){let F=function(){$.dispose(),s.delete(u),u.removeEventListener("dispose",F)};void 0!==y&&y.texture.dispose();const v=void 0!==u.morphAttributes.position,_=void 0!==u.morphAttributes.normal,M=void 0!==u.morphAttributes.color,E=u.morphAttributes.position||[],S=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let A=0;!0===v&&(A=1),!0===_&&(A=2),!0===M&&(A=3);let x=u.attributes.position.count*A,b=1;x>e.maxTextureSize&&(b=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const U=new Float32Array(x*b*4*p),$=new xy(U,x,b,p);$.type=Nr,$.needsUpdate=!0;const N=4*A;for(let V=0;V<p;V++){const O=E[V],L=S[V],k=T[V],G=x*b*4*V;for(let Z=0;Z<O.count;Z++){const ce=Z*N;!0===v&&(o.fromBufferAttribute(O,Z),U[G+ce+0]=o.x,U[G+ce+1]=o.y,U[G+ce+2]=o.z,U[G+ce+3]=0),!0===_&&(o.fromBufferAttribute(L,Z),U[G+ce+4]=o.x,U[G+ce+5]=o.y,U[G+ce+6]=o.z,U[G+ce+7]=0),!0===M&&(o.fromBufferAttribute(k,Z),U[G+ce+8]=o.x,U[G+ce+9]=o.y,U[G+ce+10]=o.z,U[G+ce+11]=4===k.itemSize?o.w:1)}}y={count:p,texture:$,size:new ne(x,b)},s.set(u,y),u.addEventListener("dispose",F)}let g=0;for(let v=0;v<h.length;v++)g+=h[v];const m=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(n,"morphTargetBaseInfluence",m),d.getUniforms().setValue(n,"morphTargetInfluences",h),d.getUniforms().setValue(n,"morphTargetsTexture",y.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const f=void 0===h?0:h.length;let p=i[u.id];if(void 0===p||p.length!==f){p=[];for(let _=0;_<f;_++)p[_]=[_,0];i[u.id]=p}for(let _=0;_<f;_++){const M=p[_];M[0]=_,M[1]=h[_]}p.sort($5);for(let _=0;_<8;_++)_<f&&p[_][1]?(a[_][0]=p[_][0],a[_][1]=p[_][1]):(a[_][0]=Number.MAX_SAFE_INTEGER,a[_][1]=0);a.sort(W5);const y=u.morphAttributes.position,g=u.morphAttributes.normal;let m=0;for(let _=0;_<8;_++){const M=a[_],E=M[0],S=M[1];E!==Number.MAX_SAFE_INTEGER&&S?(y&&u.getAttribute("morphTarget"+_)!==y[E]&&u.setAttribute("morphTarget"+_,y[E]),g&&u.getAttribute("morphNormal"+_)!==g[E]&&u.setAttribute("morphNormal"+_,g[E]),r[_]=S,m+=S):(y&&!0===u.hasAttribute("morphTarget"+_)&&u.deleteAttribute("morphTarget"+_),g&&!0===u.hasAttribute("morphNormal"+_)&&u.deleteAttribute("morphNormal"+_),r[_]=0)}const v=u.morphTargetsRelative?1:1-m;d.getUniforms().setValue(n,"morphTargetBaseInfluence",v),d.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function q5(n,e,t,i){let r=new WeakMap;function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),null!==c.instanceColor&&t.remove(c.instanceColor)}return{update:function s(l){const c=i.render.frame,d=e.get(l,l.geometry);return r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,n.ARRAY_BUFFER),null!==l.instanceColor&&t.update(l.instanceColor,n.ARRAY_BUFFER)),d},dispose:function o(){r=new WeakMap}}}const GA=new Fi,WA=new xy,$A=new gA,jA=new mh,qA=[],XA=[],YA=new Float32Array(16),KA=new Float32Array(9),ZA=new Float32Array(4);function Va(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=qA[r];if(void 0===s&&(s=new Float32Array(r),qA[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function pn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function mn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function xh(n,e){let t=XA[e];void 0===t&&(t=new Int32Array(e),XA[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function X5(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Y5(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pn(t,e))return;n.uniform2fv(this.addr,e),mn(t,e)}}function K5(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(pn(t,e))return;n.uniform3fv(this.addr,e),mn(t,e)}}function Z5(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pn(t,e))return;n.uniform4fv(this.addr,e),mn(t,e)}}function J5(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(pn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),mn(t,e)}else{if(pn(t,i))return;ZA.set(i),n.uniformMatrix2fv(this.addr,!1,ZA),mn(t,i)}}function Q5(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(pn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),mn(t,e)}else{if(pn(t,i))return;KA.set(i),n.uniformMatrix3fv(this.addr,!1,KA),mn(t,i)}}function eW(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(pn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),mn(t,e)}else{if(pn(t,i))return;YA.set(i),n.uniformMatrix4fv(this.addr,!1,YA),mn(t,i)}}function tW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function nW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pn(t,e))return;n.uniform2iv(this.addr,e),mn(t,e)}}function iW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(pn(t,e))return;n.uniform3iv(this.addr,e),mn(t,e)}}function rW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pn(t,e))return;n.uniform4iv(this.addr,e),mn(t,e)}}function sW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function oW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pn(t,e))return;n.uniform2uiv(this.addr,e),mn(t,e)}}function aW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(pn(t,e))return;n.uniform3uiv(this.addr,e),mn(t,e)}}function lW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pn(t,e))return;n.uniform4uiv(this.addr,e),mn(t,e)}}function cW(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||GA,r)}function uW(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||$A,r)}function dW(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||jA,r)}function hW(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||WA,r)}function pW(n,e){n.uniform1fv(this.addr,e)}function mW(n,e){const t=Va(e,this.size,2);n.uniform2fv(this.addr,t)}function gW(n,e){const t=Va(e,this.size,3);n.uniform3fv(this.addr,t)}function yW(n,e){const t=Va(e,this.size,4);n.uniform4fv(this.addr,t)}function _W(n,e){const t=Va(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function vW(n,e){const t=Va(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function MW(n,e){const t=Va(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function xW(n,e){n.uniform1iv(this.addr,e)}function EW(n,e){n.uniform2iv(this.addr,e)}function SW(n,e){n.uniform3iv(this.addr,e)}function wW(n,e){n.uniform4iv(this.addr,e)}function bW(n,e){n.uniform1uiv(this.addr,e)}function TW(n,e){n.uniform2uiv(this.addr,e)}function AW(n,e){n.uniform3uiv(this.addr,e)}function DW(n,e){n.uniform4uiv(this.addr,e)}function CW(n,e,t){const i=this.cache,r=e.length,s=xh(t,r);pn(i,s)||(n.uniform1iv(this.addr,s),mn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||GA,s[o])}function IW(n,e,t){const i=this.cache,r=e.length,s=xh(t,r);pn(i,s)||(n.uniform1iv(this.addr,s),mn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||$A,s[o])}function RW(n,e,t){const i=this.cache,r=e.length,s=xh(t,r);pn(i,s)||(n.uniform1iv(this.addr,s),mn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||jA,s[o])}function PW(n,e,t){const i=this.cache,r=e.length,s=xh(t,r);pn(i,s)||(n.uniform1iv(this.addr,s),mn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||WA,s[o])}class LW{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function fW(n){switch(n){case 5126:return X5;case 35664:return Y5;case 35665:return K5;case 35666:return Z5;case 35674:return J5;case 35675:return Q5;case 35676:return eW;case 5124:case 35670:return tW;case 35667:case 35671:return nW;case 35668:case 35672:return iW;case 35669:case 35673:return rW;case 5125:return sW;case 36294:return oW;case 36295:return aW;case 36296:return lW;case 35678:case 36198:case 36298:case 36306:case 35682:return cW;case 35679:case 36299:case 36307:return uW;case 35680:case 36300:case 36308:case 36293:return dW;case 36289:case 36303:case 36311:case 36292:return hW}}(t.type)}}class OW{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function NW(n){switch(n){case 5126:return pW;case 35664:return mW;case 35665:return gW;case 35666:return yW;case 35674:return _W;case 35675:return vW;case 35676:return MW;case 5124:case 35670:return xW;case 35667:case 35671:return EW;case 35668:case 35672:return SW;case 35669:case 35673:return wW;case 5125:return bW;case 36294:return TW;case 36295:return AW;case 36296:return DW;case 35678:case 36198:case 36298:case 36306:case 35682:return CW;case 35679:case 36299:case 36307:return IW;case 35680:case 36300:case 36308:case 36293:return RW;case 36289:case 36303:case 36311:case 36292:return PW}}(t.type)}}class FW{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const zy=/(\w+)(\])?(\[|\.)?/g;function JA(n,e){n.seq.push(e),n.map[e.id]=e}function UW(n,e,t){const i=n.name,r=i.length;for(zy.lastIndex=0;;){const s=zy.exec(i);let a=s[1];const c=s[3];if("]"===s[2]&&(a|=0),void 0===c||"["===c&&zy.lastIndex+2===r){JA(t,void 0===c?new LW(a,n,e):new OW(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new FW(a),JA(t,d)),t=d}}}class Eh{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);UW(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];!1!==l.needsUpdate&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function QA(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let kW=0;function eD(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function BW(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),o)}return r}function HW(n,e){const t=function VW(n){switch(n){case sr:return["Linear","( value )"];case We:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function zW(n,e){let t;switch(e){case gz:t="Linear";break;case yz:t="Reinhard";break;case _z:t="OptimizedCineon";break;case vz:t="ACESFilmic";break;case Mz:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function _c(n){return""!==n}function tD(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function nD(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const jW=/^[ \t]*#include +<([\w\d./]+)>/gm;function Gy(n){return n.replace(jW,qW)}function qW(n,e){const t=lt[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return Gy(t)}const XW=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function iD(n){return n.replace(XW,YW)}function YW(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function rD(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function t8(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=function KW(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===ST?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===XH?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Cr&&(e="SHADOWMAP_TYPE_VSM"),e}(t),c=function ZW(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Vs:case Hs:e="ENVMAP_TYPE_CUBE";break;case rc:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function JW(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===Hs&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function QW(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Wd:e="ENVMAP_BLENDING_MULTIPLY";break;case pz:e="ENVMAP_BLENDING_MIX";break;case mz:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function e8(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),f=t.isWebGL2?"":function GW(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_c).join("\n")}(t),p=function WW(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),y=r.createProgram();let g,m,v=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(_c).join("\n"),g.length>0&&(g+="\n"),m=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(_c).join("\n"),m.length>0&&(m+="\n")):(g=[rD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_c).join("\n"),m=[f,rD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Rr?"#define TONE_MAPPING":"",t.toneMapping!==Rr?lt.tonemapping_pars_fragment:"",t.toneMapping!==Rr?zW("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",lt.encodings_pars_fragment,HW("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(_c).join("\n")),o=Gy(o),o=tD(o,t),o=nD(o,t),a=Gy(a),a=tD(a,t),a=nD(a,t),o=iD(o),a=iD(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,m=["#define varying in",t.glslVersion===uA?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===uA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+m);const M=v+m+a,E=QA(r,r.VERTEX_SHADER,v+g+o),S=QA(r,r.FRAGMENT_SHADER,M);if(r.attachShader(y,E),r.attachShader(y,S),void 0!==t.index0AttributeName?r.bindAttribLocation(y,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),n.debug.checkShaderErrors){const x=r.getProgramInfoLog(y).trim(),b=r.getShaderInfoLog(E).trim(),U=r.getShaderInfoLog(S).trim();let $=!0,N=!0;if(!1===r.getProgramParameter(y,r.LINK_STATUS))if($=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(r,y,E,S);else{const F=eD(r,E,"vertex"),V=eD(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(y,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+x+"\n"+F+"\n"+V)}else""!==x?console.warn("THREE.WebGLProgram: Program Info Log:",x):(""===b||""===U)&&(N=!1);N&&(this.diagnostics={runnable:$,programLog:x,vertexShader:{log:b,prefix:g},fragmentShader:{log:U,prefix:m}})}let T,A;return r.deleteShader(E),r.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new Eh(r,y)),T},this.getAttributes=function(){return void 0===A&&(A=function $W(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,y)),A},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=kW++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=E,this.fragmentShader=S,this}let n8=0;class i8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new r8(e),t.set(e,i)),i}}class r8{constructor(e){this.id=n8++,this.code=e,this.usedTimes=0}}function s8(n,e,t,i,r,s,o){const a=new Dy,l=new i8,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,h=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(x){return 0===x?"uv":`uv${x}`}return{getParameters:function g(x,b,U,$,N){const F=$.fog,V=N.geometry,L=(x.isMeshStandardMaterial?t:e).get(x.envMap||(x.isMeshStandardMaterial?$.environment:null)),k=L&&L.mapping===rc?L.image.height:null,G=p[x.type];null!==x.precision&&(f=r.getMaxPrecision(x.precision),f!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",f,"instead."));const Z=V.morphAttributes.position||V.morphAttributes.normal||V.morphAttributes.color,ce=void 0!==Z?Z.length:0;let te,j,ye,me,H=0;if(void 0!==V.morphAttributes.position&&(H=1),void 0!==V.morphAttributes.normal&&(H=2),void 0!==V.morphAttributes.color&&(H=3),G){const on=ar[G];te=on.vertexShader,j=on.fragmentShader}else te=x.vertexShader,j=x.fragmentShader,l.update(x),ye=l.getVertexShaderID(x),me=l.getFragmentShaderID(x);const he=n.getRenderTarget(),Re=!0===N.isInstancedMesh,Ae=!!x.map,Le=!!L,R=!!x.aoMap,ue=!!x.lightMap,Q=!!x.bumpMap,de=!!x.normalMap,re=!!x.displacementMap,Pe=!!x.emissiveMap,we=!!x.metalnessMap,be=!!x.roughnessMap,et=x.anisotropy>0,mt=x.clearcoat>0,$t=x.iridescence>0,I=x.sheen>0,w=x.transmission>0,q=et&&!!x.anisotropyMap,oe=mt&&!!x.clearcoatMap,ae=mt&&!!x.clearcoatNormalMap,_e=mt&&!!x.clearcoatRoughnessMap,Ne=$t&&!!x.iridescenceMap,ve=$t&&!!x.iridescenceThicknessMap,K=I&&!!x.sheenColorMap,Fe=I&&!!x.sheenRoughnessMap,Ue=!!x.specularMap,Ve=!!x.specularColorMap,Ce=!!x.specularIntensityMap,Ie=w&&!!x.transmissionMap,dt=w&&!!x.thicknessMap,P=!!x.alphaMap,W=!!x.extensions,fe=!!V.attributes.uv1,Se=!!V.attributes.uv2,vt=!!V.attributes.uv3;return{isWebGL2:u,shaderID:G,shaderType:x.type,shaderName:x.name,vertexShader:te,fragmentShader:j,defines:x.defines,customVertexShaderID:ye,customFragmentShaderID:me,isRawShaderMaterial:!0===x.isRawShaderMaterial,glslVersion:x.glslVersion,precision:f,instancing:Re,instancingColor:Re&&null!==N.instanceColor,supportsVertexTextures:h,outputColorSpace:null===he?n.outputColorSpace:!0===he.isXRRenderTarget?he.texture.colorSpace:sr,map:Ae,matcap:!!x.matcap,envMap:Le,envMapMode:Le&&L.mapping,envMapCubeUVHeight:k,aoMap:R,lightMap:ue,bumpMap:Q,normalMap:de,displacementMap:h&&re,emissiveMap:Pe,normalMapObjectSpace:de&&1===x.normalMapType,normalMapTangentSpace:de&&x.normalMapType===js,metalnessMap:we,roughnessMap:be,anisotropy:et,anisotropyMap:q,clearcoat:mt,clearcoatMap:oe,clearcoatNormalMap:ae,clearcoatRoughnessMap:_e,iridescence:$t,iridescenceMap:Ne,iridescenceThicknessMap:ve,sheen:I,sheenColorMap:K,sheenRoughnessMap:Fe,specularMap:Ue,specularColorMap:Ve,specularIntensityMap:Ce,transmission:w,transmissionMap:Ie,thicknessMap:dt,gradientMap:!!x.gradientMap,opaque:!1===x.transparent&&1===x.blending,alphaMap:P,alphaTest:x.alphaTest>0,combine:x.combine,mapUv:Ae&&y(x.map.channel),aoMapUv:R&&y(x.aoMap.channel),lightMapUv:ue&&y(x.lightMap.channel),bumpMapUv:Q&&y(x.bumpMap.channel),normalMapUv:de&&y(x.normalMap.channel),displacementMapUv:re&&y(x.displacementMap.channel),emissiveMapUv:Pe&&y(x.emissiveMap.channel),metalnessMapUv:we&&y(x.metalnessMap.channel),roughnessMapUv:be&&y(x.roughnessMap.channel),anisotropyMapUv:q&&y(x.anisotropyMap.channel),clearcoatMapUv:oe&&y(x.clearcoatMap.channel),clearcoatNormalMapUv:ae&&y(x.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:_e&&y(x.clearcoatRoughnessMap.channel),iridescenceMapUv:Ne&&y(x.iridescenceMap.channel),iridescenceThicknessMapUv:ve&&y(x.iridescenceThicknessMap.channel),sheenColorMapUv:K&&y(x.sheenColorMap.channel),sheenRoughnessMapUv:Fe&&y(x.sheenRoughnessMap.channel),specularMapUv:Ue&&y(x.specularMap.channel),specularColorMapUv:Ve&&y(x.specularColorMap.channel),specularIntensityMapUv:Ce&&y(x.specularIntensityMap.channel),transmissionMapUv:Ie&&y(x.transmissionMap.channel),thicknessMapUv:dt&&y(x.thicknessMap.channel),alphaMapUv:P&&y(x.alphaMap.channel),vertexTangents:!!V.attributes.tangent&&(de||et),vertexColors:x.vertexColors,vertexAlphas:!0===x.vertexColors&&!!V.attributes.color&&4===V.attributes.color.itemSize,vertexUv1s:fe,vertexUv2s:Se,vertexUv3s:vt,pointsUvs:!0===N.isPoints&&!!V.attributes.uv&&(Ae||P),fog:!!F,useFog:!0===x.fog,fogExp2:F&&F.isFogExp2,flatShading:!0===x.flatShading,sizeAttenuation:!0===x.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===N.isSkinnedMesh,morphTargets:void 0!==V.morphAttributes.position,morphNormals:void 0!==V.morphAttributes.normal,morphColors:void 0!==V.morphAttributes.color,morphTargetsCount:ce,morphTextureStride:H,numDirLights:b.directional.length,numPointLights:b.point.length,numSpotLights:b.spot.length,numSpotLightMaps:b.spotLightMap.length,numRectAreaLights:b.rectArea.length,numHemiLights:b.hemi.length,numDirLightShadows:b.directionalShadowMap.length,numPointLightShadows:b.pointShadowMap.length,numSpotLightShadows:b.spotShadowMap.length,numSpotLightShadowsWithMaps:b.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:x.dithering,shadowMapEnabled:n.shadowMap.enabled&&U.length>0,shadowMapType:n.shadowMap.type,toneMapping:x.toneMapped?n.toneMapping:Rr,useLegacyLights:n.useLegacyLights,premultipliedAlpha:x.premultipliedAlpha,doubleSided:x.side===rr,flipSided:x.side===Zn,useDepthPacking:x.depthPacking>=0,depthPacking:x.depthPacking||0,index0AttributeName:x.index0AttributeName,extensionDerivatives:W&&!0===x.extensions.derivatives,extensionFragDepth:W&&!0===x.extensions.fragDepth,extensionDrawBuffers:W&&!0===x.extensions.drawBuffers,extensionShaderTextureLOD:W&&!0===x.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:x.customProgramCacheKey()}},getProgramCacheKey:function m(x){const b=[];if(x.shaderID?b.push(x.shaderID):(b.push(x.customVertexShaderID),b.push(x.customFragmentShaderID)),void 0!==x.defines)for(const U in x.defines)b.push(U),b.push(x.defines[U]);return!1===x.isRawShaderMaterial&&(function v(x,b){x.push(b.precision),x.push(b.outputColorSpace),x.push(b.envMapMode),x.push(b.envMapCubeUVHeight),x.push(b.mapUv),x.push(b.alphaMapUv),x.push(b.lightMapUv),x.push(b.aoMapUv),x.push(b.bumpMapUv),x.push(b.normalMapUv),x.push(b.displacementMapUv),x.push(b.emissiveMapUv),x.push(b.metalnessMapUv),x.push(b.roughnessMapUv),x.push(b.anisotropyMapUv),x.push(b.clearcoatMapUv),x.push(b.clearcoatNormalMapUv),x.push(b.clearcoatRoughnessMapUv),x.push(b.iridescenceMapUv),x.push(b.iridescenceThicknessMapUv),x.push(b.sheenColorMapUv),x.push(b.sheenRoughnessMapUv),x.push(b.specularMapUv),x.push(b.specularColorMapUv),x.push(b.specularIntensityMapUv),x.push(b.transmissionMapUv),x.push(b.thicknessMapUv),x.push(b.combine),x.push(b.fogExp2),x.push(b.sizeAttenuation),x.push(b.morphTargetsCount),x.push(b.morphAttributeCount),x.push(b.numDirLights),x.push(b.numPointLights),x.push(b.numSpotLights),x.push(b.numSpotLightMaps),x.push(b.numHemiLights),x.push(b.numRectAreaLights),x.push(b.numDirLightShadows),x.push(b.numPointLightShadows),x.push(b.numSpotLightShadows),x.push(b.numSpotLightShadowsWithMaps),x.push(b.shadowMapType),x.push(b.toneMapping),x.push(b.numClippingPlanes),x.push(b.numClipIntersection),x.push(b.depthPacking)}(b,x),function _(x,b){a.disableAll(),b.isWebGL2&&a.enable(0),b.supportsVertexTextures&&a.enable(1),b.instancing&&a.enable(2),b.instancingColor&&a.enable(3),b.matcap&&a.enable(4),b.envMap&&a.enable(5),b.normalMapObjectSpace&&a.enable(6),b.normalMapTangentSpace&&a.enable(7),b.clearcoat&&a.enable(8),b.iridescence&&a.enable(9),b.alphaTest&&a.enable(10),b.vertexColors&&a.enable(11),b.vertexAlphas&&a.enable(12),b.vertexUv1s&&a.enable(13),b.vertexUv2s&&a.enable(14),b.vertexUv3s&&a.enable(15),b.vertexTangents&&a.enable(16),b.anisotropy&&a.enable(17),x.push(a.mask),a.disableAll(),b.fog&&a.enable(0),b.useFog&&a.enable(1),b.flatShading&&a.enable(2),b.logarithmicDepthBuffer&&a.enable(3),b.skinning&&a.enable(4),b.morphTargets&&a.enable(5),b.morphNormals&&a.enable(6),b.morphColors&&a.enable(7),b.premultipliedAlpha&&a.enable(8),b.shadowMapEnabled&&a.enable(9),b.useLegacyLights&&a.enable(10),b.doubleSided&&a.enable(11),b.flipSided&&a.enable(12),b.useDepthPacking&&a.enable(13),b.dithering&&a.enable(14),b.transmission&&a.enable(15),b.sheen&&a.enable(16),b.opaque&&a.enable(17),b.pointsUvs&&a.enable(18),x.push(a.mask)}(b,x),b.push(n.outputColorSpace)),b.push(x.customProgramCacheKey),b.join()},getUniforms:function M(x){const b=p[x.type];let U;return U=b?DG.clone(ar[b].uniforms):x.uniforms,U},acquireProgram:function E(x,b){let U;for(let $=0,N=c.length;$<N;$++){const F=c[$];if(F.cacheKey===b){U=F,++U.usedTimes;break}}return void 0===U&&(U=new t8(n,b,x,s),c.push(U)),U},releaseProgram:function S(x){if(0==--x.usedTimes){const b=c.indexOf(x);c[b]=c[c.length-1],c.pop(),x.destroy()}},releaseShaderCache:function T(x){l.remove(x)},programs:c,dispose:function A(){l.dispose()}}}function o8(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function i(s,o,a){n.get(s)[o]=a},dispose:function r(){n=new WeakMap}}}function a8(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function sD(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function oD(){const n=[];let e=0;const t=[],i=[],r=[];function o(d,h,f,p,y,g){let m=n[e];return void 0===m?(m={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:y,group:g},n[e]=m):(m.id=d.id,m.object=d,m.geometry=h,m.material=f,m.groupOrder=p,m.renderOrder=d.renderOrder,m.z=y,m.group=g),e++,m}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(d,h,f,p,y,g){const m=o(d,h,f,p,y,g);f.transmission>0?i.push(m):!0===f.transparent?r.push(m):t.push(m)},unshift:function l(d,h,f,p,y,g){const m=o(d,h,f,p,y,g);f.transmission>0?i.unshift(m):!0===f.transparent?r.unshift(m):t.unshift(m)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function c(d,h){t.length>1&&t.sort(d||a8),i.length>1&&i.sort(h||sD),r.length>1&&r.sort(h||sD)}}}function l8(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new oD,n.set(i,[o])):r>=s.length?(o=new oD,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function c8(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new D,color:new ge};break;case"SpotLight":t={position:new D,direction:new D,color:new ge,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new D,color:new ge,distance:0,decay:0};break;case"HemisphereLight":t={direction:new D,skyColor:new ge,groundColor:new ge};break;case"RectAreaLight":t={color:new ge,position:new D,halfWidth:new D,halfHeight:new D}}return n[e.id]=t,t}}}let d8=0;function h8(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function f8(n,e){const t=new c8,i=function u8(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)r.probe.push(new D);const s=new D,o=new $e,a=new $e;return{setup:function l(u,d){let h=0,f=0,p=0;for(let U=0;U<9;U++)r.probe[U].set(0,0,0);let y=0,g=0,m=0,v=0,_=0,M=0,E=0,S=0,T=0,A=0;u.sort(h8);const x=!0===d?Math.PI:1;for(let U=0,$=u.length;U<$;U++){const N=u[U],F=N.color,V=N.intensity,O=N.distance,L=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)h+=F.r*V*x,f+=F.g*V*x,p+=F.b*V*x;else if(N.isLightProbe)for(let k=0;k<9;k++)r.probe[k].addScaledVector(N.sh.coefficients[k],V);else if(N.isDirectionalLight){const k=t.get(N);if(k.color.copy(N.color).multiplyScalar(N.intensity*x),N.castShadow){const G=N.shadow,Z=i.get(N);Z.shadowBias=G.bias,Z.shadowNormalBias=G.normalBias,Z.shadowRadius=G.radius,Z.shadowMapSize=G.mapSize,r.directionalShadow[y]=Z,r.directionalShadowMap[y]=L,r.directionalShadowMatrix[y]=N.shadow.matrix,M++}r.directional[y]=k,y++}else if(N.isSpotLight){const k=t.get(N);k.position.setFromMatrixPosition(N.matrixWorld),k.color.copy(F).multiplyScalar(V*x),k.distance=O,k.coneCos=Math.cos(N.angle),k.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),k.decay=N.decay,r.spot[m]=k;const G=N.shadow;if(N.map&&(r.spotLightMap[T]=N.map,T++,G.updateMatrices(N),N.castShadow&&A++),r.spotLightMatrix[m]=G.matrix,N.castShadow){const Z=i.get(N);Z.shadowBias=G.bias,Z.shadowNormalBias=G.normalBias,Z.shadowRadius=G.radius,Z.shadowMapSize=G.mapSize,r.spotShadow[m]=Z,r.spotShadowMap[m]=L,S++}m++}else if(N.isRectAreaLight){const k=t.get(N);k.color.copy(F).multiplyScalar(V),k.halfWidth.set(.5*N.width,0,0),k.halfHeight.set(0,.5*N.height,0),r.rectArea[v]=k,v++}else if(N.isPointLight){const k=t.get(N);if(k.color.copy(N.color).multiplyScalar(N.intensity*x),k.distance=N.distance,k.decay=N.decay,N.castShadow){const G=N.shadow,Z=i.get(N);Z.shadowBias=G.bias,Z.shadowNormalBias=G.normalBias,Z.shadowRadius=G.radius,Z.shadowMapSize=G.mapSize,Z.shadowCameraNear=G.camera.near,Z.shadowCameraFar=G.camera.far,r.pointShadow[g]=Z,r.pointShadowMap[g]=L,r.pointShadowMatrix[g]=N.shadow.matrix,E++}r.point[g]=k,g++}else if(N.isHemisphereLight){const k=t.get(N);k.skyColor.copy(N.color).multiplyScalar(V*x),k.groundColor.copy(N.groundColor).multiplyScalar(V*x),r.hemi[_]=k,_++}}v>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=pe.LTC_FLOAT_1,r.rectAreaLTC2=pe.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=pe.LTC_HALF_1,r.rectAreaLTC2=pe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=h,r.ambient[1]=f,r.ambient[2]=p;const b=r.hash;(b.directionalLength!==y||b.pointLength!==g||b.spotLength!==m||b.rectAreaLength!==v||b.hemiLength!==_||b.numDirectionalShadows!==M||b.numPointShadows!==E||b.numSpotShadows!==S||b.numSpotMaps!==T)&&(r.directional.length=y,r.spot.length=m,r.rectArea.length=v,r.point.length=g,r.hemi.length=_,r.directionalShadow.length=M,r.directionalShadowMap.length=M,r.pointShadow.length=E,r.pointShadowMap.length=E,r.spotShadow.length=S,r.spotShadowMap.length=S,r.directionalShadowMatrix.length=M,r.pointShadowMatrix.length=E,r.spotLightMatrix.length=S+T-A,r.spotLightMap.length=T,r.numSpotLightShadowsWithMaps=A,b.directionalLength=y,b.pointLength=g,b.spotLength=m,b.rectAreaLength=v,b.hemiLength=_,b.numDirectionalShadows=M,b.numPointShadows=E,b.numSpotShadows=S,b.numSpotMaps=T,r.version=d8++)},setupView:function c(u,d){let h=0,f=0,p=0,y=0,g=0;const m=d.matrixWorldInverse;for(let v=0,_=u.length;v<_;v++){const M=u[v];if(M.isDirectionalLight){const E=r.directional[h];E.direction.setFromMatrixPosition(M.matrixWorld),s.setFromMatrixPosition(M.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(m),h++}else if(M.isSpotLight){const E=r.spot[p];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(m),E.direction.setFromMatrixPosition(M.matrixWorld),s.setFromMatrixPosition(M.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(m),p++}else if(M.isRectAreaLight){const E=r.rectArea[y];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(m),a.identity(),o.copy(M.matrixWorld),o.premultiply(m),a.extractRotation(o),E.halfWidth.set(.5*M.width,0,0),E.halfHeight.set(0,.5*M.height,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),y++}else if(M.isPointLight){const E=r.point[f];E.position.setFromMatrixPosition(M.matrixWorld),E.position.applyMatrix4(m),f++}else if(M.isHemisphereLight){const E=r.hemi[g];E.direction.setFromMatrixPosition(M.matrixWorld),E.direction.transformDirection(m),g++}}},state:r}}function aD(n,e){const t=new f8(n,e),i=[],r=[];return{init:function s(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function l(d){t.setup(i,d)},setupLightsView:function c(d){t.setupView(i,d)},pushLight:function o(d){i.push(d)},pushShadow:function a(d){r.push(d)}}}function p8(n,e){let t=new WeakMap;return{get:function i(s,o=0){const a=t.get(s);let l;return void 0===a?(l=new aD(n,e),t.set(s,[l])):o>=a.length?(l=new aD(n,e),a.push(l)):l=a[o],l},dispose:function r(){t=new WeakMap}}}class lD extends Vi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class cD extends Vi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function y8(n,e,t){let i=new ky;const r=new ne,s=new ne,o=new bt,a=new lD({depthPacking:3201}),l=new cD,c={},u=t.maxTextureSize,d={[Ir]:Zn,[Zn]:Ir,[rr]:rr},h=new ms({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ne},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new ct;p.setAttribute("position",new Gt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new In(p,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ST;let m=this.type;function v(E,S){const T=e.update(y);h.defines.VSM_SAMPLES!==E.blurSamples&&(h.defines.VSM_SAMPLES=E.blurSamples,f.defines.VSM_SAMPLES=E.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===E.mapPass&&(E.mapPass=new Ys(r.x,r.y)),h.uniforms.shadow_pass.value=E.map.texture,h.uniforms.resolution.value=E.mapSize,h.uniforms.radius.value=E.radius,n.setRenderTarget(E.mapPass),n.clear(),n.renderBufferDirect(S,null,T,h,y,null),f.uniforms.shadow_pass.value=E.mapPass.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,n.setRenderTarget(E.map),n.clear(),n.renderBufferDirect(S,null,T,f,y,null)}function _(E,S,T,A){let x=null;const b=!0===T.isPointLight?E.customDistanceMaterial:E.customDepthMaterial;if(void 0!==b)x=b;else if(x=!0===T.isPointLight?l:a,n.localClippingEnabled&&!0===S.clipShadows&&Array.isArray(S.clippingPlanes)&&0!==S.clippingPlanes.length||S.displacementMap&&0!==S.displacementScale||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const U=x.uuid,$=S.uuid;let N=c[U];void 0===N&&(N={},c[U]=N);let F=N[$];void 0===F&&(F=x.clone(),N[$]=F),x=F}return x.visible=S.visible,x.wireframe=S.wireframe,x.side=A===Cr?null!==S.shadowSide?S.shadowSide:S.side:null!==S.shadowSide?S.shadowSide:d[S.side],x.alphaMap=S.alphaMap,x.alphaTest=S.alphaTest,x.map=S.map,x.clipShadows=S.clipShadows,x.clippingPlanes=S.clippingPlanes,x.clipIntersection=S.clipIntersection,x.displacementMap=S.displacementMap,x.displacementScale=S.displacementScale,x.displacementBias=S.displacementBias,x.wireframeLinewidth=S.wireframeLinewidth,x.linewidth=S.linewidth,!0===T.isPointLight&&!0===x.isMeshDistanceMaterial&&(n.properties.get(x).light=T),x}function M(E,S,T,A,x){if(!1===E.visible)return;if(E.layers.test(S.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&x===Cr)&&(!E.frustumCulled||i.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,E.matrixWorld);const $=e.update(E),N=E.material;if(Array.isArray(N)){const F=$.groups;for(let V=0,O=F.length;V<O;V++){const L=F[V],k=N[L.materialIndex];if(k&&k.visible){const G=_(E,k,A,x);n.renderBufferDirect(T,null,$,G,E,L)}}}else if(N.visible){const F=_(E,N,A,x);n.renderBufferDirect(T,null,$,F,E,null)}}const U=E.children;for(let $=0,N=U.length;$<N;$++)M(U[$],S,T,A,x)}this.render=function(E,S,T){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===E.length)return;const A=n.getRenderTarget(),x=n.getActiveCubeFace(),b=n.getActiveMipmapLevel(),U=n.state;U.setBlending(ls),U.buffers.color.setClear(1,1,1,1),U.buffers.depth.setTest(!0),U.setScissorTest(!1);const $=m!==Cr&&this.type===Cr,N=m===Cr&&this.type!==Cr;for(let F=0,V=E.length;F<V;F++){const O=E[F],L=O.shadow;if(void 0===L){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(!1===L.autoUpdate&&!1===L.needsUpdate)continue;r.copy(L.mapSize);const k=L.getFrameExtents();if(r.multiply(k),s.copy(L.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/k.x),r.x=s.x*k.x,L.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/k.y),r.y=s.y*k.y,L.mapSize.y=s.y)),null===L.map||!0===$||!0===N){const Z=this.type!==Cr?{minFilter:Zt,magFilter:Zt}:{};null!==L.map&&L.map.dispose(),L.map=new Ys(r.x,r.y,Z),L.map.texture.name=O.name+".shadowMap",L.camera.updateProjectionMatrix()}n.setRenderTarget(L.map),n.clear();const G=L.getViewportCount();for(let Z=0;Z<G;Z++){const ce=L.getViewport(Z);o.set(s.x*ce.x,s.y*ce.y,s.x*ce.z,s.y*ce.w),U.viewport(o),L.updateMatrices(O,Z),i=L.getFrustum(),M(S,T,L.camera,O,this.type)}!0!==L.isPointLightShadow&&this.type===Cr&&v(L,T),L.needsUpdate=!1}m=this.type,g.needsUpdate=!1,n.setRenderTarget(A,x,b)}}function _8(n,e,t){const i=t.isWebGL2,a=new function r(){let P=!1;const Me=new bt;let W=null;const fe=new bt(0,0,0,0);return{setMask:function(Se){W!==Se&&!P&&(n.colorMask(Se,Se,Se,Se),W=Se)},setLocked:function(Se){P=Se},setClear:function(Se,vt,jt,on,go){!0===go&&(Se*=on,vt*=on,jt*=on),Me.set(Se,vt,jt,on),!1===fe.equals(Me)&&(n.clearColor(Se,vt,jt,on),fe.copy(Me))},reset:function(){P=!1,W=null,fe.set(-1,0,0,0)}}},l=new function s(){let P=!1,Me=null,W=null,fe=null;return{setTest:function(Se){Se?he(n.DEPTH_TEST):Re(n.DEPTH_TEST)},setMask:function(Se){Me!==Se&&!P&&(n.depthMask(Se),Me=Se)},setFunc:function(Se){if(W!==Se){switch(Se){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}W=Se}},setLocked:function(Se){P=Se},setClear:function(Se){fe!==Se&&(n.clearDepth(Se),fe=Se)},reset:function(){P=!1,Me=null,W=null,fe=null}}},c=new function o(){let P=!1,Me=null,W=null,fe=null,Se=null,vt=null,jt=null,on=null,go=null;return{setTest:function(qt){P||(qt?he(n.STENCIL_TEST):Re(n.STENCIL_TEST))},setMask:function(qt){Me!==qt&&!P&&(n.stencilMask(qt),Me=qt)},setFunc:function(qt,dr,kn){(W!==qt||fe!==dr||Se!==kn)&&(n.stencilFunc(qt,dr,kn),W=qt,fe=dr,Se=kn)},setOp:function(qt,dr,kn){(vt!==qt||jt!==dr||on!==kn)&&(n.stencilOp(qt,dr,kn),vt=qt,jt=dr,on=kn)},setLocked:function(qt){P=qt},setClear:function(qt){go!==qt&&(n.clearStencil(qt),go=qt)},reset:function(){P=!1,Me=null,W=null,fe=null,Se=null,vt=null,jt=null,on=null,go=null}}},u=new WeakMap,d=new WeakMap;let h={},f={},p=new WeakMap,y=[],g=null,m=!1,v=null,_=null,M=null,E=null,S=null,T=null,A=null,x=!1,b=null,U=null,$=null,N=null,F=null;const V=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let O=!1,L=0;const k=n.getParameter(n.VERSION);-1!==k.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(k)[1]),O=L>=1):-1!==k.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),O=L>=2);let G=null,Z={};const ce=n.getParameter(n.SCISSOR_BOX),H=n.getParameter(n.VIEWPORT),te=(new bt).fromArray(ce),j=(new bt).fromArray(H);function ye(P,Me,W,fe){const Se=new Uint8Array(4),vt=n.createTexture();n.bindTexture(P,vt),n.texParameteri(P,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(P,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let jt=0;jt<W;jt++)!i||P!==n.TEXTURE_3D&&P!==n.TEXTURE_2D_ARRAY?n.texImage2D(Me+jt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Se):n.texImage3D(Me,0,n.RGBA,1,1,fe,0,n.RGBA,n.UNSIGNED_BYTE,Se);return vt}const me={};function he(P){!0!==h[P]&&(n.enable(P),h[P]=!0)}function Re(P){!1!==h[P]&&(n.disable(P),h[P]=!1)}me[n.TEXTURE_2D]=ye(n.TEXTURE_2D,n.TEXTURE_2D,1),me[n.TEXTURE_CUBE_MAP]=ye(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(me[n.TEXTURE_2D_ARRAY]=ye(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),me[n.TEXTURE_3D]=ye(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),he(n.DEPTH_TEST),l.setFunc(3),re(!1),Pe(1),he(n.CULL_FACE),Q(ls);const R={100:n.FUNC_ADD,101:n.FUNC_SUBTRACT,102:n.FUNC_REVERSE_SUBTRACT};if(i)R[103]=n.MIN,R[104]=n.MAX;else{const P=e.get("EXT_blend_minmax");null!==P&&(R[103]=P.MIN_EXT,R[104]=P.MAX_EXT)}const ue={200:n.ZERO,201:n.ONE,202:n.SRC_COLOR,204:n.SRC_ALPHA,210:n.SRC_ALPHA_SATURATE,208:n.DST_COLOR,206:n.DST_ALPHA,203:n.ONE_MINUS_SRC_COLOR,205:n.ONE_MINUS_SRC_ALPHA,209:n.ONE_MINUS_DST_COLOR,207:n.ONE_MINUS_DST_ALPHA};function Q(P,Me,W,fe,Se,vt,jt,on){if(P!==ls){if(!1===m&&(he(n.BLEND),m=!0),5===P)Se=Se||Me,vt=vt||W,jt=jt||fe,(Me!==_||Se!==S)&&(n.blendEquationSeparate(R[Me],R[Se]),_=Me,S=Se),(W!==M||fe!==E||vt!==T||jt!==A)&&(n.blendFuncSeparate(ue[W],ue[fe],ue[vt],ue[jt]),M=W,E=fe,T=vt,A=jt),v=P,x=!1;else if(P!==v||on!==x){if((100!==_||100!==S)&&(n.blendEquation(n.FUNC_ADD),_=100,S=100),on)switch(P){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",P)}else switch(P){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",P)}M=null,E=null,T=null,A=null,v=P,x=on}}else!0===m&&(Re(n.BLEND),m=!1)}function re(P){b!==P&&(n.frontFace(P?n.CW:n.CCW),b=P)}function Pe(P){0!==P?(he(n.CULL_FACE),P!==U&&n.cullFace(1===P?n.BACK:2===P?n.FRONT:n.FRONT_AND_BACK)):Re(n.CULL_FACE),U=P}function be(P,Me,W){P?(he(n.POLYGON_OFFSET_FILL),(N!==Me||F!==W)&&(n.polygonOffset(Me,W),N=Me,F=W)):Re(n.POLYGON_OFFSET_FILL)}return{buffers:{color:a,depth:l,stencil:c},enable:he,disable:Re,bindFramebuffer:function Ae(P,Me){return f[P]!==Me&&(n.bindFramebuffer(P,Me),f[P]=Me,i&&(P===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=Me),P===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=Me)),!0)},drawBuffers:function rt(P,Me){let W=y,fe=!1;if(P)if(W=p.get(Me),void 0===W&&(W=[],p.set(Me,W)),P.isWebGLMultipleRenderTargets){const Se=P.texture;if(W.length!==Se.length||W[0]!==n.COLOR_ATTACHMENT0){for(let vt=0,jt=Se.length;vt<jt;vt++)W[vt]=n.COLOR_ATTACHMENT0+vt;W.length=Se.length,fe=!0}}else W[0]!==n.COLOR_ATTACHMENT0&&(W[0]=n.COLOR_ATTACHMENT0,fe=!0);else W[0]!==n.BACK&&(W[0]=n.BACK,fe=!0);fe&&(t.isWebGL2?n.drawBuffers(W):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(W))},useProgram:function Le(P){return g!==P&&(n.useProgram(P),g=P,!0)},setBlending:Q,setMaterial:function de(P,Me){P.side===rr?Re(n.CULL_FACE):he(n.CULL_FACE);let W=P.side===Zn;Me&&(W=!W),re(W),1===P.blending&&!1===P.transparent?Q(ls):Q(P.blending,P.blendEquation,P.blendSrc,P.blendDst,P.blendEquationAlpha,P.blendSrcAlpha,P.blendDstAlpha,P.premultipliedAlpha),l.setFunc(P.depthFunc),l.setTest(P.depthTest),l.setMask(P.depthWrite),a.setMask(P.colorWrite);const fe=P.stencilWrite;c.setTest(fe),fe&&(c.setMask(P.stencilWriteMask),c.setFunc(P.stencilFunc,P.stencilRef,P.stencilFuncMask),c.setOp(P.stencilFail,P.stencilZFail,P.stencilZPass)),be(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits),!0===P.alphaToCoverage?he(n.SAMPLE_ALPHA_TO_COVERAGE):Re(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:re,setCullFace:Pe,setLineWidth:function we(P){P!==$&&(O&&n.lineWidth(P),$=P)},setPolygonOffset:be,setScissorTest:function et(P){P?he(n.SCISSOR_TEST):Re(n.SCISSOR_TEST)},activeTexture:function mt(P){void 0===P&&(P=n.TEXTURE0+V-1),G!==P&&(n.activeTexture(P),G=P)},bindTexture:function $t(P,Me,W){void 0===W&&(W=null===G?n.TEXTURE0+V-1:G);let fe=Z[W];void 0===fe&&(fe={type:void 0,texture:void 0},Z[W]=fe),(fe.type!==P||fe.texture!==Me)&&(G!==W&&(n.activeTexture(W),G=W),n.bindTexture(P,Me||me[P]),fe.type=P,fe.texture=Me)},unbindTexture:function I(){const P=Z[G];void 0!==P&&void 0!==P.type&&(n.bindTexture(P.type,null),P.type=void 0,P.texture=void 0)},compressedTexImage2D:function w(){try{n.compressedTexImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},compressedTexImage3D:function q(){try{n.compressedTexImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texImage2D:function Fe(){try{n.texImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texImage3D:function Ue(){try{n.texImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},updateUBOMapping:function Ie(P,Me){let W=d.get(Me);void 0===W&&(W=new WeakMap,d.set(Me,W));let fe=W.get(P);void 0===fe&&(fe=n.getUniformBlockIndex(Me,P.name),W.set(P,fe))},uniformBlockBinding:function dt(P,Me){const fe=d.get(Me).get(P);u.get(Me)!==fe&&(n.uniformBlockBinding(Me,fe,P.__bindingPointIndex),u.set(Me,fe))},texStorage2D:function ve(){try{n.texStorage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texStorage3D:function K(){try{n.texStorage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texSubImage2D:function oe(){try{n.texSubImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texSubImage3D:function ae(){try{n.texSubImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},compressedTexSubImage2D:function _e(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},compressedTexSubImage3D:function Ne(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},scissor:function Ve(P){!1===te.equals(P)&&(n.scissor(P.x,P.y,P.z,P.w),te.copy(P))},viewport:function Ce(P){!1===j.equals(P)&&(n.viewport(P.x,P.y,P.z,P.w),j.copy(P))},reset:function Ct(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),!0===i&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},G=null,Z={},f={},p=new WeakMap,y=[],g=null,m=!1,v=null,_=null,M=null,E=null,S=null,T=null,A=null,x=!1,b=null,U=null,$=null,N=null,F=null,te.set(0,0,n.canvas.width,n.canvas.height),j.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}}}function v8(n,e,t,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let y;const g=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function v(I,w){return m?new OffscreenCanvas(I,w):uc("canvas")}function _(I,w,q,oe){let ae=1;if((I.width>oe||I.height>oe)&&(ae=oe/Math.max(I.width,I.height)),ae<1||!0===w){if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap){const _e=w?Zd:Math.floor,Ne=_e(ae*I.width),ve=_e(ae*I.height);void 0===y&&(y=v(Ne,ve));const K=q?v(Ne,ve):y;return K.width=Ne,K.height=ve,K.getContext("2d").drawImage(I,0,0,Ne,ve),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+I.width+"x"+I.height+") to ("+Ne+"x"+ve+")."),K}return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+I.width+"x"+I.height+")."),I}return I}function M(I){return yy(I.width)&&yy(I.height)}function S(I,w){return I.generateMipmaps&&w&&I.minFilter!==Zt&&I.minFilter!==Ht}function T(I){n.generateMipmap(I)}function A(I,w,q,oe,ae=!1){if(!1===a)return w;if(null!==I){if(void 0!==n[I])return n[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let _e=w;return w===n.RED&&(q===n.FLOAT&&(_e=n.R32F),q===n.HALF_FLOAT&&(_e=n.R16F),q===n.UNSIGNED_BYTE&&(_e=n.R8)),w===n.RG&&(q===n.FLOAT&&(_e=n.RG32F),q===n.HALF_FLOAT&&(_e=n.RG16F),q===n.UNSIGNED_BYTE&&(_e=n.RG8)),w===n.RGBA&&(q===n.FLOAT&&(_e=n.RGBA32F),q===n.HALF_FLOAT&&(_e=n.RGBA16F),q===n.UNSIGNED_BYTE&&(_e=oe===We&&!1===ae?n.SRGB8_ALPHA8:n.RGBA8),q===n.UNSIGNED_SHORT_4_4_4_4&&(_e=n.RGBA4),q===n.UNSIGNED_SHORT_5_5_5_1&&(_e=n.RGB5_A1)),(_e===n.R16F||_e===n.R32F||_e===n.RG16F||_e===n.RG32F||_e===n.RGBA16F||_e===n.RGBA32F)&&e.get("EXT_color_buffer_float"),_e}function x(I,w,q){return!0===S(I,q)||I.isFramebufferTexture&&I.minFilter!==Zt&&I.minFilter!==Ht?Math.log2(Math.max(w.width,w.height))+1:void 0!==I.mipmaps&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?w.mipmaps.length:1}function b(I){return I===Zt||I===qd||I===oc?n.NEAREST:n.LINEAR}function U(I){const w=I.target;w.removeEventListener("dispose",U),function N(I){const w=i.get(I);if(void 0===w.__webglInit)return;const q=I.source,oe=g.get(q);if(oe){const ae=oe[w.__cacheKey];ae.usedTimes--,0===ae.usedTimes&&F(I),0===Object.keys(oe).length&&g.delete(q)}i.remove(I)}(w),w.isVideoTexture&&p.delete(w)}function $(I){const w=I.target;w.removeEventListener("dispose",$),function V(I){const w=I.texture,q=i.get(I),oe=i.get(w);if(void 0!==oe.__webglTexture&&(n.deleteTexture(oe.__webglTexture),o.memory.textures--),I.depthTexture&&I.depthTexture.dispose(),I.isWebGLCubeRenderTarget)for(let ae=0;ae<6;ae++)n.deleteFramebuffer(q.__webglFramebuffer[ae]),q.__webglDepthbuffer&&n.deleteRenderbuffer(q.__webglDepthbuffer[ae]);else{if(n.deleteFramebuffer(q.__webglFramebuffer),q.__webglDepthbuffer&&n.deleteRenderbuffer(q.__webglDepthbuffer),q.__webglMultisampledFramebuffer&&n.deleteFramebuffer(q.__webglMultisampledFramebuffer),q.__webglColorRenderbuffer)for(let ae=0;ae<q.__webglColorRenderbuffer.length;ae++)q.__webglColorRenderbuffer[ae]&&n.deleteRenderbuffer(q.__webglColorRenderbuffer[ae]);q.__webglDepthRenderbuffer&&n.deleteRenderbuffer(q.__webglDepthRenderbuffer)}if(I.isWebGLMultipleRenderTargets)for(let ae=0,_e=w.length;ae<_e;ae++){const Ne=i.get(w[ae]);Ne.__webglTexture&&(n.deleteTexture(Ne.__webglTexture),o.memory.textures--),i.remove(w[ae])}i.remove(w),i.remove(I)}(w)}function F(I){const w=i.get(I);n.deleteTexture(w.__webglTexture),delete g.get(I.source)[w.__cacheKey],o.memory.textures--}let O=0;function Z(I,w){const q=i.get(I);if(I.isVideoTexture&&function mt(I){const w=o.render.frame;p.get(I)!==w&&(p.set(I,w),I.update())}(I),!1===I.isRenderTargetTexture&&I.version>0&&q.__version!==I.version){const oe=I.image;if(null===oe)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==oe.complete)return void Ae(q,I,w);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,q.__webglTexture,n.TEXTURE0+w)}const j={[zs]:n.REPEAT,[An]:n.CLAMP_TO_EDGE,[sc]:n.MIRRORED_REPEAT},ye={[Zt]:n.NEAREST,[qd]:n.NEAREST_MIPMAP_NEAREST,[oc]:n.NEAREST_MIPMAP_LINEAR,[Ht]:n.LINEAR,[ry]:n.LINEAR_MIPMAP_NEAREST,[Pr]:n.LINEAR_MIPMAP_LINEAR},me={512:n.NEVER,519:n.ALWAYS,513:n.LESS,515:n.LEQUAL,514:n.EQUAL,518:n.GEQUAL,516:n.GREATER,517:n.NOTEQUAL};function he(I,w,q){if(q?(n.texParameteri(I,n.TEXTURE_WRAP_S,j[w.wrapS]),n.texParameteri(I,n.TEXTURE_WRAP_T,j[w.wrapT]),(I===n.TEXTURE_3D||I===n.TEXTURE_2D_ARRAY)&&n.texParameteri(I,n.TEXTURE_WRAP_R,j[w.wrapR]),n.texParameteri(I,n.TEXTURE_MAG_FILTER,ye[w.magFilter]),n.texParameteri(I,n.TEXTURE_MIN_FILTER,ye[w.minFilter])):(n.texParameteri(I,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(I,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(I===n.TEXTURE_3D||I===n.TEXTURE_2D_ARRAY)&&n.texParameteri(I,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(w.wrapS!==An||w.wrapT!==An)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(I,n.TEXTURE_MAG_FILTER,b(w.magFilter)),n.texParameteri(I,n.TEXTURE_MIN_FILTER,b(w.minFilter)),w.minFilter!==Zt&&w.minFilter!==Ht&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),w.compareFunction&&(n.texParameteri(I,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(I,n.TEXTURE_COMPARE_FUNC,me[w.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const oe=e.get("EXT_texture_filter_anisotropic");if(w.magFilter===Zt||w.minFilter!==oc&&w.minFilter!==Pr||w.type===Nr&&!1===e.has("OES_texture_float_linear")||!1===a&&w.type===ac&&!1===e.has("OES_texture_half_float_linear"))return;(w.anisotropy>1||i.get(w).__currentAnisotropy)&&(n.texParameterf(I,oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w.anisotropy,r.getMaxAnisotropy())),i.get(w).__currentAnisotropy=w.anisotropy)}}function Re(I,w){let q=!1;void 0===I.__webglInit&&(I.__webglInit=!0,w.addEventListener("dispose",U));const oe=w.source;let ae=g.get(oe);void 0===ae&&(ae={},g.set(oe,ae));const _e=function G(I){const w=[];return w.push(I.wrapS),w.push(I.wrapT),w.push(I.wrapR||0),w.push(I.magFilter),w.push(I.minFilter),w.push(I.anisotropy),w.push(I.internalFormat),w.push(I.format),w.push(I.type),w.push(I.generateMipmaps),w.push(I.premultiplyAlpha),w.push(I.flipY),w.push(I.unpackAlignment),w.push(I.colorSpace),w.join()}(w);if(_e!==I.__cacheKey){void 0===ae[_e]&&(ae[_e]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,q=!0),ae[_e].usedTimes++;const Ne=ae[I.__cacheKey];void 0!==Ne&&(ae[I.__cacheKey].usedTimes--,0===Ne.usedTimes&&F(w)),I.__cacheKey=_e,I.__webglTexture=ae[_e].texture}return q}function Ae(I,w,q){let oe=n.TEXTURE_2D;(w.isDataArrayTexture||w.isCompressedArrayTexture)&&(oe=n.TEXTURE_2D_ARRAY),w.isData3DTexture&&(oe=n.TEXTURE_3D);const ae=Re(I,w),_e=w.source;t.bindTexture(oe,I.__webglTexture,n.TEXTURE0+q);const Ne=i.get(_e);if(_e.version!==Ne.__version||!0===ae){t.activeTexture(n.TEXTURE0+q),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const ve=function E(I){return!a&&(I.wrapS!==An||I.wrapT!==An||I.minFilter!==Zt&&I.minFilter!==Ht)}(w)&&!1===M(w.image);let K=_(w.image,ve,!1,u);K=$t(w,K);const Fe=M(K)||a,Ue=s.convert(w.format,w.colorSpace);let Ie,Ve=s.convert(w.type),Ce=A(w.internalFormat,Ue,Ve,w.colorSpace);he(oe,w,Fe);const dt=w.mipmaps,Ct=a&&!0!==w.isVideoTexture,P=void 0===Ne.__version||!0===ae,Me=x(w,K,Fe);if(w.isDepthTexture)Ce=n.DEPTH_COMPONENT,a?Ce=w.type===Nr?n.DEPTH_COMPONENT32F:w.type===us?n.DEPTH_COMPONENT24:w.type===Gs?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT16:w.type===Nr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),w.format===Ws&&Ce===n.DEPTH_COMPONENT&&w.type!==sy&&w.type!==us&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),w.type=us,Ve=s.convert(w.type)),w.format===ha&&Ce===n.DEPTH_COMPONENT&&(Ce=n.DEPTH_STENCIL,w.type!==Gs&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),w.type=Gs,Ve=s.convert(w.type))),P&&(Ct?t.texStorage2D(n.TEXTURE_2D,1,Ce,K.width,K.height):t.texImage2D(n.TEXTURE_2D,0,Ce,K.width,K.height,0,Ue,Ve,null));else if(w.isDataTexture)if(dt.length>0&&Fe){Ct&&P&&t.texStorage2D(n.TEXTURE_2D,Me,Ce,dt[0].width,dt[0].height);for(let W=0,fe=dt.length;W<fe;W++)Ie=dt[W],Ct?t.texSubImage2D(n.TEXTURE_2D,W,0,0,Ie.width,Ie.height,Ue,Ve,Ie.data):t.texImage2D(n.TEXTURE_2D,W,Ce,Ie.width,Ie.height,0,Ue,Ve,Ie.data);w.generateMipmaps=!1}else Ct?(P&&t.texStorage2D(n.TEXTURE_2D,Me,Ce,K.width,K.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,K.width,K.height,Ue,Ve,K.data)):t.texImage2D(n.TEXTURE_2D,0,Ce,K.width,K.height,0,Ue,Ve,K.data);else if(w.isCompressedTexture)if(w.isCompressedArrayTexture){Ct&&P&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Me,Ce,dt[0].width,dt[0].height,K.depth);for(let W=0,fe=dt.length;W<fe;W++)Ie=dt[W],w.format!==Ei?null!==Ue?Ct?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,W,0,0,0,Ie.width,Ie.height,K.depth,Ue,Ie.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,W,Ce,Ie.width,Ie.height,K.depth,0,Ie.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ct?t.texSubImage3D(n.TEXTURE_2D_ARRAY,W,0,0,0,Ie.width,Ie.height,K.depth,Ue,Ve,Ie.data):t.texImage3D(n.TEXTURE_2D_ARRAY,W,Ce,Ie.width,Ie.height,K.depth,0,Ue,Ve,Ie.data)}else{Ct&&P&&t.texStorage2D(n.TEXTURE_2D,Me,Ce,dt[0].width,dt[0].height);for(let W=0,fe=dt.length;W<fe;W++)Ie=dt[W],w.format!==Ei?null!==Ue?Ct?t.compressedTexSubImage2D(n.TEXTURE_2D,W,0,0,Ie.width,Ie.height,Ue,Ie.data):t.compressedTexImage2D(n.TEXTURE_2D,W,Ce,Ie.width,Ie.height,0,Ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ct?t.texSubImage2D(n.TEXTURE_2D,W,0,0,Ie.width,Ie.height,Ue,Ve,Ie.data):t.texImage2D(n.TEXTURE_2D,W,Ce,Ie.width,Ie.height,0,Ue,Ve,Ie.data)}else if(w.isDataArrayTexture)Ct?(P&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Me,Ce,K.width,K.height,K.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,K.width,K.height,K.depth,Ue,Ve,K.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ce,K.width,K.height,K.depth,0,Ue,Ve,K.data);else if(w.isData3DTexture)Ct?(P&&t.texStorage3D(n.TEXTURE_3D,Me,Ce,K.width,K.height,K.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,K.width,K.height,K.depth,Ue,Ve,K.data)):t.texImage3D(n.TEXTURE_3D,0,Ce,K.width,K.height,K.depth,0,Ue,Ve,K.data);else if(w.isFramebufferTexture){if(P)if(Ct)t.texStorage2D(n.TEXTURE_2D,Me,Ce,K.width,K.height);else{let W=K.width,fe=K.height;for(let Se=0;Se<Me;Se++)t.texImage2D(n.TEXTURE_2D,Se,Ce,W,fe,0,Ue,Ve,null),W>>=1,fe>>=1}}else if(dt.length>0&&Fe){Ct&&P&&t.texStorage2D(n.TEXTURE_2D,Me,Ce,dt[0].width,dt[0].height);for(let W=0,fe=dt.length;W<fe;W++)Ie=dt[W],Ct?t.texSubImage2D(n.TEXTURE_2D,W,0,0,Ue,Ve,Ie):t.texImage2D(n.TEXTURE_2D,W,Ce,Ue,Ve,Ie);w.generateMipmaps=!1}else Ct?(P&&t.texStorage2D(n.TEXTURE_2D,Me,Ce,K.width,K.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ue,Ve,K)):t.texImage2D(n.TEXTURE_2D,0,Ce,Ue,Ve,K);S(w,Fe)&&T(oe),Ne.__version=_e.version,w.onUpdate&&w.onUpdate(w)}I.__version=w.version}function Le(I,w,q,oe,ae){const _e=s.convert(q.format,q.colorSpace),Ne=s.convert(q.type),ve=A(q.internalFormat,_e,Ne,q.colorSpace);i.get(w).__hasExternalTextures||(ae===n.TEXTURE_3D||ae===n.TEXTURE_2D_ARRAY?t.texImage3D(ae,0,ve,w.width,w.height,w.depth,0,_e,Ne,null):t.texImage2D(ae,0,ve,w.width,w.height,0,_e,Ne,null)),t.bindFramebuffer(n.FRAMEBUFFER,I),et(w)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,oe,ae,i.get(q).__webglTexture,0,be(w)):(ae===n.TEXTURE_2D||ae>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ae<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,oe,ae,i.get(q).__webglTexture,0),t.bindFramebuffer(n.FRAMEBUFFER,null)}function R(I,w,q){if(n.bindRenderbuffer(n.RENDERBUFFER,I),w.depthBuffer&&!w.stencilBuffer){let oe=n.DEPTH_COMPONENT16;if(q||et(w)){const ae=w.depthTexture;ae&&ae.isDepthTexture&&(ae.type===Nr?oe=n.DEPTH_COMPONENT32F:ae.type===us&&(oe=n.DEPTH_COMPONENT24));const _e=be(w);et(w)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,_e,oe,w.width,w.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,_e,oe,w.width,w.height)}else n.renderbufferStorage(n.RENDERBUFFER,oe,w.width,w.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,I)}else if(w.depthBuffer&&w.stencilBuffer){const oe=be(w);q&&!1===et(w)?n.renderbufferStorageMultisample(n.RENDERBUFFER,oe,n.DEPTH24_STENCIL8,w.width,w.height):et(w)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,oe,n.DEPTH24_STENCIL8,w.width,w.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,w.width,w.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,I)}else{const oe=!0===w.isWebGLMultipleRenderTargets?w.texture:[w.texture];for(let ae=0;ae<oe.length;ae++){const _e=oe[ae],Ne=s.convert(_e.format,_e.colorSpace),ve=s.convert(_e.type),K=A(_e.internalFormat,Ne,ve,_e.colorSpace),Fe=be(w);q&&!1===et(w)?n.renderbufferStorageMultisample(n.RENDERBUFFER,Fe,K,w.width,w.height):et(w)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Fe,K,w.width,w.height):n.renderbufferStorage(n.RENDERBUFFER,K,w.width,w.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Q(I){const w=i.get(I),q=!0===I.isWebGLCubeRenderTarget;if(I.depthTexture&&!w.__autoAllocateDepthBuffer){if(q)throw new Error("target.depthTexture not supported in Cube render targets");!function ue(I,w){if(w&&w.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,I),!w.depthTexture||!w.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(w.depthTexture).__webglTexture||w.depthTexture.image.width!==w.width||w.depthTexture.image.height!==w.height)&&(w.depthTexture.image.width=w.width,w.depthTexture.image.height=w.height,w.depthTexture.needsUpdate=!0),Z(w.depthTexture,0);const oe=i.get(w.depthTexture).__webglTexture,ae=be(w);if(w.depthTexture.format===Ws)et(w)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,oe,0,ae):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,oe,0);else{if(w.depthTexture.format!==ha)throw new Error("Unknown depthTexture format");et(w)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,oe,0,ae):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,oe,0)}}(w.__webglFramebuffer,I)}else if(q){w.__webglDepthbuffer=[];for(let oe=0;oe<6;oe++)t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer[oe]),w.__webglDepthbuffer[oe]=n.createRenderbuffer(),R(w.__webglDepthbuffer[oe],I,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer),w.__webglDepthbuffer=n.createRenderbuffer(),R(w.__webglDepthbuffer,I,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function be(I){return Math.min(d,I.samples)}function et(I){const w=i.get(I);return a&&I.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==w.__useRenderToTexture}function $t(I,w){const q=I.colorSpace,oe=I.format,ae=I.type;return!0===I.isCompressedTexture||1035===I.format||q!==sr&&""!==q&&(q===We?!1===a?!0===e.has("EXT_sRGB")&&oe===Ei?(I.format=1035,I.minFilter=Ht,I.generateMipmaps=!1):w=mA.sRGBToLinear(w):(oe!==Ei||ae!==cs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",q)),w}this.allocateTextureUnit=function k(){const I=O;return I>=l&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+l),O+=1,I},this.resetTextureUnits=function L(){O=0},this.setTexture2D=Z,this.setTexture2DArray=function ce(I,w){const q=i.get(I);I.version>0&&q.__version!==I.version?Ae(q,I,w):t.bindTexture(n.TEXTURE_2D_ARRAY,q.__webglTexture,n.TEXTURE0+w)},this.setTexture3D=function H(I,w){const q=i.get(I);I.version>0&&q.__version!==I.version?Ae(q,I,w):t.bindTexture(n.TEXTURE_3D,q.__webglTexture,n.TEXTURE0+w)},this.setTextureCube=function te(I,w){const q=i.get(I);I.version>0&&q.__version!==I.version?function rt(I,w,q){if(6!==w.image.length)return;const oe=Re(I,w),ae=w.source;t.bindTexture(n.TEXTURE_CUBE_MAP,I.__webglTexture,n.TEXTURE0+q);const _e=i.get(ae);if(ae.version!==_e.__version||!0===oe){t.activeTexture(n.TEXTURE0+q),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const Ne=w.isCompressedTexture||w.image[0].isCompressedTexture,ve=w.image[0]&&w.image[0].isDataTexture,K=[];for(let W=0;W<6;W++)K[W]=Ne||ve?ve?w.image[W].image:w.image[W]:_(w.image[W],!1,!0,c),K[W]=$t(w,K[W]);const Fe=K[0],Ue=M(Fe)||a,Ve=s.convert(w.format,w.colorSpace),Ce=s.convert(w.type),Ie=A(w.internalFormat,Ve,Ce,w.colorSpace),dt=a&&!0!==w.isVideoTexture,Ct=void 0===_e.__version||!0===oe;let Me,P=x(w,Fe,Ue);if(he(n.TEXTURE_CUBE_MAP,w,Ue),Ne){dt&&Ct&&t.texStorage2D(n.TEXTURE_CUBE_MAP,P,Ie,Fe.width,Fe.height);for(let W=0;W<6;W++){Me=K[W].mipmaps;for(let fe=0;fe<Me.length;fe++){const Se=Me[fe];w.format!==Ei?null!==Ve?dt?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe,0,0,Se.width,Se.height,Ve,Se.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe,Ie,Se.width,Se.height,0,Se.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):dt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe,0,0,Se.width,Se.height,Ve,Ce,Se.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe,Ie,Se.width,Se.height,0,Ve,Ce,Se.data)}}}else{Me=w.mipmaps,dt&&Ct&&(Me.length>0&&P++,t.texStorage2D(n.TEXTURE_CUBE_MAP,P,Ie,K[0].width,K[0].height));for(let W=0;W<6;W++)if(ve){dt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,K[W].width,K[W].height,Ve,Ce,K[W].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,Ie,K[W].width,K[W].height,0,Ve,Ce,K[W].data);for(let fe=0;fe<Me.length;fe++){const vt=Me[fe].image[W].image;dt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe+1,0,0,vt.width,vt.height,Ve,Ce,vt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe+1,Ie,vt.width,vt.height,0,Ve,Ce,vt.data)}}else{dt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,Ve,Ce,K[W]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,Ie,Ve,Ce,K[W]);for(let fe=0;fe<Me.length;fe++){const Se=Me[fe];dt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe+1,0,0,Ve,Ce,Se.image[W]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,fe+1,Ie,Ve,Ce,Se.image[W])}}}S(w,Ue)&&T(n.TEXTURE_CUBE_MAP),_e.__version=ae.version,w.onUpdate&&w.onUpdate(w)}I.__version=w.version}(q,I,w):t.bindTexture(n.TEXTURE_CUBE_MAP,q.__webglTexture,n.TEXTURE0+w)},this.rebindTextures=function de(I,w,q){const oe=i.get(I);void 0!==w&&Le(oe.__webglFramebuffer,I,I.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D),void 0!==q&&Q(I)},this.setupRenderTarget=function re(I){const w=I.texture,q=i.get(I),oe=i.get(w);I.addEventListener("dispose",$),!0!==I.isWebGLMultipleRenderTargets&&(void 0===oe.__webglTexture&&(oe.__webglTexture=n.createTexture()),oe.__version=w.version,o.memory.textures++);const ae=!0===I.isWebGLCubeRenderTarget,_e=!0===I.isWebGLMultipleRenderTargets,Ne=M(I)||a;if(ae){q.__webglFramebuffer=[];for(let ve=0;ve<6;ve++)q.__webglFramebuffer[ve]=n.createFramebuffer()}else{if(q.__webglFramebuffer=n.createFramebuffer(),_e)if(r.drawBuffers){const ve=I.texture;for(let K=0,Fe=ve.length;K<Fe;K++){const Ue=i.get(ve[K]);void 0===Ue.__webglTexture&&(Ue.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&I.samples>0&&!1===et(I)){const ve=_e?w:[w];q.__webglMultisampledFramebuffer=n.createFramebuffer(),q.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,q.__webglMultisampledFramebuffer);for(let K=0;K<ve.length;K++){const Fe=ve[K];q.__webglColorRenderbuffer[K]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,q.__webglColorRenderbuffer[K]);const Ue=s.convert(Fe.format,Fe.colorSpace),Ve=s.convert(Fe.type),Ce=A(Fe.internalFormat,Ue,Ve,Fe.colorSpace,!0===I.isXRRenderTarget),Ie=be(I);n.renderbufferStorageMultisample(n.RENDERBUFFER,Ie,Ce,I.width,I.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+K,n.RENDERBUFFER,q.__webglColorRenderbuffer[K])}n.bindRenderbuffer(n.RENDERBUFFER,null),I.depthBuffer&&(q.__webglDepthRenderbuffer=n.createRenderbuffer(),R(q.__webglDepthRenderbuffer,I,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ae){t.bindTexture(n.TEXTURE_CUBE_MAP,oe.__webglTexture),he(n.TEXTURE_CUBE_MAP,w,Ne);for(let ve=0;ve<6;ve++)Le(q.__webglFramebuffer[ve],I,w,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ve);S(w,Ne)&&T(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(_e){const ve=I.texture;for(let K=0,Fe=ve.length;K<Fe;K++){const Ue=ve[K],Ve=i.get(Ue);t.bindTexture(n.TEXTURE_2D,Ve.__webglTexture),he(n.TEXTURE_2D,Ue,Ne),Le(q.__webglFramebuffer,I,Ue,n.COLOR_ATTACHMENT0+K,n.TEXTURE_2D),S(Ue,Ne)&&T(n.TEXTURE_2D)}t.unbindTexture()}else{let ve=n.TEXTURE_2D;(I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(a?ve=I.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ve,oe.__webglTexture),he(ve,w,Ne),Le(q.__webglFramebuffer,I,w,n.COLOR_ATTACHMENT0,ve),S(w,Ne)&&T(ve),t.unbindTexture()}I.depthBuffer&&Q(I)},this.updateRenderTargetMipmap=function Pe(I){const w=M(I)||a,q=!0===I.isWebGLMultipleRenderTargets?I.texture:[I.texture];for(let oe=0,ae=q.length;oe<ae;oe++){const _e=q[oe];if(S(_e,w)){const Ne=I.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,ve=i.get(_e).__webglTexture;t.bindTexture(Ne,ve),T(Ne),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function we(I){if(a&&I.samples>0&&!1===et(I)){const w=I.isWebGLMultipleRenderTargets?I.texture:[I.texture],q=I.width,oe=I.height;let ae=n.COLOR_BUFFER_BIT;const _e=[],Ne=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ve=i.get(I),K=!0===I.isWebGLMultipleRenderTargets;if(K)for(let Fe=0;Fe<w.length;Fe++)t.bindFramebuffer(n.FRAMEBUFFER,ve.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ve.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ve.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ve.__webglFramebuffer);for(let Fe=0;Fe<w.length;Fe++){_e.push(n.COLOR_ATTACHMENT0+Fe),I.depthBuffer&&_e.push(Ne);const Ue=void 0!==ve.__ignoreDepthValues&&ve.__ignoreDepthValues;if(!1===Ue&&(I.depthBuffer&&(ae|=n.DEPTH_BUFFER_BIT),I.stencilBuffer&&(ae|=n.STENCIL_BUFFER_BIT)),K&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ve.__webglColorRenderbuffer[Fe]),!0===Ue&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[Ne]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[Ne])),K){const Ve=i.get(w[Fe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ve,0)}n.blitFramebuffer(0,0,q,oe,0,0,q,oe,ae,n.NEAREST),f&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,_e)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),K)for(let Fe=0;Fe<w.length;Fe++){t.bindFramebuffer(n.FRAMEBUFFER,ve.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fe,n.RENDERBUFFER,ve.__webglColorRenderbuffer[Fe]);const Ue=i.get(w[Fe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ve.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fe,n.TEXTURE_2D,Ue,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ve.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Q,this.setupFrameBufferTexture=Le,this.useMultisampledRTT=et}function M8(n,e,t){const i=t.isWebGL2;return{convert:function r(s,o=""){let a;if(s===cs)return n.UNSIGNED_BYTE;if(s===PT)return n.UNSIGNED_SHORT_4_4_4_4;if(s===NT)return n.UNSIGNED_SHORT_5_5_5_1;if(1010===s)return n.BYTE;if(1011===s)return n.SHORT;if(s===sy)return n.UNSIGNED_SHORT;if(1013===s)return n.INT;if(s===us)return n.UNSIGNED_INT;if(s===Nr)return n.FLOAT;if(s===ac)return i?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===s)return n.ALPHA;if(s===Ei)return n.RGBA;if(1024===s)return n.LUMINANCE;if(1025===s)return n.LUMINANCE_ALPHA;if(s===Ws)return n.DEPTH_COMPONENT;if(s===ha)return n.DEPTH_STENCIL;if(1035===s)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===s)return n.RED;if(s===LT)return n.RED_INTEGER;if(1030===s)return n.RG;if(s===OT)return n.RG_INTEGER;if(s===FT)return n.RGBA_INTEGER;if(33776===s||33777===s||33778===s||33779===s)if(o===We){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===s)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===s)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===s)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===s)return o===We?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return o===We?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===s)return o===We?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===s||36284===s||36285===s||36286===s){if(a=e.get("EXT_texture_compression_rgtc"),null===a)return null;if(36492===s)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===s)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===s)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===s)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===Gs?i?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class x8 extends vn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class gs extends yn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const E8={type:"move"};class Wy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new gs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new gs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new D,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new D),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new gs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new D,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new D),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(c&&e.hand){o=!0;for(const y of e.hand.values()){const g=t.getJointPose(y,i),m=this._getHandJoint(c,y);null!==g&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=null!==g}const h=c.joints["index-finger-tip"].position.distanceTo(c.joints["thumb-tip"].position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(E8)))}return null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),null!==c&&(c.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new gs;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class S8 extends Fi{constructor(e,t,i,r,s,o,a,l,c,u){if((u=void 0!==u?u:Ws)!==Ws&&u!==ha)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===Ws&&(i=us),void 0===i&&u===ha&&(i=Gs),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Zt,this.minFilter=void 0!==l?l:Zt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class w8 extends ga{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,d=null,h=null,f=null,p=null;const y=t.getContextAttributes();let g=null,m=null;const v=[],_=[];let M=null;const E=new vn;E.layers.enable(1),E.viewport=new bt;const S=new vn;S.layers.enable(2),S.viewport=new bt;const T=[E,S],A=new x8;A.layers.enable(1),A.layers.enable(2);let x=null,b=null;function U(H){const te=_.indexOf(H.inputSource);if(-1===te)return;const j=v[te];void 0!==j&&(j.update(H.inputSource,H.frame,c||o),j.dispatchEvent({type:H.type,data:H.inputSource}))}function $(){r.removeEventListener("select",U),r.removeEventListener("selectstart",U),r.removeEventListener("selectend",U),r.removeEventListener("squeeze",U),r.removeEventListener("squeezestart",U),r.removeEventListener("squeezeend",U),r.removeEventListener("end",$),r.removeEventListener("inputsourceschange",N);for(let H=0;H<v.length;H++){const te=_[H];null!==te&&(_[H]=null,v[H].disconnect(te))}x=null,b=null,e.setRenderTarget(g),f=null,h=null,d=null,r=null,m=null,ce.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function N(H){for(let te=0;te<H.removed.length;te++){const j=H.removed[te],ye=_.indexOf(j);ye>=0&&(_[ye]=null,v[ye].disconnect(j))}for(let te=0;te<H.added.length;te++){const j=H.added[te];let ye=_.indexOf(j);if(-1===ye){for(let he=0;he<v.length;he++){if(he>=_.length){_.push(j),ye=he;break}if(null===_[he]){_[he]=j,ye=he;break}}if(-1===ye)break}const me=v[ye];me&&me.connect(j)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(H){M=H},this.getController=function(H){let te=v[H];return void 0===te&&(te=new Wy,v[H]=te),te.getTargetRaySpace()},this.getControllerGrip=function(H){let te=v[H];return void 0===te&&(te=new Wy,v[H]=te),te.getGripSpace()},this.getHand=function(H){let te=v[H];return void 0===te&&(te=new Wy,v[H]=te),te.getHandSpace()},this.setFramebufferScaleFactor=function(H){s=H,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(H){a=H,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(H){c=H},this.getBaseLayer=function(){return null!==h?h:f},this.getBinding=function(){return d},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=function(){var H=function $H(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(l){xT(s,i,r,o,a,"next",l)}function a(l){xT(s,i,r,o,a,"throw",l)}o(void 0)})}}(function*(te){if(r=te,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",U),r.addEventListener("selectstart",U),r.addEventListener("selectend",U),r.addEventListener("squeeze",U),r.addEventListener("squeezestart",U),r.addEventListener("squeezeend",U),r.addEventListener("end",$),r.addEventListener("inputsourceschange",N),!0!==y.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)f=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:f}),m=new Ys(f.framebufferWidth,f.framebufferHeight,{format:Ei,type:cs,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil});else{let j=null,ye=null,me=null;y.depth&&(me=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,j=y.stencil?ha:Ws,ye=y.stencil?Gs:us);const he={colorFormat:t.RGBA8,depthFormat:me,scaleFactor:s};d=new XRWebGLBinding(r,t),h=d.createProjectionLayer(he),r.updateRenderState({layers:[h]}),m=new Ys(h.textureWidth,h.textureHeight,{format:Ei,type:cs,depthTexture:new S8(h.textureWidth,h.textureHeight,ye,void 0,void 0,void 0,void 0,void 0,void 0,j),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0}),e.properties.get(m).__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=yield r.requestReferenceSpace(a),ce.setContext(r),ce.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(te){return H.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const F=new D,V=new D;function L(H,te){null===te?H.matrixWorld.copy(H.matrix):H.matrixWorld.multiplyMatrices(te.matrixWorld,H.matrix),H.matrixWorldInverse.copy(H.matrixWorld).invert()}this.updateCameraXR=function(H){if(null===r)return H;M&&(H=M),A.near=S.near=E.near=H.near,A.far=S.far=E.far=H.far,(x!==A.near||b!==A.far)&&(r.updateRenderState({depthNear:A.near,depthFar:A.far}),x=A.near,b=A.far);const te=H.parent,j=A.cameras;L(A,te);for(let ye=0;ye<j.length;ye++)L(j[ye],te);return 2===j.length?function O(H,te,j){F.setFromMatrixPosition(te.matrixWorld),V.setFromMatrixPosition(j.matrixWorld);const ye=F.distanceTo(V),me=te.projectionMatrix.elements,he=j.projectionMatrix.elements,Re=me[14]/(me[10]-1),Ae=me[14]/(me[10]+1),rt=(me[9]+1)/me[5],Le=(me[9]-1)/me[5],R=(me[8]-1)/me[0],ue=(he[8]+1)/he[0],Q=Re*R,de=Re*ue,re=ye/(-R+ue),Pe=re*-R;te.matrixWorld.decompose(H.position,H.quaternion,H.scale),H.translateX(Pe),H.translateZ(re),H.matrixWorld.compose(H.position,H.quaternion,H.scale),H.matrixWorldInverse.copy(H.matrixWorld).invert();const we=Re+re,be=Ae+re;H.projectionMatrix.makePerspective(Q-Pe,de+(ye-Pe),rt*Ae/be*we,Le*Ae/be*we,we,be),H.projectionMatrixInverse.copy(H.projectionMatrix).invert()}(A,E,S):A.projectionMatrix.copy(E.projectionMatrix),M&&function k(H,te){const j=M;null===te?j.matrix.copy(H.matrixWorld):(j.matrix.copy(te.matrixWorld),j.matrix.invert(),j.matrix.multiply(H.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0);const ye=j.children;for(let me=0,he=ye.length;me<he;me++)ye[me].updateMatrixWorld(!0);j.projectionMatrix.copy(H.projectionMatrix),j.projectionMatrixInverse.copy(H.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=2*ya*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}(A,te),A},this.getFoveation=function(){if(null!==h||null!==f)return l},this.setFoveation=function(H){l=H,null!==h&&(h.fixedFoveation=H),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=H)};let G=null;const ce=new OA;ce.setAnimationLoop(function Z(H,te){if(u=te.getViewerPose(c||o),p=te,null!==u){const j=u.views;null!==f&&(e.setRenderTargetFramebuffer(m,f.framebuffer),e.setRenderTarget(m));let ye=!1;j.length!==A.cameras.length&&(A.cameras.length=0,ye=!0);for(let me=0;me<j.length;me++){const he=j[me];let Re=null;if(null!==f)Re=f.getViewport(he);else{const rt=d.getViewSubImage(h,he);Re=rt.viewport,0===me&&(e.setRenderTargetTextures(m,rt.colorTexture,h.ignoreDepthValues?void 0:rt.depthStencilTexture),e.setRenderTarget(m))}let Ae=T[me];void 0===Ae&&(Ae=new vn,Ae.layers.enable(me),Ae.viewport=new bt,T[me]=Ae),Ae.matrix.fromArray(he.transform.matrix),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.projectionMatrix.fromArray(he.projectionMatrix),Ae.projectionMatrixInverse.copy(Ae.projectionMatrix).invert(),Ae.viewport.set(Re.x,Re.y,Re.width,Re.height),0===me&&(A.matrix.copy(Ae.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale)),!0===ye&&A.cameras.push(Ae)}}for(let j=0;j<v.length;j++){const ye=_[j],me=v[j];null!==ye&&void 0!==me&&me.update(ye,te,c||o)}G&&G(H,te),te.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:te}),p=null}),this.setAnimationLoop=function(H){G=H},this.dispose=function(){}}}function b8(n,e){function t(g,m){!0===g.matrixAutoUpdate&&g.updateMatrix(),m.value.copy(g.matrix)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,t(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===Zn&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,t(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===Zn&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,t(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,t(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const v=e.get(m).envMap;if(v&&(g.envMap.value=v,g.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;const _=!0===n.useLegacyLights?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*_,t(m.lightMap,g.lightMapTransform)}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,g.aoMapTransform))}return{refreshFogUniforms:function i(g,m){m.color.getRGB(g.fogColor.value,LA(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)},refreshMaterialUniforms:function r(g,m,v,_,M){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),function d(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}(g,m)):m.isMeshPhongMaterial?(s(g,m),function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}(g,m)):m.isMeshStandardMaterial?(s(g,m),function h(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,g.roughnessMapTransform)),e.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}(g,m),m.isMeshPhysicalMaterial&&function f(g,m,v){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===Zn&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,g.specularIntensityMapTransform))}(g,m,M)):m.isMeshMatcapMaterial?(s(g,m),function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),function y(g,m){const v=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(v.matrixWorld),g.nearDistance.value=v.shadow.camera.near,g.farDistance.value=v.shadow.camera.far}(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform))}(g,m),m.isLineDashedMaterial&&function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}(g,m)):m.isPointsMaterial?function l(g,m,v,_){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*v,g.scale.value=.5*_,m.map&&(g.map.value=m.map,t(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}(g,m,v,_):m.isSpriteMaterial?function c(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}}}function T8(n,e,t,i){let r={},s={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function f(v,_,M){const E=v.value;if(void 0===M[_]){if("number"==typeof E)M[_]=E;else{const S=Array.isArray(E)?E:[E],T=[];for(let A=0;A<S.length;A++)T.push(S[A].clone());M[_]=T}return!0}if("number"==typeof E){if(M[_]!==E)return M[_]=E,!0}else{const S=Array.isArray(M[_])?M[_]:[M[_]],T=Array.isArray(E)?E:[E];for(let A=0;A<S.length;A++){const x=S[A];if(!1===x.equals(T[A]))return x.copy(T[A]),!0}}return!1}function y(v){const _={boundary:0,storage:0};return"number"==typeof v?(_.boundary=4,_.storage=4):v.isVector2?(_.boundary=8,_.storage=8):v.isVector3||v.isColor?(_.boundary=16,_.storage=12):v.isVector4?(_.boundary=16,_.storage=16):v.isMatrix3?(_.boundary=48,_.storage=48):v.isMatrix4?(_.boundary=64,_.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),_}function g(v){const _=v.target;_.removeEventListener("dispose",g);const M=o.indexOf(_.__bindingPointIndex);o.splice(M,1),n.deleteBuffer(r[_.id]),delete r[_.id],delete s[_.id]}return{bind:function l(v,_){i.uniformBlockBinding(v,_.program)},update:function c(v,_){let M=r[v.id];void 0===M&&(function p(v){const _=v.uniforms;let M=0;let S=0;for(let T=0,A=_.length;T<A;T++){const x=_[T],b={boundary:0,storage:0},U=Array.isArray(x.value)?x.value:[x.value];for(let $=0,N=U.length;$<N;$++){const V=y(U[$]);b.boundary+=V.boundary,b.storage+=V.storage}x.__data=new Float32Array(b.storage/Float32Array.BYTES_PER_ELEMENT),x.__offset=M,T>0&&(S=M%16,0!==S&&16-S-b.boundary<0&&(M+=16-S,x.__offset=M)),M+=b.storage}S=M%16,S>0&&(M+=16-S),v.__size=M,v.__cache={}}(v),M=function u(v){const _=function d(){for(let v=0;v<a;v++)if(-1===o.indexOf(v))return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();v.__bindingPointIndex=_;const M=n.createBuffer(),E=v.__size,S=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,M),n.bufferData(n.UNIFORM_BUFFER,E,S),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,_,M),M}(v),r[v.id]=M,v.addEventListener("dispose",g)),i.updateUBOMapping(v,_.program);const S=e.render.frame;s[v.id]!==S&&(function h(v){const M=v.uniforms,E=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,r[v.id]);for(let S=0,T=M.length;S<T;S++){const A=M[S];if(!0===f(A,S,E)){const x=A.__offset,b=Array.isArray(A.value)?A.value:[A.value];let U=0;for(let $=0;$<b.length;$++){const N=b[$],F=y(N);"number"==typeof N?(A.__data[0]=N,n.bufferSubData(n.UNIFORM_BUFFER,x+U,A.__data)):N.isMatrix3?(A.__data[0]=N.elements[0],A.__data[1]=N.elements[1],A.__data[2]=N.elements[2],A.__data[3]=N.elements[0],A.__data[4]=N.elements[3],A.__data[5]=N.elements[4],A.__data[6]=N.elements[5],A.__data[7]=N.elements[0],A.__data[8]=N.elements[6],A.__data[9]=N.elements[7],A.__data[10]=N.elements[8],A.__data[11]=N.elements[0]):(N.toArray(A.__data,U),U+=F.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,x,A.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(v),s[v.id]=S)},dispose:function m(){for(const v in r)n.deleteBuffer(r[v]);o=[],r={},s={}}}}function A8(){const n=uc("canvas");return n.style.display="block",n}class uD{constructor(e={}){const{canvas:t=A8(),context:i=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;let h;this.isWebGLRenderer=!0,h=null!==i?i.getContextAttributes().alpha:o;const f=new Uint32Array(4),p=new Int32Array(4);let y=null,g=null;const m=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=We,this.useLegacyLights=!0,this.toneMapping=Rr,this.toneMappingExposure=1;const _=this;let M=!1,E=0,S=0,T=null,A=-1,x=null;const b=new bt,U=new bt;let $=null;const N=new ge(0);let F=0,V=t.width,O=t.height,L=1,k=null,G=null;const Z=new bt(0,0,V,O),ce=new bt(0,0,V,O);let H=!1;const te=new ky;let j=!1,ye=!1,me=null;const he=new $e,Re=new ne,Ae=new D,rt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Le(){return null===T?L:1}let Q,de,re,Pe,we,be,et,mt,$t,I,w,q,oe,ae,_e,Ne,ve,K,Fe,Ue,Ve,Ce,Ie,dt,R=i;function ue(C,z){for(let X=0;X<C.length;X++){const Y=t.getContext(C[X],z);if(null!==Y)return Y}return null}try{const C={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r153"),t.addEventListener("webglcontextlost",Me,!1),t.addEventListener("webglcontextrestored",W,!1),t.addEventListener("webglcontextcreationerror",fe,!1),null===R){const z=["webgl2","webgl","experimental-webgl"];if(!0===_.isWebGL1Renderer&&z.shift(),R=ue(z,C),null===R)throw ue(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}R instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===R.getShaderPrecisionFormat&&(R.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(C){throw console.error("THREE.WebGLRenderer: "+C.message),C}function Ct(){Q=new V5(R),de=new L5(R,Q,e),Q.init(de),Ce=new M8(R,Q,de),re=new _8(R,Q,de),Pe=new G5(R),we=new o8,be=new v8(R,Q,re,we,de,Ce,Pe),et=new F5(_),mt=new B5(_),$t=new OG(R,de),Ie=new P5(R,Q,$t,de),I=new H5(R,$t,Pe,Ie),w=new q5(R,I,$t,Pe),Fe=new j5(R,de,be),Ne=new O5(we),q=new s8(_,et,mt,Q,de,Ie,Ne),oe=new b8(_,we),ae=new l8,_e=new p8(Q,de),K=new R5(_,et,mt,re,w,h,l),ve=new y8(_,w,de),dt=new T8(R,Pe,de,re),Ue=new N5(R,Q,Pe,de),Ve=new z5(R,Q,Pe,de),Pe.programs=q.programs,_.capabilities=de,_.extensions=Q,_.properties=we,_.renderLists=ae,_.shadowMap=ve,_.state=re,_.info=Pe}Ct();const P=new w8(_,R);function Me(C){C.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function W(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const C=Pe.autoReset,z=ve.enabled,X=ve.autoUpdate,B=ve.needsUpdate,Y=ve.type;Ct(),Pe.autoReset=C,ve.enabled=z,ve.autoUpdate=X,ve.needsUpdate=B,ve.type=Y}function fe(C){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",C.statusMessage)}function Se(C){const z=C.target;z.removeEventListener("dispose",Se),function vt(C){(function jt(C){const z=we.get(C).programs;void 0!==z&&(z.forEach(function(X){q.releaseProgram(X)}),C.isShaderMaterial&&q.releaseShaderCache(C))})(C),we.remove(C)}(z)}this.xr=P,this.getContext=function(){return R},this.getContextAttributes=function(){return R.getContextAttributes()},this.forceContextLoss=function(){const C=Q.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){const C=Q.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(C){void 0!==C&&(L=C,this.setSize(V,O,!1))},this.getSize=function(C){return C.set(V,O)},this.setSize=function(C,z,X=!0){P.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(V=C,O=z,t.width=Math.floor(C*L),t.height=Math.floor(z*L),!0===X&&(t.style.width=C+"px",t.style.height=z+"px"),this.setViewport(0,0,C,z))},this.getDrawingBufferSize=function(C){return C.set(V*L,O*L).floor()},this.setDrawingBufferSize=function(C,z,X){V=C,O=z,L=X,t.width=Math.floor(C*X),t.height=Math.floor(z*X),this.setViewport(0,0,C,z)},this.getCurrentViewport=function(C){return C.copy(b)},this.getViewport=function(C){return C.copy(Z)},this.setViewport=function(C,z,X,B){C.isVector4?Z.set(C.x,C.y,C.z,C.w):Z.set(C,z,X,B),re.viewport(b.copy(Z).multiplyScalar(L).floor())},this.getScissor=function(C){return C.copy(ce)},this.setScissor=function(C,z,X,B){C.isVector4?ce.set(C.x,C.y,C.z,C.w):ce.set(C,z,X,B),re.scissor(U.copy(ce).multiplyScalar(L).floor())},this.getScissorTest=function(){return H},this.setScissorTest=function(C){re.setScissorTest(H=C)},this.setOpaqueSort=function(C){k=C},this.setTransparentSort=function(C){G=C},this.getClearColor=function(C){return C.copy(K.getClearColor())},this.setClearColor=function(){K.setClearColor.apply(K,arguments)},this.getClearAlpha=function(){return K.getClearAlpha()},this.setClearAlpha=function(){K.setClearAlpha.apply(K,arguments)},this.clear=function(C=!0,z=!0,X=!0){let B=0;if(C){let Y=!1;if(null!==T){const Te=T.texture.format;Y=Te===FT||Te===OT||Te===LT}if(Y){const Te=T.texture.type,ke=Te===cs||Te===us||Te===sy||Te===Gs||Te===PT||Te===NT,qe=K.getClearColor(),Ze=K.getClearAlpha(),ht=qe.r,tt=qe.g,ot=qe.b,Rt=we.get(T).__webglFramebuffer;ke?(f[0]=ht,f[1]=tt,f[2]=ot,f[3]=Ze,R.clearBufferuiv(R.COLOR,Rt,f)):(p[0]=ht,p[1]=tt,p[2]=ot,p[3]=Ze,R.clearBufferiv(R.COLOR,Rt,p))}else B|=R.COLOR_BUFFER_BIT}z&&(B|=R.DEPTH_BUFFER_BIT),X&&(B|=R.STENCIL_BUFFER_BIT),R.clear(B)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Me,!1),t.removeEventListener("webglcontextrestored",W,!1),t.removeEventListener("webglcontextcreationerror",fe,!1),ae.dispose(),_e.dispose(),we.dispose(),et.dispose(),mt.dispose(),w.dispose(),Ie.dispose(),dt.dispose(),q.dispose(),P.dispose(),P.removeEventListener("sessionstart",qt),P.removeEventListener("sessionend",dr),me&&(me.dispose(),me=null),kn.stop()},this.renderBufferDirect=function(C,z,X,B,Y,Te){null===z&&(z=rt);const ke=Y.isMesh&&Y.matrixWorld.determinant()<0,qe=function oj(C,z,X,B,Y){!0!==z.isScene&&(z=rt),be.resetTextureUnits();const Te=z.fog,qe=null===T?_.outputColorSpace:!0===T.isXRRenderTarget?T.texture.colorSpace:sr,Ze=(B.isMeshStandardMaterial?mt:et).get(B.envMap||(B.isMeshStandardMaterial?z.environment:null)),ht=!0===B.vertexColors&&!!X.attributes.color&&4===X.attributes.color.itemSize,tt=!!X.attributes.tangent&&(!!B.normalMap||B.anisotropy>0),ot=!!X.morphAttributes.position,Rt=!!X.morphAttributes.normal,Qt=!!X.morphAttributes.color,zi=B.toneMapped?_.toneMapping:Rr,$r=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,an=void 0!==$r?$r.length:0,yt=we.get(B),W_=g.state.lights;!0!==j||!0!==ye&&C===x||Ne.setState(B,C,C===x&&B.id===A);let Mn=!1;B.version===yt.__version?(yt.needsLights&&yt.lightsStateVersion!==W_.state.version||yt.outputColorSpace!==qe||Y.isInstancedMesh&&!1===yt.instancing||!Y.isInstancedMesh&&!0===yt.instancing||Y.isSkinnedMesh&&!1===yt.skinning||!Y.isSkinnedMesh&&!0===yt.skinning||yt.envMap!==Ze||!0===B.fog&&yt.fog!==Te||void 0!==yt.numClippingPlanes&&(yt.numClippingPlanes!==Ne.numPlanes||yt.numIntersection!==Ne.numIntersection)||yt.vertexAlphas!==ht||yt.vertexTangents!==tt||yt.morphTargets!==ot||yt.morphNormals!==Rt||yt.morphColors!==Qt||yt.toneMapping!==zi||!0===de.isWebGL2&&yt.morphTargetsCount!==an)&&(Mn=!0):(Mn=!0,yt.__version=B.version);let yo=yt.currentProgram;!0===Mn&&(yo=Qh(B,z,Y));let OC=!1,Vc=!1,$_=!1;const Bn=yo.getUniforms(),_o=yt.uniforms;if(re.useProgram(yo.program)&&(OC=!0,Vc=!0,$_=!0),B.id!==A&&(A=B.id,Vc=!0),OC||x!==C){if(Bn.setValue(R,"projectionMatrix",C.projectionMatrix),de.logarithmicDepthBuffer&&Bn.setValue(R,"logDepthBufFC",2/(Math.log(C.far+1)/Math.LN2)),x!==C&&(x=C,Vc=!0,$_=!0),B.isShaderMaterial||B.isMeshPhongMaterial||B.isMeshToonMaterial||B.isMeshStandardMaterial||B.envMap){const fi=Bn.map.cameraPosition;void 0!==fi&&fi.setValue(R,Ae.setFromMatrixPosition(C.matrixWorld))}(B.isMeshPhongMaterial||B.isMeshToonMaterial||B.isMeshLambertMaterial||B.isMeshBasicMaterial||B.isMeshStandardMaterial||B.isShaderMaterial)&&Bn.setValue(R,"isOrthographic",!0===C.isOrthographicCamera),(B.isMeshPhongMaterial||B.isMeshToonMaterial||B.isMeshLambertMaterial||B.isMeshBasicMaterial||B.isMeshStandardMaterial||B.isShaderMaterial||B.isShadowMaterial||Y.isSkinnedMesh)&&Bn.setValue(R,"viewMatrix",C.matrixWorldInverse)}if(Y.isSkinnedMesh){Bn.setOptional(R,Y,"bindMatrix"),Bn.setOptional(R,Y,"bindMatrixInverse");const fi=Y.skeleton;fi&&(de.floatVertexTextures?(null===fi.boneTexture&&fi.computeBoneTexture(),Bn.setValue(R,"boneTexture",fi.boneTexture,be),Bn.setValue(R,"boneTextureSize",fi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const j_=X.morphAttributes;if((void 0!==j_.position||void 0!==j_.normal||void 0!==j_.color&&!0===de.isWebGL2)&&Fe.update(Y,X,yo),(Vc||yt.receiveShadow!==Y.receiveShadow)&&(yt.receiveShadow=Y.receiveShadow,Bn.setValue(R,"receiveShadow",Y.receiveShadow)),B.isMeshGouraudMaterial&&null!==B.envMap&&(_o.envMap.value=Ze,_o.flipEnvMap.value=Ze.isCubeTexture&&!1===Ze.isRenderTargetTexture?-1:1),Vc&&(Bn.setValue(R,"toneMappingExposure",_.toneMappingExposure),yt.needsLights&&function aj(C,z){C.ambientLightColor.needsUpdate=z,C.lightProbe.needsUpdate=z,C.directionalLights.needsUpdate=z,C.directionalLightShadows.needsUpdate=z,C.pointLights.needsUpdate=z,C.pointLightShadows.needsUpdate=z,C.spotLights.needsUpdate=z,C.spotLightShadows.needsUpdate=z,C.rectAreaLights.needsUpdate=z,C.hemisphereLights.needsUpdate=z}(_o,$_),Te&&!0===B.fog&&oe.refreshFogUniforms(_o,Te),oe.refreshMaterialUniforms(_o,B,L,O,me),Eh.upload(R,yt.uniformsList,_o,be)),B.isShaderMaterial&&!0===B.uniformsNeedUpdate&&(Eh.upload(R,yt.uniformsList,_o,be),B.uniformsNeedUpdate=!1),B.isSpriteMaterial&&Bn.setValue(R,"center",Y.center),Bn.setValue(R,"modelViewMatrix",Y.modelViewMatrix),Bn.setValue(R,"normalMatrix",Y.normalMatrix),Bn.setValue(R,"modelMatrix",Y.matrixWorld),B.isShaderMaterial||B.isRawShaderMaterial){const fi=B.uniformsGroups;for(let q_=0,cj=fi.length;q_<cj;q_++)if(de.isWebGL2){const FC=fi[q_];dt.update(FC,yo),dt.bind(FC,yo)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return yo}(C,z,X,B,Y);re.setMaterial(B,ke);let Ze=X.index,ht=1;!0===B.wireframe&&(Ze=I.getWireframeAttribute(X),ht=2);const tt=X.drawRange,ot=X.attributes.position;let Rt=tt.start*ht,Qt=(tt.start+tt.count)*ht;null!==Te&&(Rt=Math.max(Rt,Te.start*ht),Qt=Math.min(Qt,(Te.start+Te.count)*ht)),null!==Ze?(Rt=Math.max(Rt,0),Qt=Math.min(Qt,Ze.count)):null!=ot&&(Rt=Math.max(Rt,0),Qt=Math.min(Qt,ot.count));const zi=Qt-Rt;if(zi<0||zi===1/0)return;Ie.setup(Y,B,qe,X,Ze);let $r,an=Ue;if(null!==Ze&&($r=$t.get(Ze),an=Ve,an.setIndex($r)),Y.isMesh)!0===B.wireframe?(re.setLineWidth(B.wireframeLinewidth*Le()),an.setMode(R.LINES)):an.setMode(R.TRIANGLES);else if(Y.isLine){let yt=B.linewidth;void 0===yt&&(yt=1),re.setLineWidth(yt*Le()),an.setMode(Y.isLineSegments?R.LINES:Y.isLineLoop?R.LINE_LOOP:R.LINE_STRIP)}else Y.isPoints?an.setMode(R.POINTS):Y.isSprite&&an.setMode(R.TRIANGLES);if(Y.isInstancedMesh)an.renderInstances(Rt,zi,Y.count);else if(X.isInstancedBufferGeometry){const W_=Math.min(X.instanceCount,void 0!==X._maxInstanceCount?X._maxInstanceCount:1/0);an.renderInstances(Rt,zi,W_)}else an.render(Rt,zi)},this.compile=function(C,z){function X(B,Y,Te){!0===B.transparent&&B.side===rr&&!1===B.forceSinglePass?(B.side=Zn,B.needsUpdate=!0,Qh(B,Y,Te),B.side=Ir,B.needsUpdate=!0,Qh(B,Y,Te),B.side=rr):Qh(B,Y,Te)}g=_e.get(C),g.init(),v.push(g),C.traverseVisible(function(B){B.isLight&&B.layers.test(z.layers)&&(g.pushLight(B),B.castShadow&&g.pushShadow(B))}),g.setupLights(_.useLegacyLights),C.traverse(function(B){const Y=B.material;if(Y)if(Array.isArray(Y))for(let Te=0;Te<Y.length;Te++)X(Y[Te],C,B);else X(Y,C,B)}),v.pop(),g=null};let on=null;function qt(){kn.stop()}function dr(){kn.start()}const kn=new OA;function RC(C,z,X,B){if(!1===C.visible)return;if(C.layers.test(z.layers))if(C.isGroup)X=C.renderOrder;else if(C.isLOD)!0===C.autoUpdate&&C.update(z);else if(C.isLight)g.pushLight(C),C.castShadow&&g.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||te.intersectsSprite(C)){B&&Ae.setFromMatrixPosition(C.matrixWorld).applyMatrix4(he);const ke=w.update(C),qe=C.material;qe.visible&&y.push(C,ke,qe,X,Ae.z,null)}}else if((C.isMesh||C.isLine||C.isPoints)&&(!C.frustumCulled||te.intersectsObject(C))){C.isSkinnedMesh&&C.skeleton.frame!==Pe.render.frame&&(C.skeleton.update(),C.skeleton.frame=Pe.render.frame);const ke=w.update(C),qe=C.material;if(B&&(void 0!==C.boundingSphere?(null===C.boundingSphere&&C.computeBoundingSphere(),Ae.copy(C.boundingSphere.center)):(null===ke.boundingSphere&&ke.computeBoundingSphere(),Ae.copy(ke.boundingSphere.center)),Ae.applyMatrix4(C.matrixWorld).applyMatrix4(he)),Array.isArray(qe)){const Ze=ke.groups;for(let ht=0,tt=Ze.length;ht<tt;ht++){const ot=Ze[ht],Rt=qe[ot.materialIndex];Rt&&Rt.visible&&y.push(C,ke,Rt,X,Ae.z,ot)}}else qe.visible&&y.push(C,ke,qe,X,Ae.z,null)}const Te=C.children;for(let ke=0,qe=Te.length;ke<qe;ke++)RC(Te[ke],z,X,B)}function PC(C,z,X,B){const Y=C.opaque,Te=C.transmissive,ke=C.transparent;g.setupLightsView(X),!0===j&&Ne.setGlobalState(_.clippingPlanes,X),Te.length>0&&function sj(C,z,X,B){const Y=de.isWebGL2;null===me&&(me=new Ys(1,1,{generateMipmaps:!0,type:Q.has("EXT_color_buffer_half_float")?ac:cs,minFilter:Pr,samples:Y&&!0===a?4:0})),_.getDrawingBufferSize(Re),Y?me.setSize(Re.x,Re.y):me.setSize(Zd(Re.x),Zd(Re.y));const Te=_.getRenderTarget();_.setRenderTarget(me),_.getClearColor(N),F=_.getClearAlpha(),F<1&&_.setClearColor(16777215,.5),_.clear();const ke=_.toneMapping;_.toneMapping=Rr,Jh(C,X,B),be.updateMultisampleRenderTarget(me),be.updateRenderTargetMipmap(me);let qe=!1;for(let Ze=0,ht=z.length;Ze<ht;Ze++){const tt=z[Ze],ot=tt.object,Rt=tt.geometry,Qt=tt.material,zi=tt.group;if(Qt.side===rr&&ot.layers.test(B.layers)){const $r=Qt.side;Qt.side=Zn,Qt.needsUpdate=!0,NC(ot,X,B,Rt,Qt,zi),Qt.side=$r,Qt.needsUpdate=!0,qe=!0}}!0===qe&&(be.updateMultisampleRenderTarget(me),be.updateRenderTargetMipmap(me)),_.setRenderTarget(Te),_.setClearColor(N,F),_.toneMapping=ke}(Y,Te,z,X),B&&re.viewport(b.copy(B)),Y.length>0&&Jh(Y,z,X),Te.length>0&&Jh(Te,z,X),ke.length>0&&Jh(ke,z,X),re.buffers.depth.setTest(!0),re.buffers.depth.setMask(!0),re.buffers.color.setMask(!0),re.setPolygonOffset(!1)}function Jh(C,z,X){const B=!0===z.isScene?z.overrideMaterial:null;for(let Y=0,Te=C.length;Y<Te;Y++){const ke=C[Y],qe=ke.object,Ze=ke.geometry,ht=null===B?ke.material:B,tt=ke.group;qe.layers.test(X.layers)&&NC(qe,z,X,Ze,ht,tt)}}function NC(C,z,X,B,Y,Te){C.onBeforeRender(_,z,X,B,Y,Te),C.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),Y.onBeforeRender(_,z,X,B,C,Te),!0===Y.transparent&&Y.side===rr&&!1===Y.forceSinglePass?(Y.side=Zn,Y.needsUpdate=!0,_.renderBufferDirect(X,z,B,Y,C,Te),Y.side=Ir,Y.needsUpdate=!0,_.renderBufferDirect(X,z,B,Y,C,Te),Y.side=rr):_.renderBufferDirect(X,z,B,Y,C,Te),C.onAfterRender(_,z,X,B,Y,Te)}function Qh(C,z,X){!0!==z.isScene&&(z=rt);const B=we.get(C),Y=g.state.lights,ke=Y.state.version,qe=q.getParameters(C,Y.state,g.state.shadowsArray,z,X),Ze=q.getProgramCacheKey(qe);let ht=B.programs;B.environment=C.isMeshStandardMaterial?z.environment:null,B.fog=z.fog,B.envMap=(C.isMeshStandardMaterial?mt:et).get(C.envMap||B.environment),void 0===ht&&(C.addEventListener("dispose",Se),ht=new Map,B.programs=ht);let tt=ht.get(Ze);if(void 0!==tt){if(B.currentProgram===tt&&B.lightsStateVersion===ke)return LC(C,qe),tt}else qe.uniforms=q.getUniforms(C),C.onBuild(X,qe,_),C.onBeforeCompile(qe,_),tt=q.acquireProgram(qe,Ze),ht.set(Ze,tt),B.uniforms=qe.uniforms;const ot=B.uniforms;(!C.isShaderMaterial&&!C.isRawShaderMaterial||!0===C.clipping)&&(ot.clippingPlanes=Ne.uniform),LC(C,qe),B.needsLights=function lj(C){return C.isMeshLambertMaterial||C.isMeshToonMaterial||C.isMeshPhongMaterial||C.isMeshStandardMaterial||C.isShadowMaterial||C.isShaderMaterial&&!0===C.lights}(C),B.lightsStateVersion=ke,B.needsLights&&(ot.ambientLightColor.value=Y.state.ambient,ot.lightProbe.value=Y.state.probe,ot.directionalLights.value=Y.state.directional,ot.directionalLightShadows.value=Y.state.directionalShadow,ot.spotLights.value=Y.state.spot,ot.spotLightShadows.value=Y.state.spotShadow,ot.rectAreaLights.value=Y.state.rectArea,ot.ltc_1.value=Y.state.rectAreaLTC1,ot.ltc_2.value=Y.state.rectAreaLTC2,ot.pointLights.value=Y.state.point,ot.pointLightShadows.value=Y.state.pointShadow,ot.hemisphereLights.value=Y.state.hemi,ot.directionalShadowMap.value=Y.state.directionalShadowMap,ot.directionalShadowMatrix.value=Y.state.directionalShadowMatrix,ot.spotShadowMap.value=Y.state.spotShadowMap,ot.spotLightMatrix.value=Y.state.spotLightMatrix,ot.spotLightMap.value=Y.state.spotLightMap,ot.pointShadowMap.value=Y.state.pointShadowMap,ot.pointShadowMatrix.value=Y.state.pointShadowMatrix);const Rt=tt.getUniforms(),Qt=Eh.seqWithValue(Rt.seq,ot);return B.currentProgram=tt,B.uniformsList=Qt,tt}function LC(C,z){const X=we.get(C);X.outputColorSpace=z.outputColorSpace,X.instancing=z.instancing,X.skinning=z.skinning,X.morphTargets=z.morphTargets,X.morphNormals=z.morphNormals,X.morphColors=z.morphColors,X.morphTargetsCount=z.morphTargetsCount,X.numClippingPlanes=z.numClippingPlanes,X.numIntersection=z.numClipIntersection,X.vertexAlphas=z.vertexAlphas,X.vertexTangents=z.vertexTangents,X.toneMapping=z.toneMapping}kn.setAnimationLoop(function go(C){on&&on(C)}),typeof self<"u"&&kn.setContext(self),this.setAnimationLoop=function(C){on=C,P.setAnimationLoop(C),null===C?kn.stop():kn.start()},P.addEventListener("sessionstart",qt),P.addEventListener("sessionend",dr),this.render=function(C,z){if(void 0===z||!0===z.isCamera){if(!0!==M){if(!0===C.matrixWorldAutoUpdate&&C.updateMatrixWorld(),null===z.parent&&!0===z.matrixWorldAutoUpdate&&z.updateMatrixWorld(),!0===P.enabled&&!0===P.isPresenting&&(z=P.updateCameraXR(z)),!0===C.isScene&&C.onBeforeRender(_,C,z,T),g=_e.get(C,v.length),g.init(),v.push(g),he.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),te.setFromProjectionMatrix(he),ye=this.localClippingEnabled,j=Ne.init(this.clippingPlanes,ye),y=ae.get(C,m.length),y.init(),m.push(y),RC(C,z,0,_.sortObjects),y.finish(),!0===_.sortObjects&&y.sort(k,G),!0===j&&Ne.beginShadows(),ve.render(g.state.shadowsArray,C,z),!0===j&&Ne.endShadows(),!0===this.info.autoReset&&this.info.reset(),this.info.render.frame++,K.render(y,C),g.setupLights(_.useLegacyLights),z.isArrayCamera){const B=z.cameras;for(let Y=0,Te=B.length;Y<Te;Y++){const ke=B[Y];PC(y,C,ke,ke.viewport)}}else PC(y,C,z);null!==T&&(be.updateMultisampleRenderTarget(T),be.updateRenderTargetMipmap(T)),!0===C.isScene&&C.onAfterRender(_,C,z),Ie.resetDefaultState(),A=-1,x=null,v.pop(),g=v.length>0?v[v.length-1]:null,m.pop(),y=m.length>0?m[m.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(C,z,X){we.get(C.texture).__webglTexture=z,we.get(C.depthTexture).__webglTexture=X;const B=we.get(C);B.__hasExternalTextures=!0,B.__hasExternalTextures&&(B.__autoAllocateDepthBuffer=void 0===X,B.__autoAllocateDepthBuffer||!0===Q.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),B.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(C,z){const X=we.get(C);X.__webglFramebuffer=z,X.__useDefaultFramebuffer=void 0===z},this.setRenderTarget=function(C,z=0,X=0){T=C,E=z,S=X;let B=!0,Y=null,Te=!1,ke=!1;if(C){const Ze=we.get(C);void 0!==Ze.__useDefaultFramebuffer?(re.bindFramebuffer(R.FRAMEBUFFER,null),B=!1):void 0===Ze.__webglFramebuffer?be.setupRenderTarget(C):Ze.__hasExternalTextures&&be.rebindTextures(C,we.get(C.texture).__webglTexture,we.get(C.depthTexture).__webglTexture);const ht=C.texture;(ht.isData3DTexture||ht.isDataArrayTexture||ht.isCompressedArrayTexture)&&(ke=!0);const tt=we.get(C).__webglFramebuffer;C.isWebGLCubeRenderTarget?(Y=tt[z],Te=!0):Y=de.isWebGL2&&C.samples>0&&!1===be.useMultisampledRTT(C)?we.get(C).__webglMultisampledFramebuffer:tt,b.copy(C.viewport),U.copy(C.scissor),$=C.scissorTest}else b.copy(Z).multiplyScalar(L).floor(),U.copy(ce).multiplyScalar(L).floor(),$=H;if(re.bindFramebuffer(R.FRAMEBUFFER,Y)&&de.drawBuffers&&B&&re.drawBuffers(C,Y),re.viewport(b),re.scissor(U),re.setScissorTest($),Te){const Ze=we.get(C.texture);R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+z,Ze.__webglTexture,X)}else if(ke){const Ze=we.get(C.texture);R.framebufferTextureLayer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,Ze.__webglTexture,X||0,z||0)}A=-1},this.readRenderTargetPixels=function(C,z,X,B,Y,Te,ke){if(!C||!C.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let qe=we.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&void 0!==ke&&(qe=qe[ke]),qe){re.bindFramebuffer(R.FRAMEBUFFER,qe);try{const Ze=C.texture,ht=Ze.format,tt=Ze.type;if(ht!==Ei&&Ce.convert(ht)!==R.getParameter(R.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const ot=tt===ac&&(Q.has("EXT_color_buffer_half_float")||de.isWebGL2&&Q.has("EXT_color_buffer_float"));if(!(tt===cs||Ce.convert(tt)===R.getParameter(R.IMPLEMENTATION_COLOR_READ_TYPE)||tt===Nr&&(de.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float"))||ot))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");z>=0&&z<=C.width-B&&X>=0&&X<=C.height-Y&&R.readPixels(z,X,B,Y,Ce.convert(ht),Ce.convert(tt),Te)}finally{const Ze=null!==T?we.get(T).__webglFramebuffer:null;re.bindFramebuffer(R.FRAMEBUFFER,Ze)}}},this.copyFramebufferToTexture=function(C,z,X=0){const B=Math.pow(2,-X),Y=Math.floor(z.image.width*B),Te=Math.floor(z.image.height*B);be.setTexture2D(z,0),R.copyTexSubImage2D(R.TEXTURE_2D,X,0,0,C.x,C.y,Y,Te),re.unbindTexture()},this.copyTextureToTexture=function(C,z,X,B=0){const Y=z.image.width,Te=z.image.height,ke=Ce.convert(X.format),qe=Ce.convert(X.type);be.setTexture2D(X,0),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,X.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,X.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,X.unpackAlignment),z.isDataTexture?R.texSubImage2D(R.TEXTURE_2D,B,C.x,C.y,Y,Te,ke,qe,z.image.data):z.isCompressedTexture?R.compressedTexSubImage2D(R.TEXTURE_2D,B,C.x,C.y,z.mipmaps[0].width,z.mipmaps[0].height,ke,z.mipmaps[0].data):R.texSubImage2D(R.TEXTURE_2D,B,C.x,C.y,ke,qe,z.image),0===B&&X.generateMipmaps&&R.generateMipmap(R.TEXTURE_2D),re.unbindTexture()},this.copyTextureToTexture3D=function(C,z,X,B,Y=0){if(_.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Te=C.max.x-C.min.x+1,ke=C.max.y-C.min.y+1,qe=C.max.z-C.min.z+1,Ze=Ce.convert(B.format),ht=Ce.convert(B.type);let tt;if(B.isData3DTexture)be.setTexture3D(B,0),tt=R.TEXTURE_3D;else{if(!B.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");be.setTexture2DArray(B,0),tt=R.TEXTURE_2D_ARRAY}R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,B.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,B.unpackAlignment);const ot=R.getParameter(R.UNPACK_ROW_LENGTH),Rt=R.getParameter(R.UNPACK_IMAGE_HEIGHT),Qt=R.getParameter(R.UNPACK_SKIP_PIXELS),zi=R.getParameter(R.UNPACK_SKIP_ROWS),$r=R.getParameter(R.UNPACK_SKIP_IMAGES),an=X.isCompressedTexture?X.mipmaps[0]:X.image;R.pixelStorei(R.UNPACK_ROW_LENGTH,an.width),R.pixelStorei(R.UNPACK_IMAGE_HEIGHT,an.height),R.pixelStorei(R.UNPACK_SKIP_PIXELS,C.min.x),R.pixelStorei(R.UNPACK_SKIP_ROWS,C.min.y),R.pixelStorei(R.UNPACK_SKIP_IMAGES,C.min.z),X.isDataTexture||X.isData3DTexture?R.texSubImage3D(tt,Y,z.x,z.y,z.z,Te,ke,qe,Ze,ht,an.data):X.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),R.compressedTexSubImage3D(tt,Y,z.x,z.y,z.z,Te,ke,qe,Ze,an.data)):R.texSubImage3D(tt,Y,z.x,z.y,z.z,Te,ke,qe,Ze,ht,an),R.pixelStorei(R.UNPACK_ROW_LENGTH,ot),R.pixelStorei(R.UNPACK_IMAGE_HEIGHT,Rt),R.pixelStorei(R.UNPACK_SKIP_PIXELS,Qt),R.pixelStorei(R.UNPACK_SKIP_ROWS,zi),R.pixelStorei(R.UNPACK_SKIP_IMAGES,$r),0===Y&&B.generateMipmaps&&R.generateMipmap(tt),re.unbindTexture()},this.initTexture=function(C){C.isCubeTexture?be.setTextureCube(C,0):C.isData3DTexture?be.setTexture3D(C,0):C.isDataArrayTexture||C.isCompressedArrayTexture?be.setTexture2DArray(C,0):be.setTexture2D(C,0),re.unbindTexture()},this.resetState=function(){E=0,S=0,T=null,re.reset(),Ie.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Lr}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===We?$s:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===$s?We:sr}}(class D8 extends uD{}).prototype.isWebGL1Renderer=!0;class dD extends yn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class qy{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=li()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=li()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=li()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Un=new D;class io{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.applyMatrix4(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.applyNormalMatrix(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.transformDirection(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}setX(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=st(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ci(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ci(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ci(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ci(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),i=st(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),i=st(i,this.array),r=st(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=st(t,this.array),i=st(i,this.array),r=st(r,this.array),s=st(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Gt(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new io(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const yD=new D,_D=new bt,vD=new bt,R8=new D,MD=new $e,$a=new D,Yy=new Ui,xD=new $e,Ky=new pc;class ED extends In{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new $e,this.bindMatrixInverse=new $e,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new or),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)$a.fromBufferAttribute(t,i),this.applyBoneTransform(i,$a),this.boundingBox.expandByPoint($a)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Ui),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)$a.fromBufferAttribute(t,i),this.applyBoneTransform(i,$a),this.boundingSphere.expandByPoint($a)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Yy.copy(this.boundingSphere),Yy.applyMatrix4(r),!1!==e.ray.intersectsSphere(Yy)&&(xD.copy(r).invert(),Ky.copy(e.ray).applyMatrix4(xD),(null===this.boundingBox||!1!==Ky.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,Ky)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new bt,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;_D.fromBufferAttribute(r.attributes.skinIndex,e),vD.fromBufferAttribute(r.attributes.skinWeight,e),yD.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=vD.getComponent(s);if(0!==o){const a=_D.getComponent(s);MD.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(R8.copy(yD).applyMatrix4(MD),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Zy extends yn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ec extends Fi{constructor(e=null,t=1,i=1,r,s,o,a,l,c=Zt,u=Zt,d,h){super(null,o,a,l,c,u,r,s,d,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const SD=new $e,P8=new $e;class Ah{constructor(e=[],t=[]){this.uuid=li(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new $e)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new $e;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++)SD.multiplyMatrices(e[s]?e[s].matrixWorld:P8,t[s]),SD.toArray(i,16*s);null!==r&&(r.needsUpdate=!0)}clone(){return new Ah(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=hA(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Ec(t,e,e,Ei,Nr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Zy),this.bones.push(o),this.boneInverses.push((new $e).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++)e.bones.push(t[r].uuid),e.boneInverses.push(i[r].toArray());return e}}class Sc extends Gt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const ja=new $e,wD=new $e,Dh=[],bD=new or,N8=new $e,wc=new In,bc=new Ui;class TD extends In{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Sc(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,N8)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new or),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,ja),bD.copy(e.boundingBox).applyMatrix4(ja),this.boundingBox.union(bD)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Ui),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,ja),bc.copy(e.boundingSphere).applyMatrix4(ja),this.boundingSphere.union(bc)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(wc.geometry=this.geometry,wc.material=this.material,void 0!==wc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),bc.copy(this.boundingSphere),bc.applyMatrix4(i),!1!==e.ray.intersectsSphere(bc)))for(let s=0;s<r;s++){this.getMatrixAt(s,ja),wD.multiplyMatrices(i,ja),wc.matrixWorld=wD,wc.raycast(e,Dh);for(let o=0,a=Dh.length;o<a;o++){const l=Dh[o];l.instanceId=s,l.object=this,t.push(l)}Dh.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Sc(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Qn extends Vi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ge(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const AD=new D,DD=new D,CD=new $e,Jy=new pc,Ch=new Ui;class ro extends yn{constructor(e=new ct,t=new Qn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)AD.fromBufferAttribute(t,r-1),DD.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=AD.distanceTo(DD);e.setAttribute("lineDistance",new De(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ch.copy(i.boundingSphere),Ch.applyMatrix4(r),Ch.radius+=s,!1===e.ray.intersectsSphere(Ch))return;CD.copy(r).invert(),Jy.copy(e.ray).applyMatrix4(CD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new D,u=new D,d=new D,h=new D,f=this.isLineSegments?2:1,p=i.index,g=i.attributes.position;if(null!==p)for(let _=Math.max(0,o.start),M=Math.min(p.count,o.start+o.count)-1;_<M;_+=f){const E=p.getX(_),S=p.getX(_+1);if(c.fromBufferAttribute(g,E),u.fromBufferAttribute(g,S),Jy.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(h);A<e.near||A>e.far||t.push({distance:A,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}else for(let _=Math.max(0,o.start),M=Math.min(g.count,o.start+o.count)-1;_<M;_+=f){if(c.fromBufferAttribute(g,_),u.fromBufferAttribute(g,_+1),Jy.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const ID=new D,RD=new D;class Qy extends ro{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)ID.fromBufferAttribute(t,r),RD.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+ID.distanceTo(RD);e.setAttribute("lineDistance",new De(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class PD extends ro{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class e_ extends Vi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ge(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const ND=new $e,t_=new pc,Ih=new Ui,Rh=new D;class LD extends yn{constructor(e=new ct,t=new e_){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ih.copy(i.boundingSphere),Ih.applyMatrix4(r),Ih.radius+=s,!1===e.ray.intersectsSphere(Ih))return;ND.copy(r).invert(),t_.copy(e.ray).applyMatrix4(ND);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(null!==c)for(let p=Math.max(0,o.start),y=Math.min(c.count,o.start+o.count);p<y;p++){const g=c.getX(p);Rh.fromBufferAttribute(d,g),OD(Rh,g,l,r,e,t,this)}else for(let p=Math.max(0,o.start),y=Math.min(d.count,o.start+o.count);p<y;p++)Rh.fromBufferAttribute(d,p),OD(Rh,p,l,r,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function OD(n,e,t,i,r,s,o){const a=t_.distanceSqToPoint(n);if(a<t){const l=new D;t_.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class Gh extends Vi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ge(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=js,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Gr extends Gh{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ne(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return zt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ge(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ge(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ge(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function bi(n,e,t){return w_(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)}function ao(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function w_(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function YD(n){const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(function e(r,s){return n[r]-n[s]}),i}function b_(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function T_(n,e,t,i){let r=1,s=n[0];for(;void 0!==s&&void 0===s[i];)s=n[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),t.push.apply(t,o)),s=n[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),t.push(o)),s=n[r++]}while(void 0!==s)}class Pc{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class b6 extends Pc{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-i;break;case 2402:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:o=e,l=2*i-t;break;case 2402:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=.5*(i-t),u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(i-t)/(r-t),y=p*p,g=y*p,m=-h*g+2*h*y-h*p,v=(1+h)*g+(-1.5-2*h)*y+(-.5+h)*p+1,_=(-1-f)*g+(1.5+f)*y+.5*p,M=f*g-f*y;for(let E=0;E!==a;++E)s[E]=m*o[u+E]+v*o[c+E]+_*o[l+E]+M*o[d+E];return s}}class KD extends Pc{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[c+h]*d+o[l+h]*u;return s}}class T6 extends Pc{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class cr{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ao(t,this.TimeBufferType),this.values=ao(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:ao(e.times,Array),values:ao(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new T6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new KD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new b6(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case lc:t=this.InterpolantFactoryMethodDiscrete;break;case fa:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return lc;case this.InterpolantFactoryMethodLinear:return fa;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=bi(i,s,o),this.values=bi(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(void 0!==r&&w_(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=bi(this.times),t=bi(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a];if(c!==e[a+1]&&(1!==a||c!==e[0]))if(r)l=!0;else{const d=a*i,h=d-i,f=d+i;for(let p=0;p!==i;++p){const y=t[d+p];if(y!==t[h+p]||y!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,h=o*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=bi(e,0,o),this.values=bi(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=bi(this.times,0),t=bi(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}cr.prototype.TimeBufferType=Float32Array,cr.prototype.ValueBufferType=Float32Array,cr.prototype.DefaultInterpolation=fa;class Ya extends cr{}Ya.prototype.ValueTypeName="bool",Ya.prototype.ValueBufferType=Array,Ya.prototype.DefaultInterpolation=lc,Ya.prototype.InterpolantFactoryMethodLinear=void 0,Ya.prototype.InterpolantFactoryMethodSmooth=void 0;class ZD extends cr{}ZD.prototype.ValueTypeName="color";class Nc extends cr{}Nc.prototype.ValueTypeName="number";class A6 extends Pc{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)On.slerpFlat(s,0,o,c-a,o,c,l);return s}}class lo extends cr{InterpolantFactoryMethodLinear(e){return new A6(this.times,this.values,this.getValueSize(),e)}}lo.prototype.ValueTypeName="quaternion",lo.prototype.DefaultInterpolation=fa,lo.prototype.InterpolantFactoryMethodSmooth=void 0;class Ka extends cr{}Ka.prototype.ValueTypeName="string",Ka.prototype.ValueBufferType=Array,Ka.prototype.DefaultInterpolation=lc,Ka.prototype.InterpolantFactoryMethodLinear=void 0,Ka.prototype.InterpolantFactoryMethodSmooth=void 0;class Lc extends cr{}Lc.prototype.ValueTypeName="vector";class Oc{constructor(e,t=-1,i,r=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=li(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(C6(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(cr.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=YD(l);l=b_(l,1,u),c=b_(c,1,u),!r&&0===l[0]&&(l.push(s),c.push(c[0])),o.push(new Nc(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const d=u[1];let h=r[d];h||(r[d]=h=[]),h.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,h,f,p,y){if(0!==f.length){const g=[],m=[];T_(f,g,m,p),0!==g.length&&y.push(new d(h,g,m))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const h=c[d].keys;if(h&&0!==h.length)if(h[0].morphTargets){const f={};let p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let y=0;y<h[p].morphTargets.length;y++)f[h[p].morphTargets[y]]=-1;for(const y in f){const g=[],m=[];for(let v=0;v!==h[p].morphTargets.length;++v){const _=h[p];g.push(_.time),m.push(_.morphTarget===y?1:0)}r.push(new Nc(".morphTargetInfluence["+y+"]",g,m))}l=f.length*o}else{const f=".bones["+t[d].name+"]";i(Lc,f+".position",h,"pos",r),i(lo,f+".quaternion",h,"rot",r),i(Lc,f+".scale",h,"scl",r)}}return 0===r.length?null:new this(s,l,r,a)}resetDuration(){let t=0;for(let i=0,r=this.tracks.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function C6(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function D6(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Nc;case"vector":case"vector2":case"vector3":case"vector4":return Lc;case"color":return ZD;case"quaternion":return lo;case"bool":case"boolean":return Ya;case"string":return Ka}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],i=[];T_(n.keys,t,i,"value"),n.times=t,n.values=i}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Za={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class JD{constructor(e,t,i){const r=this;let l,s=!1,o=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,!1===s&&void 0!==r.onStart&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,void 0!==r.onProgress&&r.onProgress(u,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(u){void 0!==r.onError&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return-1!==d&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){const f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const I6=new JD;class Fc{constructor(e){this.manager=void 0!==e?e:I6,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Wr={};class R6 extends Error{constructor(e,t){super(e),this.response=t}}class ur extends Fc{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Za.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==Wr[e])return void Wr[e].push({onLoad:t,onProgress:i,onError:r});Wr[e]=[],Wr[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(200===c.status||0===c.status){if(0===c.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===c.body||void 0===c.body.getReader)return c;const u=Wr[e],d=c.body.getReader(),h=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=h?parseInt(h):0,p=0!==f;let y=0;const g=new ReadableStream({start(m){!function v(){d.read().then(({done:_,value:M})=>{if(_)m.close();else{y+=M.byteLength;const E=new ProgressEvent("progress",{lengthComputable:p,loaded:y,total:f});for(let S=0,T=u.length;S<T;S++){const A=u[S];A.onProgress&&A.onProgress(E)}m.enqueue(M),v()}})}()}});return new Response(g)}throw new R6(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>(new DOMParser).parseFromString(u,a));case"json":return c.json();default:if(void 0===a)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),h=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(h);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{Za.add(e,c);const u=Wr[e];delete Wr[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Wr[e];if(void 0===u)throw this.manager.itemError(e),c;delete Wr[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Wh extends Fc{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Za.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=uc("img");function l(){u(),Za.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){u(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class P6 extends Fc{constructor(e){super(e)}load(e,t,i,r){const s=new Fi,o=new Wh(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},i,r),s}}class A_ extends yn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ge(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const D_=new $e,QD=new D,eC=new D;class C_{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ne(512,512),this.map=null,this.mapPass=null,this.matrix=new $e,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ky,this._frameExtents=new ne(1,1),this._viewportCount=1,this._viewports=[new bt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;QD.setFromMatrixPosition(e.matrixWorld),t.position.copy(QD),eC.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(eC),t.updateMatrixWorld(),D_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(D_),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(D_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class L6 extends C_{constructor(){super(new vn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*ya*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class tC extends A_{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(yn.DEFAULT_UP),this.updateMatrix(),this.target=new yn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new L6}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const nC=new $e,Uc=new D,I_=new D;class O6 extends C_{constructor(){super(new vn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ne(4,2),this._viewportCount=6,this._viewports=[new bt(2,1,1,1),new bt(0,1,1,1),new bt(3,1,1,1),new bt(1,1,1,1),new bt(3,0,1,1),new bt(1,0,1,1)],this._cubeDirections=[new D(1,0,0),new D(-1,0,0),new D(0,0,1),new D(0,0,-1),new D(0,1,0),new D(0,-1,0)],this._cubeUps=[new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,0,1),new D(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Uc.setFromMatrixPosition(e.matrixWorld),i.position.copy(Uc),I_.copy(i.position),I_.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(I_),i.updateMatrixWorld(),r.makeTranslation(-Uc.x,-Uc.y,-Uc.z),nC.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nC)}}class iC extends A_{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new O6}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class F6 extends C_{constructor(){super(new vh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class rC extends A_{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(yn.DEFAULT_UP),this.updateMatrix(),this.target=new yn,this.shadow=new F6}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class kc{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class W6 extends Fc{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Za.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Za.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}const P_="\\[\\]\\.:\\/",Y6=new RegExp("["+P_+"]","g"),N_="[^"+P_+"]",K6="[^"+P_.replace("\\.","")+"]",t$=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",N_)+/(WCOD+)?/.source.replace("WCOD",K6)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",N_)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",N_)+"$"),n$=["material","materials","bones","map"];class i${constructor(e,t,i){const r=i||Dt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let Dt=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Y6,"")}static parseTrackName(t){const i=t$.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==n$.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const c=r(l.children);if(c)return c}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=i$,n})();function wC(n,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===fy||e===aA){let t=n.getIndex();if(null===t){const o=[],a=n.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}const i=t.count-2,r=[];if(e===fy)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}Dt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Dt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Dt.prototype.GetterByBindingType=[Dt.prototype._getValue_direct,Dt.prototype._getValue_array,Dt.prototype._getValue_arrayElement,Dt.prototype._getValue_toArray],Dt.prototype.SetterByBindingTypeAndVersioning=[[Dt.prototype._setValue_direct,Dt.prototype._setValue_direct_setNeedsUpdate,Dt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Dt.prototype._setValue_array,Dt.prototype._setValue_array_setNeedsUpdate,Dt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Dt.prototype._setValue_arrayElement,Dt.prototype._setValue_arrayElement_setNeedsUpdate,Dt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Dt.prototype._setValue_fromArray,Dt.prototype._setValue_fromArray_setNeedsUpdate,Dt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"153"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="153");class c$ extends Fc{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new p$(t)}),this.register(function(t){return new E$(t)}),this.register(function(t){return new S$(t)}),this.register(function(t){return new w$(t)}),this.register(function(t){return new g$(t)}),this.register(function(t){return new y$(t)}),this.register(function(t){return new _$(t)}),this.register(function(t){return new v$(t)}),this.register(function(t){return new f$(t)}),this.register(function(t){return new M$(t)}),this.register(function(t){return new m$(t)}),this.register(function(t){return new x$(t)}),this.register(function(t){return new d$(t)}),this.register(function(t){return new b$(t)}),this.register(function(t){return new T$(t)})}load(e,t,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:kc.extractUrlBase(e),this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new ur(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},a={},l=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===bC){try{o[pt.KHR_BINARY_GLTF]=new A$(e)}catch(d){return void(r&&r(d))}s=JSON.parse(o[pt.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new V$(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);a[d.name]=d,o[d.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const d=s.extensionsUsed[u],h=s.extensionsRequired||[];switch(d){case pt.KHR_MATERIALS_UNLIT:o[d]=new h$;break;case pt.KHR_DRACO_MESH_COMPRESSION:o[d]=new D$(s,this.dracoLoader);break;case pt.KHR_TEXTURE_TRANSFORM:o[d]=new C$;break;case pt.KHR_MESH_QUANTIZATION:o[d]=new I$;break;default:h.indexOf(d)>=0&&void 0===a[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function u$(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const pt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class d${constructor(e){this.parser=e,this.name=pt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new ge(16777215);void 0!==l.color&&u.fromArray(l.color);const d=void 0!==l.range?l.range:0;switch(l.type){case"directional":c=new rC(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new iC(u),c.distance=d;break;case"spot":c=new tC(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,vs(c,l),void 0!==l.intensity&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(i,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class h${constructor(){this.name=pt.KHR_MATERIALS_UNLIT}getMaterialType(){return Si}extendParams(e,t,i){const r=[];e.color=new ge(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(e,"map",s.baseColorTexture,We))}return Promise.all(r)}}class f${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class p${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ne(a,a)}return Promise.all(s)}}class m${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class g${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ge(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,We)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class y${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class _${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ge(a[0],a[1],a[2]),Promise.all(s)}}class v${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class M${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ge(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,We)),Promise.all(s)}}class x${constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Gr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class E${constructor(e){this.parser=e,this.name=pt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class S${constructor(e){this.parser=e,this.name=pt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);null!==c&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class w${constructor(e){this.parser=e,this.name=pt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);null!==c&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class b${constructor(e){this.name=pt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const u=r.count,d=r.byteStride,h=new Uint8Array(a,r.byteOffset||0,r.byteLength||0);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,h,r.mode,r.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(f),u,d,h,r.mode,r.filter),f})})}return null}}class T${constructor(e){this.name=pt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const r=t.meshes[i.mesh];for(const c of r.primitives)if(c.mode!==Ti.TRIANGLES&&c.mode!==Ti.TRIANGLE_STRIP&&c.mode!==Ti.TRIANGLE_FAN&&void 0!==c.mode)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,f=[];for(const p of d){const y=new $e,g=new D,m=new On,v=new D(1,1,1),_=new TD(p.geometry,p.material,h);for(let M=0;M<h;M++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,M),l.ROTATION&&m.fromBufferAttribute(l.ROTATION,M),l.SCALE&&v.fromBufferAttribute(l.SCALE,M),_.setMatrixAt(M,y.compose(g,m,v));for(const M in l)"TRANSLATION"!==M&&"ROTATION"!==M&&"SCALE"!==M&&p.geometry.setAttribute(M,l[M]);yn.prototype.copy.call(_,p),this.parser.assignFinalMaterial(_),f.push(_)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const bC="glTF";class A${constructor(e){this.name=pt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==bC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,1313821514===l){const c=new Uint8Array(e,12+o,a);this.content=i.decode(c)}else if(5130562===l){const c=12+o;this.body=e.slice(c,c+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class D${constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=pt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const d=V_[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=V_[u]||u.toLowerCase();if(void 0!==o[u]){const h=i.accessors[e.attributes[u]];c[d]=Ja[h.componentType].name,l[d]=!0===h.normalized}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(d){r.decodeDracoFile(u,function(h){for(const f in h.attributes){const y=l[f];void 0!==y&&(h.attributes[f].normalized=y)}d(h)},a,c)})})}}class C${constructor(){this.name=pt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class I${constructor(){this.name=pt.KHR_MESH_QUANTIZATION}}class AC extends Pc{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=2*a,c=3*a,u=r-t,d=(i-t)/u,h=d*d,f=h*d,p=e*c,y=p-c,g=-2*f+3*h,m=f-h,v=1-g,_=m-h+d;for(let M=0;M!==a;M++)s[M]=v*o[y+M+a]+_*(o[y+M+l]*u)+g*o[p+M+a]+m*(o[p+M]*u);return s}}const R$=new On;class P$ extends AC{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return R$.fromArray(s).normalize().toArray(s),s}}const Ti={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ja={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},DC={9728:Zt,9729:Ht,9984:qd,9985:ry,9986:oc,9987:Pr},CC={33071:An,33648:sc,10497:zs},B_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},V_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_s={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},N$={CUBICSPLINE:void 0,LINEAR:fa,STEP:lc};function mo(n,e,t){for(const i in t.extensions)void 0===n[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function vs(n,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function F$(n,e){if(n.updateMorphTargets(),void 0!==e.weights)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function U$(n){let e;const t=n.extensions&&n.extensions[pt.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+z_(t.attributes):n.indices+":"+z_(n.attributes)+":"+n.mode,void 0!==n.targets)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+z_(n.targets[i]);return e}function z_(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function G_(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const B$=new $e;class V${constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new u$,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||i||r&&s<98?new P6(this.options.manager):new W6(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ur(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};mo(s,a,r),vs(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(i[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);null!=l&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[pt.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(kc.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteOffset||0;return i.slice(s,s+(t.byteLength||0))})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const o=B_[r.type],l=!0===r.normalized,c=new(0,Ja[r.componentType])(r.count*o);return Promise.resolve(new Gt(c,o,l))}const s=[];return s.push(void 0!==r.bufferView?this.getDependency("bufferView",r.bufferView):null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=B_[r.type],c=Ja[r.componentType],u=c.BYTES_PER_ELEMENT,h=r.byteOffset||0,f=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;let y,g;if(f&&f!==u*l){const m=Math.floor(h/f),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count;let _=t.cache.get(v);_||(y=new c(a,m*f,r.count*f/u),_=new qy(y,f/u),t.cache.add(v,_)),g=new io(_,l,h%f/u,p)}else y=null===a?new c(r.count*l):new c(a,h,r.count*l),g=new Gt(y,l,p);if(void 0!==r.sparse){const M=r.sparse.values.byteOffset||0,E=new(0,Ja[r.sparse.indices.componentType])(o[1],r.sparse.indices.byteOffset||0,r.sparse.count*B_.SCALAR),S=new c(o[2],M,r.sparse.count*l);null!==a&&(g=new Gt(g.array.slice(),g.itemSize,g.normalized));for(let T=0,A=E.length;T<A;T++){const x=E[T];if(g.setX(x,S[T*l]),l>=2&&g.setY(x,S[T*l+1]),l>=3&&g.setZ(x,S[T*l+2]),l>=4&&g.setW(x,S[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=this.options.manager.getHandler(o.uri);null!==l&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",""===u.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(u.name=a.uri);const h=(s.samplers||{})[o.sampler]||{};return u.magFilter=DC[h.magFilter]||Ht,u.minFilter=DC[h.minFilter]||Pr,u.wrapS=CC[h.wrapS]||zs,u.wrapT=CC[h.wrapT]||zs,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(d=>d.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(void 0!==o.bufferView)l=this.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(h),l});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(h,f){let p=h;!0===t.isImageBitmapLoader&&(p=function(y){const g=new Fi(y);g.needsUpdate=!0,h(g)}),t.load(kc.resolveURL(d,s.path),p,void 0,f)})}).then(function(d){return!0===c&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||function k$(n){return n.search(/\.jpe?g($|\?)/i)>0||0===n.search(/^data\:image\/jpeg/)?"image/jpeg":n.search(/\.webp($|\?)/i)>0||0===n.search(/^data\:image\/webp/)?"image/webp":"image/png"}(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((o=o.clone()).channel=i.texCoord),s.extensions[pt.KHR_TEXTURE_TRANSFORM]){const a=void 0!==i.extensions?i.extensions[pt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[pt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return void 0!==r&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new e_,Vi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Qn,Vi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return Gh}loadMaterial(e){const t=this,r=this.extensions,s=this.json.materials[e];let o;const a={},c=[];if((s.extensions||{})[pt.KHR_MATERIALS_UNLIT]){const d=r[pt.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,s,t))}else{const d=s.pbrMetallicRoughness||{};if(a.color=new ge(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}void 0!==d.baseColorTexture&&c.push(t.assignTexture(a,"map",d.baseColorTexture,We)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=rr);const u=s.alphaMode||"OPAQUE";if("BLEND"===u?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===u&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==Si&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new ne(1,1),void 0!==s.normalTexture.scale)){const d=s.normalTexture.scale;a.normalScale.set(d,d)}return void 0!==s.occlusionTexture&&o!==Si&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==Si&&(a.emissive=(new ge).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==Si&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,We)),Promise.all(c).then(function(){const d=new o(a);return s.name&&(d.name=s.name),vs(d,s),t.associations.set(d,{materials:e}),s.extensions&&mo(r,d,s),d})}createUniqueName(e){const t=Dt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[pt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return IC(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=U$(c),d=r[u];if(d)o.push(d.promise);else{let h;h=c.extensions&&c.extensions[pt.KHR_DRACO_MESH_COMPRESSION]?s(c):IC(new ct,c,t),r[u]={primitive:c,promise:h},o.push(h)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.extensions,s=this.json.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=void 0===o[l].material?(void 0===(n=this.cache).DefaultMaterial&&(n.DefaultMaterial=new Gh({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ir})),n.DefaultMaterial):this.getDependency("material",o[l].material);a.push(u)}var n;return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let f=0,p=u.length;f<p;f++){const y=u[f],g=o[f];let m;const v=c[f];if(g.mode===Ti.TRIANGLES||g.mode===Ti.TRIANGLE_STRIP||g.mode===Ti.TRIANGLE_FAN||void 0===g.mode)m=!0===s.isSkinnedMesh?new ED(y,v):new In(y,v),!0===m.isSkinnedMesh&&m.normalizeSkinWeights(),g.mode===Ti.TRIANGLE_STRIP?m.geometry=wC(m.geometry,aA):g.mode===Ti.TRIANGLE_FAN&&(m.geometry=wC(m.geometry,fy));else if(g.mode===Ti.LINES)m=new Qy(y,v);else if(g.mode===Ti.LINE_STRIP)m=new ro(y,v);else if(g.mode===Ti.LINE_LOOP)m=new PD(y,v);else{if(g.mode!==Ti.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);m=new LD(y,v)}Object.keys(m.geometry.morphAttributes).length>0&&F$(m,s),m.name=t.createUniqueName(s.name||"mesh_"+e),vs(m,s),g.extensions&&mo(r,m,g),t.assignFinalMaterial(m),d.push(m)}for(let f=0,p=d.length;f<p;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(1===d.length)return s.extensions&&mo(r,d[0],s),d[0];const h=new gs;s.extensions&&mo(r,h,s),t.associations.set(h,{meshes:e});for(let f=0,p=d.length;f<p;f++)h.add(d[f]);return h})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new vn(sG_radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new vh(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),vs(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return i.push(void 0!==t.inverseBindMatrices?this.getDependency("accessor",t.inverseBindMatrices):null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const d=o[c];if(d){a.push(d);const h=new $e;null!==s&&h.fromArray(s.array,16*c),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Ah(a,l)})}loadAnimation(e){const i=this.json.animations[e],r=i.name?i.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,d=i.channels.length;u<d;u++){const h=i.channels[u],f=i.samplers[h.sampler],p=h.target,g=void 0!==i.parameters?i.parameters[f.input]:f.input,m=void 0!==i.parameters?i.parameters[f.output]:f.output;void 0!==p.node&&(s.push(this.getDependency("node",p.node)),o.push(this.getDependency("accessor",g)),a.push(this.getDependency("accessor",m)),l.push(f),c.push(p))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(u){const d=u[0],h=u[1],f=u[2],p=u[3],y=u[4],g=[];for(let m=0,v=d.length;m<v;m++){const _=d[m],M=h[m],E=f[m],S=p[m],T=y[m];if(void 0===_)continue;let A;switch(_.updateMatrix(),_s[T.path]){case _s.weights:A=Nc;break;case _s.rotation:A=lo;break;default:A=Lc}const x=_.name?_.name:_.uuid,b=void 0!==S.interpolation?N$[S.interpolation]:fa,U=[];_s[T.path]===_s.weights?_.traverse(function(N){N.morphTargetInfluences&&U.push(N.name?N.name:N.uuid)}):U.push(x);let $=E.array;if(E.normalized){const N=G_($.constructor),F=new Float32Array($.length);for(let V=0,O=$.length;V<O;V++)F[V]=$[V]*N;$=F}for(let N=0,F=U.length;N<F;N++){const V=new A(U[N]+"."+_s[T.path],M.array,$,b);"CUBICSPLINE"===S.interpolation&&(V.createInterpolant=function(L){return new(this instanceof lo?P$:AC)(this.times,this.values,this.getValueSize()/3,L)},V.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(V)}}return new Oc(r,void 0,g)})}createNodeMesh(e){const i=this,r=this.json.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return void 0!==r.weights&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const i=this,r=this.json.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));const l=void 0===r.skin?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],d=c[1],h=c[2];null!==h&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(h,B$)});for(let f=0,p=d.length;f<p;f++)u.add(d[f]);return u})}_loadNodeShallow(e){const i=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=this.json.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),void 0!==s.camera&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(u=!0===s.isBone?new Zy:c.length>1?new gs:1===c.length?c[0]:new yn,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(s.name&&(u.userData.name=s.name,u.name=o),vs(u,s),s.extensions&&mo(i,u,s),void 0!==s.matrix){const d=new $e;d.fromArray(s.matrix),u.applyMatrix4(d)}else void 0!==s.translation&&u.position.fromArray(s.translation),void 0!==s.rotation&&u.quaternion.fromArray(s.rotation),void 0!==s.scale&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new gs;i.name&&(s.name=r.createUniqueName(i.name)),vs(s,i),i.extensions&&mo(t,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)s.add(l[u]);return r.associations=(u=>{const d=new Map;for(const[h,f]of r.associations)(h instanceof Vi||h instanceof Fi)&&d.set(h,f);return u.traverse(h=>{const f=r.associations.get(h);null!=f&&d.set(h,f)}),d})(s),s})}}function IC(n,e,t){const i=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=V_[o]||o.toLowerCase();a in n.attributes||r.push(s(i[o],a))}if(void 0!==e.indices&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(o)}return vs(n,e),function H$(n,e,t){const i=e.attributes,r=new or;if(void 0===i.POSITION)return;{const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(void 0===l||void 0===c)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new D(l[0],l[1],l[2]),new D(c[0],c[1],c[2])),a.normalized){const u=G_(Ja[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}const s=e.targets;if(void 0!==s){const a=new D,l=new D;for(let c=0,u=s.length;c<u;c++){const d=s[c];if(void 0!==d.POSITION){const h=t.json.accessors[d.POSITION],f=h.min,p=h.max;if(void 0!==f&&void 0!==p){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),h.normalized){const y=G_(Ja[h.componentType]);l.multiplyScalar(y)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;const o=new Ui;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}(n,e,t),Promise.all(r).then(function(){return void 0!==e.targets?function O$(n,e,t){let i=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(void 0!==d.POSITION&&(i=!0),void 0!==d.NORMAL&&(r=!0),void 0!==d.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(i){const h=void 0!==d.POSITION?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(h)}if(r){const h=void 0!==d.NORMAL?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(h)}if(s){const h=void 0!==d.COLOR_0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(h)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const d=c[1],h=c[2];return i&&(n.morphAttributes.position=c[0]),r&&(n.morphAttributes.normal=d),s&&(n.morphAttributes.color=h),n.morphTargetsRelative=!0,n})}(n,e.targets,t):n})}const z$=["c"];let G$=(()=>{class n{constructor(){this.mouseX=0,this.mouseY=0,this.windowHalfX=window.innerWidth/2,this.windowHalfY=window.innerHeight/2}ngAfterViewInit(){this.init()}init(){const t=this.canvasRef.nativeElement;this.scene=new dD,this.scene.background=new ge(14540253),this.camera=new vn(50,window.innerWidth/window.innerHeight,.1,3e3),this.renderer=new uD({canvas:t,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight);const i=this.scene.getObjectByName("ship");if(console.log(i),i){this.camera.lookAt(i.position);const s=new D(0,5,-15);this.camera.position.copy(i.position).add(s)}(new c$).load("assets/scatch/scene.gltf",s=>{this.car=s.scene.children[0],this.car.scale.set(1,1,1),this.scene.add(s.scene),this.scene.traverse(o=>{if("Boot_Finaal_1"===o.name){this.ship=o;const a=new D(0,5,-10);this.camera.position.copy(o.position).add(a)}}),this.animate()}),window.addEventListener("resize",()=>this.onWindowResize()),document.addEventListener("mousemove",s=>this.onDocumentMouseMove(s)),document.addEventListener("touchstart",s=>this.onDocumentTouchStart(s)),document.addEventListener("touchmove",s=>this.onDocumentTouchMove(s))}onWindowResize(){this.windowHalfX=window.innerWidth/2,this.windowHalfY=window.innerHeight/2,this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}onDocumentMouseMove(t){this.mouseX=(t.clientX-this.windowHalfX)/250,this.mouseY=(t.clientY-this.windowHalfY)/250}onDocumentTouchStart(t){1===t.touches.length&&t.preventDefault()}onDocumentTouchMove(t){1===t.touches.length&&t.preventDefault()}animate(){if(this.ship){const t=this.ship.position,i=500,r=5e-5,s=new D(0,5,0),o=t.x+i*Math.sin(r+this.mouseX),a=t.z+i*Math.cos(r+this.mouseX),l=t.y+s.y+this.mouseY,c=.001,u=.1;this.camera.position.x+=(o-this.camera.position.x)*u,this.camera.position.z+=(a-this.camera.position.z)*u,this.camera.position.y+=(l-this.camera.position.y)*u;const d=-this.mouseX,h=-this.mouseY,f=1e-4;Math.abs(this.camera.rotation.y-d)>f||Math.abs(this.camera.rotation.x-h)>f?(this.camera.rotation.y+=(d-this.camera.rotation.y)*c,this.camera.rotation.x+=(h-this.camera.rotation.x)*c):this.camera.rotation.y+=c,this.camera.lookAt(t)}this.renderer.render(this.scene,this.camera),requestAnimationFrame(()=>this.animate())}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-sky"]],viewQuery:function(t,i){if(1&t&&ZS(z$,7),2&t){let r;KS(r=function JS(){return function rU(n,e){return n[$i].queries[e].queryList}(ee(),_0())}())&&(i.canvasRef=r.first)}},decls:2,vars:0,consts:[["id","c"],["c",""]],template:function(t,i){1&t&&Bt(0,"canvas",0,1)},styles:["canvas[_ngcontent-%COMP%]{position:relative;height:100vh;z-index:0!important}"]}),n})();function W$(n,e){if(1&n&&(J(0,"span",9),le(1),ie()),2&n){const t=e.$implicit;dn(1),tr(" ",t," ")}}function $$(n,e){if(1&n&&(J(0,"span",9),le(1),ie()),2&n){const t=e.$implicit;dn(1),tr(" ",t," ")}}function j$(n,e){if(1&n&&(J(0,"span",9),le(1),ie()),2&n){const t=e.$implicit;dn(1),tr(" ",t," ")}}function q$(n,e){if(1&n&&(J(0,"span",9),le(1),ie()),2&n){const t=e.$implicit;dn(1),tr(" ",t," ")}}function X$(n,e){if(1&n&&(J(0,"span",9),le(1),ie()),2&n){const t=e.$implicit;dn(1),tr(" ",t," ")}}let Y$=(()=>{class n{constructor(){this.aboutMe="Hello, my name is Olga Shutyleva. I am a frontend developer. Last year I studied at the Hashtag Academy school as a front-end developer. I am looking for an entry level position in a company to be hardworking, learn, grow and develop in the long term. Please see my CV, see my skills and some of my work.",this.educationRailway='- Ukrainian state university of railway transport, educational program: "Network technologies and computer equipment"',this.educationKarazin='- V. N. Karazin Kharkiv National University, educational program: "Management of Financial and Economic Security"',this.educationHashtag='- "Hashtag academy", educational program: "Front-end developer"',this.educationUdemy='- "Udemy", educational program: "Angular 9"'}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-about"]],decls:21,vars:5,consts:[[1,"about-container"],[1,"about"],[1,"wave-text","anim-element"],[1,"line"],[1,"wave-text","about-me"],["class","line","style","white-space: pre;",4,"ngFor","ngForOf"],[1,"educations"],[1,"education"],[1,"wave-text"],[1,"line",2,"white-space","pre"]],template:function(t,i){1&t&&(J(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),le(4,"About me"),ie()(),J(5,"div")(6,"p",4),ns(7,W$,2,1,"span",5),ie()()(),J(8,"div",6)(9,"div",2)(10,"h3",3),le(11,"EDUCATION"),ie()(),J(12,"div",7)(13,"p",8),ns(14,$$,2,1,"span",5),ie(),J(15,"p",8),ns(16,j$,2,1,"span",5),ie(),J(17,"p",8),ns(18,q$,2,1,"span",5),ie(),J(19,"p",8),ns(20,X$,2,1,"span",5),ie()()()()),2&t&&(dn(7),si("ngForOf",i.aboutMe.split(" ")),dn(7),si("ngForOf",i.educationRailway.split(" ")),dn(2),si("ngForOf",i.educationKarazin.split(" ")),dn(2),si("ngForOf",i.educationHashtag.split(" ")),dn(2),si("ngForOf",i.educationUdemy.split(" ")))},dependencies:[mg],styles:[".about-container[_ngcontent-%COMP%]{margin-top:-80rem;position:relative;z-index:10}.about-me[_ngcontent-%COMP%]{font-weight:500;font-size:2.5vw;line-height:150%}.educations[_ngcontent-%COMP%]{padding:109rem 0;max-width:55%;margin-left:auto}.education[_ngcontent-%COMP%]{font-weight:500;font-size:1.6vw;line-height:150%}"]}),n})(),K$=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-portfolio"]],decls:118,vars:0,consts:[[1,"portfolio-header"],[1,"wave-text"],[1,"line"],[1,"line","title"],[1,"portfolio-content"],[1,"card","card1"],["href","https://shytuleva24.github.io/startup/"],["src","assets/work01.jpg","alt",""],[1,"content-card"],[1,"flex"],[1,"title-card"],[1,"button"],["src","assets/buttonhover.png","alt","",1,"but-how"],["src","assets/button.png","alt","",1,"but"],[1,"about-card"],[1,"name-project"],[1,"use-scills"],[1,"cards","flex"],[1,"card","card2"],["href","https://shytuleva24.github.io/sea/"],["src","assets/work02.jpg","alt",""],[1,"card","card3"],["href","https://shytuleva24.github.io/repair/"],["src","assets/work03.jpg","alt",""],[1,"card","card4"],["src","assets/work06.jpg","alt",""],["src","assets/work05.jpg","alt",""],["src","assets/work04.jpg","alt",""]],template:function(t,i){1&t&&(J(0,"div",0)(1,"div",1)(2,"h3",2),le(3,"Showcase"),ie()(),J(4,"div",1)(5,"h2",3),le(6,"Recent Works"),ie()()(),J(7,"div",4)(8,"div",5),Bt(9,"a",6)(10,"img",7),J(11,"div",8)(12,"div",9)(13,"div",10)(14,"h4"),le(15,"work001"),ie(),J(16,"span"),le(17,"2022"),ie()(),J(18,"div",11),Bt(19,"img",12)(20,"img",13),ie()(),J(21,"div",14)(22,"p",15),le(23,"Startup"),ie(),J(24,"p",16),le(25,"Sass/Pug Vanilla JS"),ie()()()(),J(26,"div",17)(27,"div",18),Bt(28,"a",19)(29,"img",20),J(30,"div",8)(31,"div",9)(32,"div",10)(33,"h4"),le(34,"work002"),ie(),J(35,"span"),le(36,"2022"),ie()(),J(37,"div",11),Bt(38,"img",12)(39,"img",13),ie()(),J(40,"div",14)(41,"p",15),le(42,"Sea"),ie(),J(43,"p",16),le(44,"Sass/Pug Bootstrap"),ie()()()(),J(45,"div",21),Bt(46,"a",22)(47,"img",23),J(48,"div",8)(49,"div",9)(50,"div",10)(51,"h4"),le(52,"work003"),ie(),J(53,"span"),le(54,"2022"),ie()(),J(55,"div",11),Bt(56,"img",12)(57,"img",13),ie()(),J(58,"div",14)(59,"p",15),le(60,"Repair design"),ie(),J(61,"p",16),le(62,"Sass/Pug BEM jQuery"),ie()()()()(),J(63,"div",24),Bt(64,"a",6)(65,"img",25),J(66,"div",8)(67,"div",9)(68,"div",10)(69,"h4"),le(70,"work004"),ie(),J(71,"span"),le(72,"2023"),ie()(),J(73,"div",11),Bt(74,"img",12)(75,"img",13),ie()(),J(76,"div",14)(77,"p",15),le(78,"Testing site"),ie(),J(79,"p",16),le(80,"Angular firebase"),ie()()()(),J(81,"div",17)(82,"div",21),Bt(83,"a",6)(84,"img",26),J(85,"div",8)(86,"div",9)(87,"div",10)(88,"h4"),le(89,"work005"),ie(),J(90,"span"),le(91,"2023"),ie()(),J(92,"div",11),Bt(93,"img",12)(94,"img",13),ie()(),J(95,"div",14)(96,"p",15),le(97,"Three.js"),ie(),J(98,"p",16),le(99,"Three.js angular"),ie()()()(),J(100,"div",18),Bt(101,"a",6)(102,"img",27),J(103,"div",8)(104,"div",9)(105,"div",10)(106,"h4"),le(107,"work006"),ie(),J(108,"span"),le(109,"2022"),ie()(),J(110,"div",11),Bt(111,"img",12)(112,"img",13),ie()(),J(113,"div",14)(114,"p",15),le(115,"Bringitup"),ie(),J(116,"p",16),le(117,"JavaScript modules OOP"),ie()()()()()())},styles:["h2[_ngcontent-%COMP%]{font-weight:500;font-size:128rem;line-height:155rem;text-transform:uppercase}.portfolio-content[_ngcontent-%COMP%]{padding-top:109rem}.card[_ngcontent-%COMP%]{background:#A3A3A3;border-radius:18px;margin-bottom:233rem;background:#a3a3a3;overflow:hidden;cursor:pointer;position:relative}.card[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:2}.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{filter:grayscale(100%);transition:all .5s ease;object-fit:cover}.card[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{filter:grayscale(0%)}.about-card[_ngcontent-%COMP%]{position:absolute;bottom:0}.name-project[_ngcontent-%COMP%]{font-size:40rem;line-height:48rem;padding-bottom:10rem}.use-scills[_ngcontent-%COMP%]{font-weight:500;font-size:18rem;line-height:22rem;text-transform:uppercase}.content-card[_ngcontent-%COMP%]{position:absolute;inset:32rem}.title-card[_ngcontent-%COMP%]{text-transform:uppercase;font-weight:600;font-size:18rem;line-height:22rem}.card[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{position:relative;width:40px;height:40px}.button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:40px;height:40px}.card[_ngcontent-%COMP%]:hover   .but[_ngcontent-%COMP%]{opacity:0}.card[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{justify-content:space-between}.card1[_ngcontent-%COMP%]{width:100%;height:675rem}.card2[_ngcontent-%COMP%]{width:50%;height:1097rem}.card2[_ngcontent-%COMP%]   .about-card[_ngcontent-%COMP%]{color:#000}.card3[_ngcontent-%COMP%]{width:28%;height:862rem;background:#2A2A2A}.cards[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:first-child{margin-right:233rem}.cards.flex[_ngcontent-%COMP%]{justify-content:space-between}.card4[_ngcontent-%COMP%]{width:80%;height:673px}"]}),n})(),Z$=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-technology"]],decls:65,vars:0,consts:[[1,"flex"],[1,"technology-header"],[1,"wave-text"],[1,"line"],[1,"line","title"],[1,"git","wave-text"],["href","https://github.com/shytuleva24",1,"line"],[1,"skills"],[1,"skill-card","scroll-block"],[1,"skill-items","flex","wave-text"]],template:function(t,i){1&t&&(J(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),le(4,"Technology"),ie()(),J(5,"div",2)(6,"h2",4),le(7,"Tools I Use"),ie()(),J(8,"div",2)(9,"p",3),le(10,"For more information, here is the link to the github."),ie()()(),J(11,"div",5)(12,"a",6),le(13,"Github \u{1f852}"),ie()()(),J(14,"div",7)(15,"div",8)(16,"div",2)(17,"h4",3),le(18,"Markup"),ie()(),J(19,"ul",9)(20,"li",3),le(21,"HTML"),ie(),J(22,"li",3),le(23,"CSS"),ie(),J(24,"li",3),le(25,"SASS"),ie(),J(26,"li",3),le(27,"SCSS"),ie(),J(28,"li",3),le(29,"PUG"),ie(),J(30,"li",3),le(31,"BEM"),ie()()(),J(32,"div",8)(33,"div",2)(34,"h4",3),le(35,"UI-Frameworks"),ie()(),J(36,"ul",9)(37,"li",3),le(38,"Bootstrap 3"),ie(),J(39,"li",3),le(40,"Bootstrap 4"),ie(),J(41,"li",3),le(42,"Bootstrap 5"),ie()()(),J(43,"div",8)(44,"div",2)(45,"h4",3),le(46,"JavaScript"),ie()(),J(47,"ul",9)(48,"li",3),le(49,"Angular"),ie(),J(50,"li",3),le(51,"Vanilla JS"),ie(),J(52,"li",3),le(53,"jQuery"),ie()()(),J(54,"div",8)(55,"div",2)(56,"h4",3),le(57,"Control Version System"),ie()(),J(58,"ul",9)(59,"li",3),le(60,"GitHub"),ie(),J(61,"li",3),le(62,"Webpack"),ie(),J(63,"li",3),le(64,"Gulp"),ie()()()())},styles:[".technology-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:128rem;line-height:145rem;letter-spacing:-.02em}.technology-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:500;font-size:28rem;line-height:34rem}.flex[_ngcontent-%COMP%]{justify-content:space-between;align-items:center}.git[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:500;font-size:32rem;line-height:39rem;color:#fff;text-decoration:none}.skills[_ngcontent-%COMP%]{padding:109rem 0}h4[_ngcontent-%COMP%]{font-size:96rem;line-height:116rem}.skill-card[_ngcontent-%COMP%]{margin-bottom:40rem;text-align:center;color:#fff3}.skill-items[_ngcontent-%COMP%]{margin:0 auto;max-width:70%}.skill-card[_ngcontent-%COMP%]:hover{color:#fff}.skill-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14rem;line-height:17rem}"]}),n})();function J$(n,e){if(1&n&&(J(0,"div",7)(1,"span",8),le(2),ie()()),2&n){const t=e.$implicit;dn(1),si("@showUp",void 0),dn(1),tr(" ",t," ")}}function Q$(n,e){if(1&n&&(J(0,"p",9)(1,"span",8),le(2),ie()()),2&n){const t=e.$implicit;dn(1),si("@showUp",void 0),dn(1),tr(" ",t," ")}}let ej=(()=>{class n{constructor(){this.title=["I'm front-","End","Developer"],this.aboutMe=["Hi, I'm Olga and I'm developing your sites.","Tell me about your idea and I will","design its mechanical heart."]}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-home"]],decls:10,vars:4,consts:[[1,"container"],[1,"flex","nav","wave-text"],[1,"logo"],[1,"title-home"],["class","wave-text-home title",4,"ngFor","ngForOf"],[1,"about-me"],["class","wave-text-home",4,"ngFor","ngForOf"],[1,"wave-text-home","title"],[1,"line-home"],[1,"wave-text-home"]],template:function(t,i){1&t&&(J(0,"div",0)(1,"div",1)(2,"a",2),le(3,"olga shutyleva"),ie(),J(4,"a"),le(5,"contact"),ie()(),J(6,"div",3),ns(7,J$,3,2,"div",4),J(8,"div",5),ns(9,Q$,3,2,"p",6),ie()()()),2&t&&(dn(2),si("@showUp",void 0),dn(2),si("@showUp",void 0),dn(3),si("ngForOf",i.title),dn(2),si("ngForOf",i.aboutMe))},dependencies:[mg],styles:[".container[_ngcontent-%COMP%]{padding:40px;height:100%}.logo[_ngcontent-%COMP%]{text-transform:none}.nav[_ngcontent-%COMP%]{justify-content:space-between}.title-home[_ngcontent-%COMP%]{position:relative;padding:20px}.title[_ngcontent-%COMP%]{font-weight:400;font-size:10.5vw;line-height:120%;text-transform:uppercase;color:#fff;text-shadow:3px 5px 9px rgba(0,0,0,.4)}@media (max-width: 1148px){h1[_ngcontent-%COMP%]{font-size:10vw}}a[_ngcontent-%COMP%]{font-weight:700;font-size:1.1vw;line-height:150%;text-transform:uppercase}.about-me[_ngcontent-%COMP%]{max-width:45%;position:absolute;top:41%;left:62%;font-weight:500;font-size:1.9vw;line-height:3vw;letter-spacing:-.04em;text-shadow:3px 5px 9px rgba(0,0,0,.4)}.wave-text-home[_ngcontent-%COMP%]{overflow:hidden}.line-home[_ngcontent-%COMP%]{display:block}"],data:{animation:[jB("showUp",[XB(":enter",[Cd({transform:"translateY(100%)"}),qB("500ms 1s",Cd({transform:"translateY(0)"}))])])]}}),n})(),tj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-look"]],decls:17,vars:0,consts:[[1,"container"],[1,"portfolio-header"],[1,"wave-text"],[1,"line"],[1,"line","title"],[1,"marquee"],[1,"text"]],template:function(t,i){1&t&&(J(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),le(4,"Me"),ie()(),J(5,"div",2)(6,"h2",4),le(7,"I look like this"),ie()()()(),J(8,"div",5)(9,"span",6),le(10," How?\xa0 "),ie(),J(11,"span",6),le(12," How?\xa0 "),ie(),J(13,"span",6),le(14," How?\xa0 "),ie(),J(15,"span",6),le(16," How?\xa0 "),ie()())},styles:["h2[_ngcontent-%COMP%]{font-size:128rem;line-height:171rem}.marquee[_ngcontent-%COMP%]{width:100%;overflow:hidden;white-space:nowrap;padding-bottom:71px;border-bottom:2px solid rgba(255,255,255,.1)}.marquee[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:210rem;font-weight:300;color:#fff;text-transform:uppercase;display:inline-block;animation:_ngcontent-%COMP%_marquee 4s linear infinite}@keyframes _ngcontent-%COMP%_marquee{0%{transform:translate(0)}to{transform:translate(-100%)}}"]}),n})(),nj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=mr({type:n,selectors:[["app-footer"]],decls:61,vars:0,consts:[[1,"flex"],[1,"footer-header"],[1,"wave-text"],[1,"line"],[1,"footer-info"],[1,"developer","flex"],[1,"footer-title"],[1,"move-text"],[1,"name"],[1,"contact"],[1,"designer","flex"],[1,"copyright"]],template:function(t,i){1&t&&(J(0,"footer")(1,"div",0)(2,"div",1)(3,"div",2)(4,"h3",3),le(5,"The end"),ie()(),J(6,"div",2)(7,"h2",3),le(8,"Thank you for viewing my portfolio!"),ie()()(),J(9,"div",4)(10,"div",5)(11,"div",6)(12,"div",2)(13,"h3",3),le(14,"Developer"),ie()(),J(15,"div",7)(16,"p",8),le(17,"Olga Shytyleva"),ie()()(),J(18,"div",9)(19,"div",2)(20,"h3",3),le(21,"Contact"),ie()(),J(22,"div",2)(23,"a",3),le(24,"0 97 000 00 00"),ie()(),J(25,"div",2)(26,"a",3),le(27,"pochta@gmail.com"),ie()(),J(28,"div",2)(29,"a",3),le(30,"githab.com"),ie()(),J(31,"div",2)(32,"a",3),le(33,"linkedin"),ie()(),J(34,"div",2)(35,"a",3),le(36,"Telegram"),ie()()()(),J(37,"div",10)(38,"div",6)(39,"div",2)(40,"h3",3),le(41,"Designer"),ie()(),J(42,"div",7)(43,"p",8),le(44,"Vladislav Kiyan"),ie()()(),J(45,"div",9)(46,"div",2)(47,"h3",3),le(48,"Contact"),ie()(),J(49,"div",2)(50,"a",3),le(51,"vlakiyn@gmail.com"),ie()(),J(52,"div",2)(53,"a",3),le(54,"linkedin"),ie()(),J(55,"div",2)(56,"a",3),le(57,"Telegram"),ie()()()()()(),J(58,"div",11)(59,"p"),le(60,"\xa9 Olga-Shutyleva 2023"),ie()()())},styles:["h2[_ngcontent-%COMP%]{font-weight:500;font-size:40rem;line-height:48rem}footer[_ngcontent-%COMP%]{padding-top:109rem}footer[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{justify-content:space-between}.footer-header[_ngcontent-%COMP%]{width:30%}.footer-info[_ngcontent-%COMP%]{width:60%}.developer[_ngcontent-%COMP%], .designer[_ngcontent-%COMP%]{margin-bottom:180px}.footer-info[_ngcontent-%COMP%]   .footer-title[_ngcontent-%COMP%], .footer-info[_ngcontent-%COMP%]   .contact[_ngcontent-%COMP%]{width:40%}.name[_ngcontent-%COMP%]{font-size:24px;line-height:29px}.contact[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-bottom:15rem;font-weight:300;font-size:16px;line-height:19px;text-decoration-line:underline;color:#ffffffe6}.copyright[_ngcontent-%COMP%]{padding:30rem 0;font-size:12px;line-height:15px;letter-spacing:.08em;text-align:center}"]}),n})(),ij=(()=>{class n{constructor(t,i){this.scrollAnimationService=t,this.elementRef=i}ngAfterViewInit(){this.elementRef.nativeElement.querySelectorAll(".line").forEach(i=>{const r=new ts(i);this.scrollAnimationService.observe(r)})}}return n.\u0275fac=function(t){return new(t||n)(nt(WH),nt(ts))},n.\u0275cmp=mr({type:n,selectors:[["app-root"]],decls:14,vars:0,consts:[["id","block1",1,"scroll-container"],[1,"home-page","scroll-block"],[1,"home-content"],["id","block2",1,"container","scroll-block"],["id","block3",1,"container","scroll-block"],["id","block5",1,"container","scroll-block"],["id","block6",1,"container","scroll-block"]],template:function(t,i){1&t&&(J(0,"div",0)(1,"div",1),Bt(2,"app-sky"),J(3,"div",2),Bt(4,"app-home"),ie()(),J(5,"div",3),Bt(6,"app-about"),ie(),J(7,"div",4),Bt(8,"app-technology"),ie(),J(9,"div",5),Bt(10,"app-portfolio"),ie(),Bt(11,"app-look"),J(12,"div",6),Bt(13,"app-footer"),ie()())},dependencies:[G$,Y$,K$,Z$,ej,tj,nj],styles:[".home-page[_ngcontent-%COMP%]{position:relative}.home-content[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}"]}),n})(),rj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xo({type:n,bootstrap:[ij]}),n.\u0275inj=Es({imports:[Lb,GH]}),n})();UB().bootstrapModule(rj).catch(n=>console.error(n))}},Ut=>{Ut(Ut.s=411)}]);